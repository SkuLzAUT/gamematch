<!DOCTYPE html>
<html lang="de-DE">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GameMatch - Dein KI-Spieleberater für Steam</title>
    
    <meta name="description" content="Finde dein perfektes PC-Spiel mit KI. GameMatch analysiert deine Stimmung, Zeit & Vorlieben und gibt dir sofort die passende Empfehlung direkt aus dem Steam Store.">
    <meta name="keywords" content="GameMatch, Steam, Spiel finden, KI Game Beratung, Steam Empfehlungen, Gaming KI, welches Spiel spielen, PC Gaming">
    <meta name="author" content="GameMatch Team">
    <link rel="canonical" href="https://gamematch.eu" />

    <link rel="preload" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;900&family=Orbitron:wght@700&display=swap" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;900&family=Orbitron:wght@700&display=swap"></noscript>

    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/i18next/dist/umd/i18next.min.js"></script>
    <style>
.text-fluid-hero {
  /* min Größe, bevorzugte Größe, max Größe */
  font-size: clamp(2.0rem, 8vw, 3.75rem);
  line-height: clamp(2.4rem, 9vw, 4.25rem);
}

.text-fluid-subhero {
  font-size: clamp(1rem, 4vw, 1.25rem);
  line-height: clamp(1.5rem, 5vw, 1.75rem);
}

.text-fluid-heading {
  font-size: clamp(1.5rem, 6vw, 2.25rem);
  line-height: clamp(2rem, 7vw, 2.75rem);
}
        :root {
            --bg-dark: #111827; --bg-mid: #1F2937; --bg-light: #374151;
            --accent-blue: #2563EB; --accent-cyan: #06B6D4; --accent-yellow: #FBBF24;
            --text-light: #F9FAFB; --text-dark: #9CA3AF;
        }
        body { font-family: 'Inter', sans-serif; background-color: var(--bg-dark); color: var(--text-light); scroll-behavior: smooth; }
        h1, h2, h3, h4 { font-family: 'Inter', sans-serif; font-weight: 800; }
        .font-orbitron { font-family: 'Orbitron', sans-serif; }
        .hero-bg { background-image: linear-gradient(to top, var(--bg-dark) 5%, transparent 50%), linear-gradient(rgba(17, 24, 39, 0.85), rgba(17, 24, 39, 1)), url('https://images.pexels.com/photos/924824/pexels-photo-924824.jpeg?auto=compress&cs=tinysrgb&w=1920'); background-size: cover; background-position: center; }
        .page-section { display: none; opacity: 0; transition: opacity 0.3s ease; }
        .page-section.active { display: block; opacity: 1; }
        #home.active { animation: none; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .fade-in { animation: fadeIn 0.5s ease-out forwards; }
        .ai-bubble-container, .user-bubble-container { max-width: 80%; animation: fadeIn 0.5s ease-in-out; }
        .is-loading::after { content: '...'; display: inline-block; animation: dots 1s steps(3, end) infinite; }
        @keyframes dots { 0%, 20% { color: rgba(0,0,0,0); text-shadow: .25em 0 0 rgba(0,0,0,0), .5em 0 0 rgba(0,0,0,0); } 40% { color: white; text-shadow: .25em 0 0 rgba(0,0,0,0), .5em 0 0 rgba(0,0,0,0); } 60% { text-shadow: .25em 0 0 white, .5em 0 0 rgba(0,0,0,0); } 80%, 100% { text-shadow: .25em 0 0 white, .5em 0 0 white; } }
        input:-webkit-autofill { -webkit-box-shadow: 0 0 0 30px var(--bg-dark) inset !important; -webkit-text-fill-color: var(--text-light) !important; }
        
        /* KORRIGIERTE STILE FÜR PROFIL-TABS */
        .profile-tab-content { display: none; }
        .profile-tab-content.active { display: block; }
        #profile-content-spiele.active { display: grid; }
        .profile-tab-btn { color: #9CA3AF; border-color: transparent; transition: all 0.2s ease-in-out; }
        .profile-tab-btn.active { color: #06B6D4; border-color: #06B6D4; }

        .community-tab-content { display: none; }
        .community-tab-content.active { display: block; }
        .community-tab-btn { color: #9CA3AF; border-color: transparent; transition: all 0.2s ease-in-out; }
        .community-tab-btn.active { color: #06B6D4; border-color: #06B6D4; }
        .filter-btn { padding: 6px 16px; border-radius: 9999px; font-weight: 600; background-color: #374151; color: #F9FAFB; transition: background-color 0.2s; }
        .filter-btn.active { background-color: #06B6D4; color: #111827; }
        /* Stil für einen auffälligen Discord-Button */
        .discord-btn {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        padding: 0.5rem; /* p-2 */
        border-radius: 9999px; /* rounded-full */
        background-color: #5865F2; /* Discord "Blurple" */
        color: white;
        transition: all 0.2s ease-in-out;
        }
        .discord-btn:hover {
        background-color: #4f5bda; /* Etwas dunkler bei Hover */
        transform: scale(1.1);
        }
        .glow-bg { position: relative; z-index: 1; }
        .glow-bg::before { content: ''; position: absolute; z-index: -1; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 60%; height: 70%; background: radial-gradient(circle, rgba(6, 182, 212, 0.15) 0%, rgba(17, 24, 39, 0) 70%); filter: blur(40px); pointer-events: none; }

        /* AUTH MODAL STYLES */
        .auth-modal {
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }
        .auth-modal-content {
            transition: transform 0.3s ease;
        }
        html, body {
    height: 100%; /* Stellt sicher, dass die Seite immer die volle Höhe hat */
}
body {
    display: flex;
    flex-direction: column;
}
main {
    flex-grow: 1; 
}
/* ========================= */
/* CSS für Partner-Scroller  */
/* ========================= */
/* Container, der die scrollende Leiste verbirgt und die Ränder weichzeichnet */
.scroller-container {
    max-width: 900px;
    margin: auto;
    overflow: hidden;
    -webkit-mask-image: linear-gradient(to right, transparent, white 20%, white 80%, transparent);
    mask-image: linear-gradient(to right, transparent, white 20%, white 80%, transparent);
}

/* Die Leiste, die alle Logos enthält und animiert wird */
.scroller {
    display: flex;
    width: max-content; /* Passt sich automatisch der Breite der Logos an */
    animation: scroll 30s linear infinite; /* Dauer ggf. anpassen */
}

/* Hält die Animation an, wenn man mit der Maus darüber fährt */
.scroller:hover {
    animation-play-state: paused;
}

/* Die Keyframe-Animation, die die Leiste bewegt */
@keyframes scroll {
    from {
        transform: translateX(0);
    }
    to {
        /* Bewegt die Leiste um exakt die Hälfte ihrer Gesamtbreite */
        transform: translateX(-50%);
    }
}

/* Styling für die einzelnen Logos */
.scroller a img {
    height: 40px;
    margin: 0 32px; /* mx-8 in Tailwind */
    filter: grayscale(1) brightness(2);
    opacity: 0.8;
    transition: all 0.2s ease-in-out;
}

.scroller a:hover img {
    filter: grayscale(0) brightness(1);
    opacity: 1;
    transform: scale(1.1);
}

#game-detail-modal.visible {
    opacity: 1;
    visibility: visible;
}
#game-detail-modal.visible #game-detail-modal-content {
    transform: scale(1);
}
@media (max-width: 768px) {
    .hero {
      /* Vertikales Padding reduziert für bessere mobile Ansicht */
      padding: 3rem 1.25rem; /* 3rem oben/unten, 1.25rem links/rechts */
      text-align: center;
    }

    nav ul {
      flex-direction: column;
      align-items: center;
    }

    nav li {
      margin: 10px 0;
    }

    .features {
      flex-direction: column;
      /* Padding angepasst für mobile Ansicht */
      padding: 2.5rem 1.25rem;
    }

    .feature {
      width: 100%;
    }

    .footer {
      /* Feste, lesbare Schriftgröße statt vw */
      font-size: 0.875rem; /* 14px */
      text-align: center;
    }
}
/* ========================================================== */
/* NEUE STILE FÜR DAS DATENSCHUTZ-AKKORDEON                    */
/* ========================================================== */
#privacy-content h1 {
    font-size: 2.25rem; /* 36px */
    font-weight: 800;
    text-align: center;
    margin-bottom: 2rem;
}

#privacy-content .accordion-item {
    border-bottom: 1px solid var(--bg-light);
}

#privacy-content .accordion-header {
    width: 100%;
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 1.25rem 0.5rem;
    background-color: transparent;
    border: none;
    cursor: pointer;
    text-align: left;
    font-size: 1.125rem; /* 18px */
    font-weight: 600;
    color: var(--text-light);
    transition: background-color 0.2s ease;
}

#privacy-content .accordion-header:hover {
    color: var(--accent-cyan);
}

#privacy-content .accordion-header .accordion-icon {
    font-size: 1.5rem;
    color: var(--text-dark);
    transition: transform 0.3s ease;
}

#privacy-content .accordion-header.active .accordion-icon {
    transform: rotate(45deg);
}

#privacy-content .accordion-content {
    overflow: hidden;
    max-height: 0;
    transition: max-height 0.5s ease-in-out, padding 0.5s ease-in-out;
    padding: 0 1rem;
}

#privacy-content .accordion-content.open {
    /* max-height wird per JS gesetzt, wir brauchen nur das Padding */
    padding: 1.5rem 1rem;
}

/* Styling für die Inhalte innerhalb des Akkordeons */
#privacy-content .accordion-content h3 {
    font-size: 1rem;
    font-weight: 700;
    color: var(--text-light);
    margin-top: 1rem;
    margin-bottom: 0.5rem;
}

#privacy-content .accordion-content p, 
#privacy-content .accordion-content li {
    font-size: 0.95rem;
    line-height: 1.6;
    color: var(--text-dark);
    margin-bottom: 1rem;
}
#privacy-content .accordion-content ul {
    list-style-position: inside;
    padding-left: 0.5rem;
}

#privacy-content .accordion-content a {
    color: var(--accent-cyan);
    text-decoration: underline;
    text-decoration-color: transparent;
    transition: text-decoration-color 0.2s;
}

#privacy-content .accordion-content a:hover {
    text-decoration-color: var(--accent-cyan);
}
    </style>
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-9925570056243594"
     crossorigin="anonymous"></script>
</head>
<body class="bg-gray-900 text-gray-50 antialiased overflow-x-hidden">
 <noscript>
        <h1>Willkommen bei GameMatch - Ihr KI-Spieleberater</h1>
        <p>Finden Sie Ihr perfektes PC-Spiel mit künstlicher Intelligenz. GameMatch analysiert Ihre Stimmung, verfügbare Zeit und persönliche Vorlieben und gibt Ihnen sofort die passende Empfehlung direkt aus dem Steam Store. Schluss mit der Unentschlossenheit! Unsere KI führt ein echtes Gespräch mit Ihnen und findet zielsicher das Spiel, auf das Sie gerade wirklich Lust haben.</p>
        <h2>Unsere Features</h2>
        <p>Werden Sie Teil einer wachsenden Community. Jedes "gelikte" Spiel landet in Ihrem Profil. Bewerten und kommentieren Sie Ihre Sammlung und bauen Sie sich so Ihren digitalen Trophäenschrank auf. Verbinden Sie sich mit Gamern, die Ihren Geschmack teilen, vergleichen Sie Ihre Sammlungen und finden Sie neue Mitspieler.</p>
        <h2>Aktuelle News</h2>
        <p>Bleiben Sie auf dem Laufenden mit unseren neuesten Beiträgen über Updates, Spiel-Highlights und Community-News.</p>
    </noscript>     
<div id="giveaway-banner" class="hidden bg-yellow-500 text-black p-4 text-center relative">
    <p class="font-semibold">
        <span data-i18n="giveaway_banner_title"></span>
        <span data-i18n="giveaway_banner_text" class="font-normal ml-2"></span>
    </p>
    <button id="close-giveaway-banner" class="absolute top-1/2 right-4 -translate-y-1/2 text-black hover:text-gray-800">
        <svg class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>
    </button>
</div>
    <header class="bg-gray-900/70 backdrop-blur-sm sticky top-0 z-50 border-b border-gray-800">
    <nav class="container mx-auto px-6 py-4 flex justify-between items-center">
        <a href="#home" class="text-2xl font-bold text-white nav-trigger font-orbitron">Game<span class="text-cyan-400">Match</span></a>
        
        <div class="hidden md:flex md:items-center md:gap-4">
            <a href="#matchmaker" data-i18n="nav_find_game" class="bg-cyan-600 text-white font-semibold px-5 py-2 rounded-lg hover:bg-cyan-500 transition-all duration-300 transform hover:scale-105 nav-trigger"></a>
            <div id="user-auth" class="flex items-center gap-4">
                <button id="login-btn" data-i18n="nav_login" class="font-semibold text-gray-300 hover:text-white transition-colors"></button>
                <button id="register-btn" data-i18n="nav_register" class="bg-cyan-600 text-white font-semibold px-4 py-1.5 rounded-lg hover:bg-cyan-500 transition-colors"></button>
                <a href="#admin" id="admin-link" data-i18n="nav_admin" class="hidden font-semibold text-yellow-400 hover:text-yellow-300 transition-colors nav-trigger"></a>
                <a href="#news" data-i18n="nav_news" class="font-semibold text-gray-300 hover:text-white transition-colors nav-trigger"></a>
                <a href="#search-users" id="search-users-link" data-i18n="nav_community" class="hidden font-semibold text-gray-300 hover:text-white transition-colors nav-trigger"></a>
                <a href="#partners" data-i18n="nav_partners" class="font-semibold text-gray-300 hover:text-white transition-colors nav-trigger">Partner</a>
                <div id="profile-link" class="relative group hidden">
                    <a href="#profile" class="font-semibold text-gray-300 hover:text-white transition-colors nav-trigger inline-flex items-center gap-1">
                        <span data-i18n="nav_profile"></span>
                        <svg class="w-4 h-4 opacity-70" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                        <span id="unread-messages-badge" class="absolute -top-1 -right-2 bg-red-600 text-white text-xs font-bold rounded-full h-4 w-4 flex items-center justify-center hidden"></span>
                    </a>
                    <div class="absolute top-full -right-4 pt-2 w-48 bg-gray-800 border border-gray-700 rounded-lg shadow-lg hidden group-hover:block z-10">
                        <div class="py-1">
                            <a href="#leaderboard" data-i18n="nav_leaderboard" class="block px-4 py-2 text-sm text-gray-300 hover:bg-gray-700 hover:text-white nav-trigger"></a>
                            <a href="https://forms.gle/zV75jDvUzJb4aNB3A" target="_blank" data-i18n="nav_feedback" class="block px-4 py-2 text-sm text-gray-300 hover:bg-gray-700 hover:text-white"></a>
                        </div>
                    </div>
                </div>
                <button id="logout-btn" data-i18n="nav_logout" class="hidden font-semibold text-gray-300 hover:text-white transition-colors"></button>
            </div>
            <div class="flex items-center gap-4 ml-4 border-l border-gray-700 pl-4">
                <a href="https://discord.gg/CTUERAwgNE" target="_blank" rel="noopener" title="Tritt unserem Discord bei!" class="discord-btn">
    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24" aria-hidden="true">...</svg>
</a>
                <button onclick="changeLang('de')" title="Deutsch" class="opacity-70 hover:opacity-100 transition-opacity">🇩🇪</button>
                <button onclick="changeLang('en')" title="English" class="opacity-70 hover:opacity-100 transition-opacity">🇬🇧</button>
            </div>
        </div>
        
        <div class="md:hidden">
            <button id="mobile-menu-btn" class="text-white z-50 relative">
                <svg id="menu-open-icon" class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7"></path></svg>
                <svg id="menu-close-icon" class="w-6 h-6 hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
            </button>
        </div>
    </nav>
</header>

<div id="mobile-menu" class="hidden fixed inset-0 bg-gray-900/95 backdrop-blur-sm z-40 flex flex-col items-center justify-center transition-opacity duration-300">
    <div class="space-y-4 text-center">
        <button id="mobile-login-btn" data-i18n="nav_login" class="block text-2xl text-gray-300 hover:text-cyan-400"></button>
        <button id="mobile-register-btn" data-i18n="nav_register" class="block text-2xl text-cyan-400 font-semibold"></button>
        <hr class="border-gray-700 w-1/2 mx-auto" id="mobile-menu-divider">
        <a href="#matchmaker" data-i18n="nav_find_game" class="block text-2xl text-gray-300 hover:text-cyan-400 nav-trigger"></a>
        <a href="#news" data-i18n="nav_news" class="block text-2xl text-gray-300 hover:text-cyan-400 nav-trigger"></a>
        <a href="#search-users" id="mobile-search-users-link" data-i18n="nav_community" class="block text-2xl text-gray-300 hover:text-cyan-400 nav-trigger"></a>
        <a href="#partners" data-i18n="nav_partners" class="block text-2xl text-gray-300 hover:text-cyan-400 nav-trigger">Partner</a>
        <a href="#profile" id="mobile-profile-link" data-i18n="nav_profile" class="block text-2xl text-gray-300 hover:text-cyan-400 nav-trigger"></a>
        <a href="#leaderboard" id="mobile-leaderboard-link" data-i18n="nav_leaderboard" class="block text-2xl text-gray-300 hover:text-cyan-400 nav-trigger"></a>
        <a href="https://forms.gle/zV75jDvUzJb4aNB3A" target="_blank" data-i18n="nav_feedback" class="block text-2xl text-gray-300 hover:text-cyan-400"></a>
        <a href="#admin" id="mobile-admin-link" data-i18n="nav_admin" class="block text-2xl text-yellow-400 hover:text-yellow-300 nav-trigger"></a>
        <button id="mobile-logout-btn" data-i18n="nav_logout" class="block w-full text-2xl text-gray-300 hover:text-cyan-400"></button>
    </div>
</div>
</header>

    <main>
        <section id="home" class="page-section active fade-in">
    <div class="hero-bg glow-bg">
        <div class="container mx-auto px-4 py-12 md:py-24 text-center">
        <h1 data-i18n="hero_title" class="font-black text-white mb-4 text-fluid-hero"></h1>
        <p data-i18n="hero_subtitle" class="text-gray-400 max-w-2xl mx-auto mb-8 text-fluid-subhero"></p>
        <a data-i18n="hero_cta" href="#matchmaker" class="bg-cyan-500 text-gray-900 font-bold text-base px-8 py-3 sm:text-lg sm:px-10 sm:py-4 rounded-lg hover:bg-cyan-400 transition-all duration-300 transform hover:scale-105 nav-trigger"></a>

            <div id="home-daily-challenge" class="hidden container mx-auto px-6 mt-12 max-w-3xl">
                <div class="bg-gray-800/50 border-2 border-yellow-700 rounded-xl p-6 text-center shadow-lg glow-bg">
                    <h3 data-i18n="daily_mission_title" class="text-2xl font-bold text-yellow-300"></h3>
                    <p id="home-daily-challenge-text" class="text-yellow-200 mt-2 text-lg">Lade Challenge...</p>
                    <div id="home-daily-challenge-reward" class="mt-3 text-sm text-gray-300">
                        <span data-i18n="daily_mission_reward"></span> <span class="font-bold text-white">+25 XP</span>
                    </div>
                    <button data-i18n="daily_mission_cta" id="home-daily-challenge-cta" class="mt-4 rounded-md bg-yellow-500 px-5 py-2.5 text-sm font-semibold text-gray-900 shadow-sm hover:bg-yellow-400"></button>
                </div>
            </div>
            <div class="py-24 sm:py-32">
    <div class="container mx-auto px-6 max-w-7xl">
        <div class="mx-auto max-w-2xl lg:text-center">
            <h2 data-i18n="feature_section_title" class="text-base font-semibold leading-7 text-cyan-400">Dein persönliches Gaming-Universum</h2>
            <p data-i18n="feature_section_subtitle" class="mt-2 font-bold tracking-tight text-white text-fluid-heading">Mehr als nur Empfehlungen</p>
            <p data-i18n="feature_section_desc" class="mt-6 text-lg leading-8 text-gray-400">
                Ein GameMatch-Konto ist dein zentraler Hub für alles, was mit deinen Spielen zu tun hat. Sammle, teile und verfolge deinen Fortschritt.
            </p>
        </div>

        <div class="mx-auto mt-16 max-w-2xl sm:mt-20 lg:mt-24 lg:max-w-4xl">
            <dl class="grid max-w-xl grid-cols-1 gap-x-8 gap-y-10 lg:max-w-none lg:grid-cols-3 lg:gap-y-16">
                <div class="relative pl-16">
                    <dt class="text-base font-semibold leading-7 text-white">
                        <div class="absolute left-0 top-0 flex h-10 w-10 items-center justify-center rounded-lg bg-cyan-500">
                            <svg class="h-6 w-6 text-white" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M12 6.042A8.967 8.967 0 006 3.75c-1.052 0-2.062.18-3 .512v14.25A8.987 8.987 0 016 18c2.305 0 4.408.867 6 2.292m0-14.25a8.966 8.966 0 016-2.292c1.052 0 2.062.18 3 .512v14.25A8.987 8.987 0 0018 18a8.967 8.967 0 00-6 2.292m0-14.25v14.25" />
                            </svg>
                        </div>
                        <span data-i18n="feature_new_library_title">Deine Bibliothek</span>
                    </dt>
                    <dd data-i18n="feature_new_library_desc" class="mt-2 text-base leading-7 text-gray-400">Jedes Spiel, das du magst, wird hier gespeichert. Erstelle deine ultimative Sammlung, bewerte sie und zeige sie deinen Freunden.</dd>
                </div>

                <div class="relative pl-16">
                    <dt class="text-base font-semibold leading-7 text-white">
                        <div class="absolute left-0 top-0 flex h-10 w-10 items-center justify-center rounded-lg bg-cyan-500">
                            <svg class="h-6 w-6 text-white" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M18 18.72a9.094 9.094 0 003.741-.479 3 3 0 00-4.682-2.72m-7.5-2.964A4.5 4.5 0 1112 5.25v-2.25m-5.25 4.5a4.5 4.5 0 00-1.372 2.964m-7.5 0a4.5 4.5 0 013.741-2.25m9.75 0a4.5 4.5 0 011.372 2.964M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                            </svg>
                        </div>
                        <span data-i18n="feature_new_crew_title">Deine Crew</span>
                    </dt>
                    <dd data-i18n="feature_new_crew_desc" class="mt-2 text-base leading-7 text-gray-400">Finde Spieler, die deinen Geschmack teilen. Vergleicht eure Bibliotheken und findet heraus, welche Spiele ihr gemeinsam zocken könnt.</dd>
                </div>

                <div class="relative pl-16">
                    <dt class="text-base font-semibold leading-7 text-white">
                        <div class="absolute left-0 top-0 flex h-10 w-10 items-center justify-center rounded-lg bg-cyan-500">
                            <svg class="h-6 w-6 text-white" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M16.5 18.75h-9a9.75 9.75 0 011.056-5.223 9.75 9.75 0 01-1.056-5.223H7.5a9.75 9.75 0 019 0h-1.875a9.75 9.75 0 01-1.056 5.223A9.75 9.75 0 0116.5 18.75z" />
                                <path stroke-linecap="round" stroke-linejoin="round" d="M12 1.5v5.25m0 7.5v5.25m0-5.25h-5.25m5.25 0h5.25" />
                                <path stroke-linecap="round" stroke-linejoin="round" d="M15 5.625a3 3 0 11-6 0 3 3 0 016 0z" />
                            </svg>
                        </div>
                        <span data-i18n="feature_new_progress_title">Dein Fortschritt</span>
                    </dt>
                    <dd data-i18n="feature_new_progress_desc" class="mt-2 text-base leading-7 text-gray-400">Sammle für deine Aktivitäten auf der Seite Erfahrungspunkte (XP), steige im Level auf und schalte neue Ränge frei.</dd>
                </div>
            </dl>
        </div>
    </div>
</div>
                    <div id="stats-section" class="py-12 bg-gray-900/50">
    <div class="container mx-auto px-6 max-w-5xl">
        <div class="grid grid-cols-1 md:grid-cols-3 gap-8 text-center">
            <div>
                <span id="stat-recommendations" class="font-orbitron text-4xl font-bold text-cyan-400">735</span>
                <p class="text-gray-400 mt-2">Spielempfehlungen generiert</p>
            </div>
            <div>
                <span id="stat-members" class="font-orbitron text-4xl font-bold text-cyan-400">0</span>
                <p class="text-gray-400 mt-2">Community-Mitglieder</p>
            </div>
            <div>
                <span id="stat-rating" class="font-orbitron text-4xl font-bold text-cyan-400">4,5</span>
                <p class="text-gray-400 mt-2">Durchschnittliche Bewertung</p>
            </div>
        </div>
    </div>
</div>

<div class="py-24">
    <div class="container mx-auto px-6 max-w-5xl">
        <h2 class="text-center font-bold text-white text-fluid-heading">Was unsere Nutzer sagen</h2>
        <div class="mt-12 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
            <div class="bg-gray-800 p-6 rounded-xl border border-gray-700">
                <p class="text-gray-300">"Ich habe Stunden auf Steam verschwendet. GameMatch hat mir in 2 Minuten ein perfektes Indie-Juwel gefunden. Wahnsinn!"</p>
                <div class="flex items-center mt-4">
                    <img src="https://cdn.cloudflare.steamstatic.com/steamcommunity/public/images/avatars/00/000f11d60061e1748b851b1d850ac25e59541ca1_full.jpg" alt="Kamatra" class="w-10 h-10 rounded-full">
                    <p class="ml-4 font-semibold text-white">Kamatra</p>
                </div>
            </div>
            <div class="bg-gray-800 p-6 rounded-xl border border-gray-700">
                <p class="text-gray-300">"Die KI ist erschreckend gut, natürlich hat sie noch Kinderkrankheiten. Endlich mal Empfehlungen, die nicht nur die üblichen AAA Titel sind."</p>
                <div class="flex items-center mt-4">
                    <img src="https://cdn.cloudflare.steamstatic.com/steamcommunity/public/images/avatars/00/000f1af6be1137efc205847eac9490245dd9e94c_full.jpg" alt="djdonni" class="w-10 h-10 rounded-full">
                    <p class="ml-4 font-semibold text-white">djdonni</p>
                </div>
            </div>
            <div class="bg-gray-800 p-6 rounded-xl border border-gray-700">
                <p class="text-gray-300">"Super Tool, um schnell herauszufinden, worauf man gerade Bock hat. Nutze es mittlerweile fast täglich, ab und an kommen echt lustige Vorschläge - immer eine Überraschung."</p>
                <div class="flex items-center mt-4">
                    <img src="https://cdn.cloudflare.steamstatic.com/steamcommunity/public/images/avatars/00/000f0890a8ff84304784f8075897f3789bb0cff4_full.jpg" alt="Zeli" class="w-10 h-10 rounded-full">
                    <p class="ml-4 font-semibold text-white">Zeli</p>
                </div>
            </div>
        </div>
    </div>
</div>
                    <div class="mt-24 bg-gray-900 border border-gray-700 rounded-2xl p-8 text-center">
                        <h3 data-i18n="guest_cta_title" class="font-bold text-white text-fluid-heading"></h3>
                        <p data-i18n="guest_cta_desc" class="mt-4 text-gray-400 max-w-2xl mx-auto"></p>
                        <div class="mt-6 flex flex-col sm:flex-row items-center justify-center gap-4 sm:gap-x-6">
                            <button data-i18n="guest_cta_register" id="open-register-modal-btn" class="rounded-md bg-cyan-500 px-6 py-3 text-sm font-semibold text-gray-900 shadow-sm hover:bg-cyan-400 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-cyan-600"></button>
                            <button data-i18n="guest_cta_login" id="open-login-modal-btn" class="text-sm font-semibold leading-6 text-white hover:underline"></button>
                        </div>
                    </div>
                    
                    <div id="featured-game-section" class="mt-24 sm:mt-32">
    <div class="container mx-auto px-6 max-w-4xl">
        <div class="text-center mb-8">
            <h2 class="text-base font-semibold leading-7 text-cyan-400">Spiel des Tages</h2>
            <p class="mt-2 font-bold tracking-tight text-white text-fluid-heading">Unsere Empfehlung für dich</p>
        </div>
        <div id="featured-game-card" class="text-center p-4">
            </div>
    </div>
</div>
        </section>
     <section id="search-users" class="page-section py-12 fade-in">
    <div class="container mx-auto px-6">
        <h2 data-i18n="community_title" class="font-bold text-white mb-4 text-center text-fluid-heading"></h2>
        <p data-i18n="community_subtitle" class="text-gray-400 text-center mb-8"></p>

        <div id="community-tabs" class="border-b border-gray-700 mb-8 flex justify-start sm:justify-center gap-6 overflow-x-auto whitespace-nowrap">
            <button data-i18n="community_tab_discover" data-target="community-content-suche" class="community-tab-btn font-semibold pb-3 border-b-2"></button>
            <button data-i18n="community_tab_feed" data-target="community-content-feed" class="community-tab-btn font-semibold pb-3 border-b-2"></button>
        </div>

        <div id="community-tab-content-container">
            <div id="community-content-suche" class="community-tab-content">
                <div class="max-w-md mx-auto mb-8">
                    <input type="search" id="user-search-filter" data-i18n="[placeholder]community_search_placeholder" class="w-full bg-gray-900 border border-gray-600 rounded-lg p-3 focus:outline-none focus:ring-2 focus:ring-blue-500 text-gray-50">
                </div>
                <div id="user-list" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6"></div>
                <div data-i18n="community_no_users_found" id="user-list-empty" class="hidden text-center text-gray-500 py-10"></div>
            </div>

            <div id="community-content-feed" class="community-tab-content hidden">
                <div id="activity-feed-list" class="max-w-3xl mx-auto space-y-4">
                </div>
            </div>
        </div>
    </div>
</section>
        <section id="matchmaker" class="page-section py-12 fade-in">
    <div class="container mx-auto px-6">
        <div class="bg-gray-800 border border-gray-700 rounded-xl p-4 md:p-8 max-w-3xl mx-auto shadow-2xl shadow-blue-900/20">
            <div id="ai-chat-window" class="h-[70vh] flex flex-col">
                <div class="flex-grow p-4 space-y-6 overflow-y-auto" id="chat-log"></div>
                <div id="user-input-area" class="p-4 border-t border-gray-700"></div>
            </div>
            <div id="matchmaker-result" class="hidden text-center fade-in p-4">
                <h2 data-i18n="matchmaker_result_title" class="text-3xl font-bold text-white mb-2"></h2>
                <div class="bg-gray-900 p-6 rounded-xl border border-gray-700">
                    <img id="result-img" src="https://placehold.co/600x400/111827/06B6D4?text=GAME" data-i18n="[alt]matchmaker_alt_game_cover" class="w-full mb-4 rounded-lg" loading="lazy" decoding="async">
                    <h3 id="result-title" class="text-4xl font-bold text-cyan-400">Game Title</h3>
                    <p id="result-description" class="text-lg text-gray-100 mt-4 mb-4"></p>
                    <div id="result-affiliate-links" class="mt-6 flex flex-col sm:flex-row gap-3">
                </div>
                </div>
                <button data-i18n="matchmaker_reset_button" id="reset-quiz" class="mt-8 text-gray-400 hover:text-white underline"></button>
            </div>
        </div>
    </div>
</section>
        <section id="chat-view" class="page-section py-12 fade-in">
    <div class="container mx-auto px-6 max-w-4xl">
        <div class="bg-gray-800 border border-gray-700 rounded-xl shadow-2xl flex flex-col h-[80vh]">
            
            <div class="p-4 border-b border-gray-700 flex items-center gap-4">
                <a href="#profile" class="text-gray-400 hover:text-white nav-trigger">&larr; Zurück</a>
                <img id="chat-friend-avatar" src="https://i.pravatar.cc/40" class="w-10 h-10 rounded-full object-cover">
                <h2 id="chat-friend-name" class="text-xl font-bold text-white">Lade...</h2>
            </div>

            <div id="chat-log-messages" class="flex-grow p-4 space-y-4 overflow-y-auto">
                </div>

            <div class="p-4 border-t border-gray-700">
                <form id="chat-form" class="flex gap-2">
                    <input type="text" id="chat-message-input" placeholder="Nachricht schreiben..." class="flex-grow bg-gray-900 border border-gray-600 rounded-lg p-3 focus:outline-none focus:ring-2 focus:ring-blue-500 text-gray-50" required>
                    <button type="submit" class="bg-blue-600 text-white font-semibold px-6 rounded-lg hover:bg-blue-500 transition-colors">Senden</button>
                </form>
            </div>

        </div>
    </div>
</section>
        <section id="profile" class="page-section py-12 fade-in">
    <div class="container mx-auto px-6 max-w-5xl">
        <div class="bg-gray-800 border border-gray-700 rounded-xl p-4 md:p-8 w-full mx-auto shadow-2xl">
            <div class="flex flex-col items-center mb-6">
                <img id="profile-avatar" src="https://i.pravatar.cc/150?u=placeholder" class="w-24 h-24 rounded-full border-2 border-cyan-400 object-cover mb-4" data-i18n="[alt]profile_alt_avatar">
                <div class="flex items-center justify-center gap-2">
                    <h2 id="profile-user-username" class="text-3xl font-bold text-white"></h2>
                    <button id="edit-username-btn" class="text-gray-400 hover:text-white">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.536L16.732 3.732z" /></svg>
                    </button>
                </div>
                <label for="avatar-upload" data-i18n="profile_change_avatar" class="mt-2 text-sm text-cyan-400 cursor-pointer hover:underline"></label>
                <input type="file" id="avatar-upload" class="hidden" accept="image/png, image/jpeg">
            </div>

            <div id="profile-tabs" class="border-b border-gray-700 mb-6 flex justify-start sm:justify-center gap-6 overflow-x-auto whitespace-nowrap">
                <button data-i18n="profile_tab_games" data-target="profile-content-spiele" class="profile-tab-btn font-semibold pb-3 border-b-2"></button>
                <button data-i18n="profile_tab_friends" data-target="profile-content-freunde" class="profile-tab-btn font-semibold pb-3 border-b-2"></button>
                <button data-i18n="profile_tab_stats" data-target="profile-content-stats" class="profile-tab-btn font-semibold pb-3 border-b-2"></button>
                <button data-i18n="profile_tab_lfg" data-target="profile-content-mitspieler" class="profile-tab-btn font-semibold pb-3 border-b-2"></button>
                <button data-i18n="profile_tab_news" data-target="profile-content-news" class="profile-tab-btn font-semibold pb-3 border-b-2"></button>

            </div>

<div id="profile-tab-content-container">

    <div id="profile-content-spiele" class="profile-tab-content">
        <div id="game-filter-buttons" class="flex justify-center gap-4 mb-6">
            <button data-i18n="profile_filter_all" data-filter="all" class="filter-btn active"></button>
            <button data-i18n="profile_filter_liked" data-filter="liked" class="filter-btn"></button>
            <button data-i18n="profile_filter_disliked" data-filter="disliked" class="filter-btn"></button>
        </div>
        <div id="saved-games-list" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"></div>
        <p data-i18n="profile_no_saved_games" id="no-saved-games" class="hidden text-center text-gray-500 py-8"></p>
        <div id="load-more-container" class="text-center mt-8"></div>
    </div>

    <div id="profile-content-mitspieler" class="profile-tab-content space-y-6">
        <div id="mitspieler-gamelist-view">
            <h3 data-i18n="profile_lfg_title" class="text-xl font-bold text-white mb-4"></h3>
            <div id="mitspieler-gamelist" class="space-y-3"></div>
        </div>
        <div id="mitspieler-results-view" class="hidden">
            <button data-i18n="profile_lfg_back_button" id="back-to-gamelist-btn" class="mb-4 text-cyan-400 hover:underline"></button>
            <h3 id="mitspieler-results-title" class="text-xl font-bold text-white mb-4"></h3>
            <div id="mitspieler-results-list" class="space-y-3"></div>
        </div>
    </div>

    <div id="profile-content-freunde" class="profile-tab-content">
    <div id="friend-requests-section" class="hidden">
        <h3 data-i18n="profile_friend_requests_title" class="text-xl font-bold text-white mb-4"></h3>
        <div id="friend-requests-list" class="space-y-3 mb-8"></div>
    </div>
    <div>
        <h3 data-i18n="profile_friends_list_title" class="text-xl font-bold text-white mb-4"></h3>
        <div id="friends-list" class="space-y-3"></div>
    </div>
</div>

    <div id="profile-content-stats" class="profile-tab-content text-center active">
        <div class="flex flex-col sm:flex-row items-center justify-center gap-4 sm:gap-8 text-lg">
            <div class="bg-gray-900 p-4 rounded-lg text-center">
                <span class="block font-bold text-2xl text-yellow-400" id="profile-user-rank">...</span>
                <span data-i18n="profile_stat_rank" class="text-gray-400"></span>
            </div>
            <div class="bg-gray-900 p-4 rounded-lg text-center">
                <span class="block font-bold text-2xl text-yellow-400" id="profile-user-level">...</span>
                <span data-i18n="profile_stat_level" class="text-gray-400"></span>
            </div>
            <div class="bg-gray-900 p-4 rounded-lg text-center">
                <span class="block font-bold text-2xl text-yellow-400" id="profile-user-xp">...</span>
                <span data-i18n="profile_stat_xp" class="text-gray-400"></span>
            </div>
        </div>
        <div class="mt-8 max-w-md mx-auto">
            <div class="flex justify-between text-sm text-gray-400 mb-1">
                <span id="progress-current-xp">0 XP</span>
                <span id="progress-next-level-xp">100 XP</span>
            </div>
            <div class="w-full bg-gray-700 rounded-full h-2.5">
                <div id="progress-bar-fill" class="bg-cyan-400 h-2.5 rounded-full transition-all duration-500" style="width: 0%"></div>
            </div>
        </div>
        <div id="referral-container" class="hidden mt-8 mx-auto max-w-md p-4 bg-gray-900/50 border border-cyan-700/50 rounded-lg">
            <h4 class="font-bold text-cyan-300 text-lg">Dein Empfehlungscode</h4>
            <p class="text-gray-300 mt-2">Teile diesen Code mit Freunden. Für jede erfolgreiche Anmeldung über deinen Code kommst du im nächsten Giveaway einen Schritt näher an den Hauptpreis!</p>
            <div class="mt-4 flex items-center justify-center bg-gray-800 border border-gray-600 rounded-lg p-3">
                <span id="referral-code" class="text-2xl font-mono text-white tracking-widest">LADE...</span>
                <button id="copy-referral-code" class="ml-4 bg-cyan-600 text-white px-3 py-1 rounded-md hover:bg-cyan-500 text-sm">Kopieren</button>
            </div>
            <p class="text-yellow-400 mt-3 font-semibold">Anmeldungen über deinen Code: <span id="referral-count">0</span></p>
        </div>
        <div id="daily-challenge-container" class="hidden mt-8 mx-auto max-w-md p-4 bg-yellow-900/50 border border-yellow-700 rounded-lg">
            <h4 data-i18n="daily_mission_title" class="font-bold text-yellow-300 text-lg"></h4>
            <p id="daily-challenge-text" class="text-yellow-200 mt-1"></p>
        </div>
    </div>

    <div id="profile-content-news" class="profile-tab-content space-y-4">
        </div>

</div>
                </div>
            </div>
        </div>
    </div>
</section>
        <section id="leaderboard" class="page-section py-12 fade-in">
    <div class="container mx-auto px-6 max-w-5xl">
        <h2 data-i18n="leaderboard_title" class="font-bold text-white mb-4 text-center text-fluid-heading"></h2>
        <div class="bg-gray-800 border border-gray-700 rounded-xl p-4 md:p-8 max-w-3xl mx-auto shadow-2xl">
            <p data-i18n="leaderboard_subtitle" class="text-gray-400 mb-6"></p>
            
            <div id="leaderboard-list" class="space-y-2">
            </div>
        </div>
    </div>
</section>
<section id="news" class="page-section py-12 fade-in">
    <div class="container mx-auto px-6 max-w-4xl">
        <h2 data-i18n="news_title" class="font-bold text-white mb-8 text-center text-fluid-heading"></h2>

        <div id="news-post-list" class="space-y-12">
            <p data-i18n="news_loading" class="text-center text-gray-400"></p>
        </div>
    </div>
</section>
<section id="partners" class="page-section py-12 fade-in">
    <div class="container mx-auto px-6 max-w-5xl">
        <div class="text-center mb-12">
            <h2 data-i18n="partners_title" class="font-bold text-white text-fluid-heading">Unsere Partner</h2>
            <p data-i18n="partners_subtitle" class="text-gray-400 mt-4 max-w-2xl mx-auto">Ein großes Dankeschön an die Communities und Projekte, die GameMatch unterstützen und mit denen wir zusammenarbeiten.</p>
        </div>

        <div id="partner-list" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-8">
            </div>
    </div>
</section>
<section id="impressum" class="page-section py-12 fade-in">
  <div class="container mx-auto px-6 max-w-4xl text-gray-300">
    <h2 class="text-3xl font-bold text-white mb-6 text-center">Impressum</h2>
    <p><strong>Betreiber der Seite:</strong><br>
    Daniel Garcia<br>
    6845 Hohenems<br>
    E-Mail: <a href="mailto:aspireaut@gmail.com" class="text-cyan-400 hover:underline">aspireaut@gmail.com</a></p>

    <p class="mt-4">Verantwortlich gemäß § 5 TMG.</p>
  </div>
</section>

<section id="datenschutz" class="page-section py-12 fade-in">
<h1>Datenschutzerklärung</h1>
<h2 id="m716">Präambel</h2>
<p>Mit der folgenden Datenschutzerklärung möchten wir Sie darüber aufklären, welche Arten Ihrer personenbezogenen Daten (nachfolgend auch kurz als "Daten" bezeichnet) wir zu welchen Zwecken und in welchem Umfang verarbeiten. Die Datenschutzerklärung gilt für alle von uns durchgeführten Verarbeitungen personenbezogener Daten, sowohl im Rahmen der Erbringung unserer Leistungen als auch insbesondere auf unseren Webseiten, in mobilen Applikationen sowie innerhalb externer Onlinepräsenzen, wie z. B. unserer Social-Media-Profile (nachfolgend zusammenfassend bezeichnet als "Onlineangebot").</p>
<p>Die verwendeten Begriffe sind nicht geschlechtsspezifisch.</p>

<p>Stand: 16. Juli 2025</p><h2>Inhaltsübersicht</h2> <ul class="index"><li><a class="index-link" href="#m716">Präambel</a></li><li><a class="index-link" href="#m3">Verantwortlicher</a></li><li><a class="index-link" href="#mOverview">Übersicht der Verarbeitungen</a></li><li><a class="index-link" href="#m2427">Maßgebliche Rechtsgrundlagen</a></li><li><a class="index-link" href="#m27">Sicherheitsmaßnahmen</a></li><li><a class="index-link" href="#m25">Übermittlung von personenbezogenen Daten</a></li><li><a class="index-link" href="#m24">Internationale Datentransfers</a></li><li><a class="index-link" href="#m12">Allgemeine Informationen zur Datenspeicherung und Löschung</a></li><li><a class="index-link" href="#m10">Rechte der betroffenen Personen</a></li><li><a class="index-link" href="#m225">Bereitstellung des Onlineangebots und Webhosting</a></li><li><a class="index-link" href="#m134">Einsatz von Cookies</a></li><li><a class="index-link" href="#m367">Registrierung, Anmeldung und Nutzerkonto</a></li><li><a class="index-link" href="#m432">Community Funktionen</a></li><li><a class="index-link" href="#m451">Single-Sign-On-Anmeldung</a></li><li><a class="index-link" href="#m182">Kontakt- und Anfrageverwaltung</a></li><li><a class="index-link" href="#m237">Gewinnspiele und Wettbewerbe</a></li><li><a class="index-link" href="#m263">Webanalyse, Monitoring und Optimierung</a></li><li><a class="index-link" href="#m264">Onlinemarketing</a></li><li><a class="index-link" href="#m135">Affiliate-Programme und Affiliate-Links</a></li><li><a class="index-link" href="#m299">Kundenrezensionen und Bewertungsverfahren</a></li><li><a class="index-link" href="#m328">Plug-ins und eingebettete Funktionen sowie Inhalte</a></li></ul><h2 id="m3">Verantwortlicher</h2><p>Daniel Garcia<br>GameMatch.eu<br>6845 Hohenems</p>
<p>E-Mail-Adresse: <a href="mailto:gamematcheu@gmail.com">gamematcheu@gmail.com</a></p>

<h2 id="mOverview">Übersicht der Verarbeitungen</h2><p>Die nachfolgende Übersicht fasst die Arten der verarbeiteten Daten und die Zwecke ihrer Verarbeitung zusammen und verweist auf die betroffenen Personen.</p><h3>Arten der verarbeiteten Daten</h3>
<ul><li>Bestandsdaten.</li><li>Kontaktdaten.</li><li>Inhaltsdaten.</li><li>Vertragsdaten.</li><li>Nutzungsdaten.</li><li>Meta-, Kommunikations- und Verfahrensdaten.</li><li>Protokolldaten.</li></ul><h3>Kategorien betroffener Personen</h3><ul><li>Leistungsempfänger und Auftraggeber.</li><li>Interessenten.</li><li>Kommunikationspartner.</li><li>Nutzer.</li><li>Gewinnspiel- und Wettbewerbsteilnehmer.</li></ul><h3>Zwecke der Verarbeitung</h3><ul><li>Erbringung vertraglicher Leistungen und Erfüllung vertraglicher Pflichten.</li><li>Kommunikation.</li><li>Sicherheitsmaßnahmen.</li><li>Reichweitenmessung.</li><li>Tracking.</li><li>Zielgruppenbildung.</li><li>Affiliate-Nachverfolgung.</li><li>Organisations- und Verwaltungsverfahren.</li><li>Durchführung von Gewinnspielen und Wettbewerben.</li><li>Feedback.</li><li>Marketing.</li><li>Profile mit nutzerbezogenen Informationen.</li><li>Anmeldeverfahren.</li><li>Bereitstellung unseres Onlineangebotes und Nutzerfreundlichkeit.</li><li>Informationstechnische Infrastruktur.</li></ul><h2 id="m2427">Maßgebliche Rechtsgrundlagen</h2>
<p><strong>Maßgebliche Rechtsgrundlagen nach der DSGVO: </strong>
Im Folgenden erhalten Sie eine Übersicht der Rechtsgrundlagen der DSGVO, auf deren Basis wir personenbezogene Daten verarbeiten. Bitte nehmen Sie zur Kenntnis, dass neben den Regelungen der DSGVO nationale Datenschutzvorgaben in Ihrem bzw. unserem Wohn- oder Sitzland gelten können. Sollten ferner im Einzelfall speziellere Rechtsgrundlagen maßgeblich sein, teilen wir Ihnen diese in der Datenschutzerklärung mit.</p>
 
<ul><li><strong>Einwilligung (Art. 6 Abs. 1 S. 1 lit. a) DSGVO)</strong> 
- Die betroffene Person hat ihre Einwilligung in die Verarbeitung der sie betreffenden personenbezogenen Daten für einen spezifischen Zweck oder mehrere bestimmte Zwecke gegeben.</li>
<li><strong>Vertragserfüllung und vorvertragliche Anfragen (Art. 6 Abs. 1 S. 1 lit. b) DSGVO)</strong> 
- Die Verarbeitung ist für die Erfüllung eines Vertrags, dessen Vertragspartei die betroffene Person ist, oder zur Durchführung vorvertraglicher Maßnahmen erforderlich, die auf Anfrage der betroffenen Person erfolgen.</li>
<li><strong>Berechtigte Interessen (Art. 6 Abs. 1 S. 1 lit. f) DSGVO)</strong> 
- die Verarbeitung ist zur Wahrung der berechtigten Interessen des Verantwortlichen oder eines Dritten notwendig, vorausgesetzt, dass die Interessen, Grundrechte und Grundfreiheiten der betroffenen Person, die den Schutz personenbezogener Daten verlangen, nicht überwiegen.</li></ul>
<p><strong>Nationale Datenschutzregelungen in Deutschland: </strong>
Zusätzlich zu den Datenschutzregelungen der DSGVO gelten nationale Regelungen zum Datenschutz in Deutschland. Hierzu gehört insbesondere das Gesetz zum Schutz vor Missbrauch personenbezogener Daten bei der Datenverarbeitung (Bundesdatenschutzgesetz – BDSG). Das BDSG enthält insbesondere Spezialregelungen zum Recht auf Auskunft, zum Recht auf Löschung, zum Widerspruchsrecht, zur Verarbeitung besonderer Kategorien personenbezogener Daten, zur Verarbeitung für andere Zwecke und zur Übermittlung sowie automatisierten Entscheidungsfindung im Einzelfall einschließlich Profiling. Ferner können Landesdatenschutzgesetze der einzelnen Bundesländer zur Anwendung gelangen.</p>
<p><strong>Nationale Datenschutzregelungen in Österreich: </strong>
Zusätzlich zu den Datenschutzregelungen der DSGVO gelten nationale Regelungen zum Datenschutz in Österreich. Hierzu gehört insbesondere das Bundesgesetz zum Schutz natürlicher Personen bei der Verarbeitung personenbezogener Daten (Datenschutzgesetz – DSG). Das Datenschutzgesetz enthält insbesondere Spezialregelungen zum Recht auf Auskunft, zum Recht auf Richtigstellung oder Löschung, zur Verarbeitung besonderer Kategorien personenbezogener Daten, zur Verarbeitung für andere Zwecke und zur Übermittlung sowie zur automatisierten Entscheidungsfindung im Einzelfall.</p>
<p><strong>Maßgebliche Rechtsgrundlagen nach dem Schweizer Datenschutzgesetz: </strong>
Wenn Sie sich in der Schweiz befinden, bearbeiten wir Ihre Daten auf Grundlage des Bundesgesetzes über den Datenschutz (kurz „Schweizer DSG"). Anders als beispielsweise die DSGVO sieht das Schweizer DSG grundsätzlich nicht vor, dass eine Rechtsgrundlage für die Bearbeitung der Personendaten genannt werden muss und die Bearbeitung von Personendaten nach Treu und Glauben durchgeführt wird, rechtmäßig und verhältnismäßig ist (Art. 6 Abs. 1 und 2 des Schweizer DSG). Zudem werden Personendaten von uns nur zu einem bestimmten, für die betroffene Person erkennbaren Zweck beschafft und nur so bearbeitet, wie es mit diesem Zweck vereinbar ist (Art. 6 Abs. 3 des Schweizer DSG).</p>

<p><strong>Hinweis auf Geltung DSGVO und Schweizer DSG: </strong>Diese Datenschutzhinweise dienen sowohl der Informationserteilung nach dem Schweizer DSG als auch nach der Datenschutzgrundverordnung (DSGVO). Aus diesem Grund bitten wir Sie zu beachten, dass aufgrund der breiteren räumlichen Anwendung und Verständlichkeit die Begriffe der DSGVO verwendet werden. Insbesondere statt der im Schweizer DSG verwendeten Begriffe „Bearbeitung" von „Personendaten", "überwiegendes Interesse" und "besonders schützenswerte Personendaten" werden die in der DSGVO verwendeten Begriffe „Verarbeitung" von „personenbezogenen Daten" sowie "berechtigtes Interesse" und "besondere Kategorien von Daten" verwendet. Die gesetzliche Bedeutung der Begriffe wird jedoch im Rahmen der Geltung des Schweizer DSG weiterhin nach dem Schweizer DSG bestimmt.</p>

<h2 id="m27">Sicherheitsmaßnahmen</h2><p>Wir treffen nach Maßgabe der gesetzlichen Vorgaben unter Berücksichtigung des Stands der Technik, der Implementierungskosten und der Art, des Umfangs, der Umstände und der Zwecke der Verarbeitung sowie der unterschiedlichen Eintrittswahrscheinlichkeiten und des Ausmaßes der Bedrohung der Rechte und Freiheiten natürlicher Personen geeignete technische und organisatorische Maßnahmen, um ein dem Risiko angemessenes Schutzniveau zu gewährleisten.</p>
<p>Zu den Maßnahmen gehören insbesondere die Sicherung der Vertraulichkeit, Integrität und Verfügbarkeit von Daten durch Kontrolle des physischen und elektronischen Zugangs zu den Daten als auch des sie betreffenden Zugriffs, der Eingabe, der Weitergabe, der Sicherung der Verfügbarkeit und ihrer Trennung. Des Weiteren haben wir Verfahren eingerichtet, die eine Wahrnehmung von Betroffenenrechten, die Löschung von Daten und Reaktionen auf die Gefährdung der Daten gewährleisten. Ferner berücksichtigen wir den Schutz personenbezogener Daten bereits bei der Entwicklung bzw. Auswahl von Hardware, Software sowie Verfahren entsprechend dem Prinzip des Datenschutzes, durch Technikgestaltung und durch datenschutzfreundliche Voreinstellungen.</p>

<h2 id="m25">Übermittlung von personenbezogenen Daten</h2><p>Im Rahmen unserer Verarbeitung von personenbezogenen Daten kommt es vor, dass diese an andere Stellen, Unternehmen, rechtlich selbstständige Organisationseinheiten oder Personen übermittelt beziehungsweise ihnen gegenüber offengelegt werden. Zu den Empfängern dieser Daten können z. B. mit IT-Aufgaben beauftragte Dienstleister gehören oder Anbieter von Diensten und Inhalten, die in eine Website eingebunden sind. In solchen Fällen beachten wir die gesetzlichen Vorgaben und schließen insbesondere entsprechende Verträge bzw. Vereinbarungen, die dem Schutz Ihrer Daten dienen, mit den Empfängern Ihrer Daten ab.</p>

<h2 id="m24">Internationale Datentransfers</h2><p>Datenverarbeitung in Drittländern: Sofern wir Daten in ein Drittland (d. h. außerhalb der Europäischen Union (EU) oder des Europäischen Wirtschaftsraums (EWR)) übermitteln oder dies im Rahmen der Nutzung von Diensten Dritter oder der Offenlegung bzw. Übermittlung von Daten an andere Personen, Stellen oder Unternehmen geschieht (was erkennbar wird anhand der Postadresse des jeweiligen Anbieters oder wenn in der Datenschutzerklärung ausdrücklich auf den Datentransfer in Drittländer hingewiesen wird), erfolgt dies stets im Einklang mit den gesetzlichen Vorgaben.</p>
<p>Für Datenübermittlungen in die USA stützen wir uns vorrangig auf das Data Privacy Framework (DPF), welches durch einen Angemessenheitsbeschluss der EU-Kommission vom 10.07.2023 als sicherer Rechtsrahmen anerkannt wurde. Zusätzlich haben wir mit den jeweiligen Anbietern Standardvertragsklauseln abgeschlossen, die den Vorgaben der EU-Kommission entsprechen und vertragliche Verpflichtungen zum Schutz Ihrer Daten festlegen.</p>
<p>Diese zweifache Absicherung gewährleistet einen umfassenden Schutz Ihrer Daten: Das DPF bildet die primäre Schutzebene, während die Standardvertragsklauseln als zusätzliche Sicherheit dienen. Sollten sich Änderungen im Rahmen des DPF ergeben, greifen die Standardvertragsklauseln als zuverlässige Rückfalloption ein. So stellen wir sicher, dass Ihre Daten auch bei etwaigen politischen oder rechtlichen Veränderungen stets angemessen geschützt bleiben.</p>
<p>Bei den einzelnen Diensteanbietern informieren wir Sie darüber, ob sie nach dem DPF zertifiziert sind und ob Standardvertragsklauseln vorliegen. Weitere Informationen zum DPF und eine Liste der zertifizierten Unternehmen finden Sie auf der Website des US-Handelsministeriums unter <a href="https://www.dataprivacyframework.gov/" target="_blank">https://www.dataprivacyframework.gov/</a> (in englischer Sprache).</p>
<p>Für Datenübermittlungen in andere Drittländer gelten entsprechende Sicherheitsmaßnahmen, insbesondere Standardvertragsklauseln, ausdrückliche Einwilligungen oder gesetzlich erforderliche Übermittlungen. Informationen zu Drittlandtransfers und geltenden Angemessenheitsbeschlüssen können Sie dem Informationsangebot der EU-Kommission entnehmen: <a href="https://commission.europa.eu/law/law-topic/data-protection/international-dimension-data-protection_en?prefLang=de" target="_blank">https://commission.europa.eu/law/law-topic/data-protection/international-dimension-data-protection_en?prefLang=de.</a></p>
<p>Bekanntgabe von Personendaten ins Ausland: Gemäß dem Schweizer DSG geben wir personenbezogene Daten nur dann ins Ausland bekannt, wenn ein angemessener Schutz der betroffenen Personen gewährleistet ist (Art. 16 Schweizer DSG). Sofern der Bundesrat keinen angemessenen Schutz festgestellt hat (Liste: <a href="https://www.bj.admin.ch/bj/de/home/staat/datenschutz/internationales/anerkennung-staaten.html" target="_blank">https://www.bj.admin.ch/bj/de/home/staat/datenschutz/internationales/anerkennung-staaten.html</a>), ergreifen wir alternative Sicherheitsmaßnahmen.</p>
<p>Für Datenübermittlungen in die USA stützen wir uns vorrangig auf das Data Privacy Framework (DPF), welches durch einen Angemessenheitsbeschluss der Schweiz vom 07.06.2024 als sicherer Rechtsrahmen anerkannt wurde. Zusätzlich haben wir mit den jeweiligen Anbietern Standarddatenschutzklauseln abgeschlossen, die von der Eidgenössischen Datenschutz- und Öffentlichkeitsbeauftragten (EDÖB) genehmigt wurden und vertragliche Verpflichtungen zum Schutz Ihrer Daten festlegen.</p>
<p>Diese zweifache Absicherung gewährleistet einen umfassenden Schutz Ihrer Daten: Das DPF bildet die primäre Schutzebene, während die Standarddatenschutzklauseln als zusätzliche Sicherheit dienen. Sollten sich Änderungen im Rahmen des DPF ergeben, greifen die Standarddatenschutzklauseln als zuverlässige Rückfalloption ein. So stellen wir sicher, dass Ihre Daten auch bei etwaigen politischen oder rechtlichen Veränderungen stets angemessen geschützt bleiben.</p>
<p>Bei den einzelnen Diensteanbietern informieren wir Sie darüber, ob sie nach dem DPF zertifiziert sind und ob Standarddatenschutzklauseln vorliegen. Die Liste der zertifizierten Unternehmen sowie weitere Informationen zum DPF finden Sie auf der Website des US-Handelsministeriums unter <a href="https://www.dataprivacyframework.gov/" target="_blank">https://www.dataprivacyframework.gov/</a> (in englischer Sprache).</p>
<p>Für Datenübermittlungen in andere Drittländer gelten entsprechende Sicherheitsmaßnahmen, einschließlich internationaler Verträge, spezifischer Garantien, von der EDÖB genehmigter Standarddatenschutzklauseln oder von der EDÖB oder einer zuständigen Datenschutzbehörde eines anderen Landes vorab anerkannter unternehmensinterner Datenschutzvorschriften.</p>

<h2 id="m12">Allgemeine Informationen zur Datenspeicherung und Löschung</h2><p>Wir löschen personenbezogene Daten, die wir verarbeiten, gemäß den gesetzlichen Bestimmungen, sobald die zugrundeliegenden Einwilligungen widerrufen werden oder keine weiteren rechtlichen Grundlagen für die Verarbeitung bestehen. Dies betrifft Fälle, in denen der ursprüngliche Verarbeitungszweck entfällt oder die Daten nicht mehr benötigt werden. Ausnahmen von dieser Regelung bestehen, wenn gesetzliche Pflichten oder besondere Interessen eine längere Aufbewahrung oder Archivierung der Daten erfordern.</p>
<p>Insbesondere müssen Daten, die aus handels- oder steuerrechtlichen Gründen aufbewahrt werden müssen oder deren Speicherung notwendig ist zur Rechtsverfolgung oder zum Schutz der Rechte anderer natürlicher oder juristischer Personen, entsprechend archiviert werden.</p>
<p>Unsere Datenschutzhinweise enthalten zusätzliche Informationen zur Aufbewahrung und Löschung von Daten, die speziell für bestimmte Verarbeitungsprozesse gelten.</p>
<p>Bei mehreren Angaben zur Aufbewahrungsdauer oder Löschungsfristen eines Datums, ist stets die längste Frist maßgeblich. Daten, die nicht mehr für den ursprünglich vorgesehenen Zweck, sondern aufgrund gesetzlicher Vorgaben oder anderer Gründe aufbewahrt werden, verarbeiten wir ausschließlich zu den Gründen, die ihre Aufbewahrung rechtfertigen.</p>
<p>Aufbewahrung und Löschung von Daten: Die folgenden allgemeinen Fristen gelten für die Aufbewahrung und Archivierung nach deutschem Recht:</p><ul> <li>10 Jahre - Aufbewahrungsfrist für Bücher und Aufzeichnungen, Jahresabschlüsse, Inventare, Lageberichte, Eröffnungsbilanz sowie die zu ihrem Verständnis erforderlichen Arbeitsanweisungen und sonstigen Organisationsunterlagen (§ 147 Abs. 1 Nr. 1 i.V.m. Abs. 3 AO, § 14b Abs. 1 UStG, § 257 Abs. 1 Nr. 1 i.V.m. Abs. 4 HGB).</li><li>8 Jahre - Buchungsbelege, wie z. B. Rechnungen und Kostenbelege (§ 147 Abs. 1 Nr. 4 und 4a i.V.m. Abs. 3 Satz 1 AO sowie § 257 Abs. 1 Nr. 4 i.V.m. Abs. 4 HGB).</li><li>6 Jahre - Übrige Geschäftsunterlagen: empfangene Handels- oder Geschäftsbriefe, Wiedergaben der abgesandten Handels- oder Geschäftsbriefe, sonstige Unterlagen, soweit sie für die Besteuerung von Bedeutung sind, z. B. Stundenlohnzettel, Betriebsabrechnungsbögen, Kalkulationsunterlagen, Preisauszeichnungen, aber auch Lohnabrechnungsunterlagen, soweit sie nicht bereits Buchungsbelege sind und Kassenstreifen (§ 147 Abs. 1 Nr. 2, 3, 5 i.V.m. Abs. 3 AO, § 257 Abs. 1 Nr. 2 u. 3 i.V.m. Abs. 4 HGB).</li><li>3 Jahre - Daten, die erforderlich sind, um potenzielle Gewährleistungs- und Schadensersatzansprüche oder ähnliche vertragliche Ansprüche und Rechte zu berücksichtigen sowie damit verbundene Anfragen zu bearbeiten, basierend auf früheren Geschäftserfahrungen und üblichen Branchenpraktiken, werden für die Dauer der regulären gesetzlichen Verjährungsfrist von drei Jahren gespeichert (§§ 195, 199 BGB).</li> </ul>
<p>Aufbewahrung und Löschung von Daten: Die folgenden allgemeinen Fristen gelten gemäß österreichischem Recht für die Aufbewahrung und Archivierung: </p><ul> <li>10 Jahre - Aufbewahrungsfrist für Bücher und Aufzeichnungen, Jahresabschlüsse, Inventare, Lageberichte, Eröffnungsbilanzen, Buchungsbelege und Rechnungen sowie alle erforderlichen Arbeitsanweisungen und sonstigen Organisationsunterlagen (Bundesabgabenordnung (BAO §132), Unternehmensgesetzbuch (UGB §§190-212)).</li><li>6 Jahre - Sonstige Geschäftsunterlagen: Erhaltene Handels- oder Geschäftsbriefe, Kopien der versendeten Handels- oder Geschäftsbriefe und andere Unterlagen, sofern sie für die Steuer relevant sind. Dazu gehören beispielsweise Stundenlohnscheine, Betriebsabrechnungsbögen, Kalkulationsunterlagen, Preisauszeichnungen und Lohnabrechnungsunterlagen, sofern sie nicht bereits Buchungsbelege und Kassenstreifen sind (Bundesabgabenordnung (BAO §132), Unternehmensgesetzbuch (UGB §§190-212)).</li><li>3 Jahre - Daten, die erforderlich sind, um potenzielle Gewährleistungs- und Schadensersatzansprüche oder ähnliche vertragliche Ansprüche und Rechte zu berücksichtigen sowie damit verbundene Anfragen zu bearbeiten, basierend auf früheren Geschäftserfahrungen und üblichen Branchenpraktiken, werden für die Dauer der regulären gesetzlichen Verjährungsfrist von drei Jahren gespeichert (§§ 1478, 1480 ABGB).</li> </ul>
<p>Aufbewahrung und Löschung von Daten: Die folgenden allgemeinen Fristen gelten für die Aufbewahrung und Archivierung nach dem Schweizer Recht:</p><ul> <li>10 Jahre - Aufbewahrungsfrist für Bücher und Aufzeichnungen, Jahresabschlüsse, Inventare, Lageberichte, Eröffnungsbilanzen, Buchungsbelege und Rechnungen sowie alle erforderlichen Arbeitsanweisungen und sonstigen Organisationsunterlagen (Art. 958f des Schweizerischen Obligationenrechts (OR)).</li><li>10 Jahre - Daten, die zur Berücksichtigung potenzieller Schadenersatzansprüche oder ähnlicher vertraglicher Ansprüche und Rechte notwendig sind, sowie für die Bearbeitung damit verbundener Anfragen, basierend auf früheren Geschäftserfahrungen und den üblichen Branchenpraktiken, werden für den Zeitraum der gesetzlichen Verjährungsfrist von zehn Jahren gespeichert, es sei denn, eine kürzere Frist von fünf Jahren ist maßgeblich, die in bestimmten Fällen einschlägig ist (Art. 127, 130 OR). Mit Ablauf von fünf Jahren verjähren die Forderungen für Miet-, Pacht- und Kapitalzinse sowie andere periodische Leistungen, aus Lieferung von Lebensmitteln, für Beköstigung und für Wirtsschulden, sowie aus Handwerksarbeit, Kleinverkauf von Waren, ärztlicher Besorgung, Berufsarbeiten von Anwälten, Rechtsagenten, Prokuratoren und Notaren und aus dem Arbeitsverhältnis von Arbeitnehmern (Art. 128 OR).</li> </ul>

<h2 id="m10">Rechte der betroffenen Personen</h2><p>Rechte der betroffenen Personen aus der DSGVO: Ihnen stehen als Betroffene nach der DSGVO verschiedene Rechte zu, die sich insbesondere aus Art. 15 bis 21 DSGVO ergeben:</p><ul><li><strong>Widerspruchsrecht: Sie haben das Recht, aus Gründen, die sich aus Ihrer besonderen Situation ergeben, jederzeit gegen die Verarbeitung der Sie betreffenden personenbezogenen Daten, die aufgrund von Art. 6 Abs. 1 lit. e oder f DSGVO erfolgt, Widerspruch einzulegen; dies gilt auch für ein auf diese Bestimmungen gestütztes Profiling. Werden die Sie betreffenden personenbezogenen Daten verarbeitet, um Direktwerbung zu betreiben, haben Sie das Recht, jederzeit Widerspruch gegen die Verarbeitung der Sie betreffenden personenbezogenen Daten zum Zwecke derartiger Werbung einzulegen; dies gilt auch für das Profiling, soweit es mit solcher Direktwerbung in Verbindung steht.</strong></li><li><strong>Widerrufsrecht bei Einwilligungen:</strong> Sie haben das Recht, erteilte Einwilligungen jederzeit zu widerrufen.</li><li><strong>Auskunftsrecht:</strong> Sie haben das Recht, eine Bestätigung darüber zu verlangen, ob betreffende Daten verarbeitet werden und auf Auskunft über diese Daten sowie auf weitere Informationen und Kopie der Daten entsprechend den gesetzlichen Vorgaben.</li><li><strong>Recht auf Berichtigung:</strong> Sie haben entsprechend den gesetzlichen Vorgaben das Recht, die Vervollständigung der Sie betreffenden Daten oder die Berichtigung der Sie betreffenden unrichtigen Daten zu verlangen.</li><li><strong>Recht auf Löschung und Einschränkung der Verarbeitung:</strong> Sie haben nach Maßgabe der gesetzlichen Vorgaben das Recht, zu verlangen, dass Sie betreffende Daten unverzüglich gelöscht werden, bzw. alternativ nach Maßgabe der gesetzlichen Vorgaben eine Einschränkung der Verarbeitung der Daten zu verlangen.</li><li><strong>Recht auf Datenübertragbarkeit:</strong> Sie haben das Recht, Sie betreffende Daten, die Sie uns bereitgestellt haben, nach Maßgabe der gesetzlichen Vorgaben in einem strukturierten, gängigen und maschinenlesbaren Format zu erhalten oder deren Übermittlung an einen anderen Verantwortlichen zu fordern.</li><li><strong>Beschwerde bei Aufsichtsbehörde:</strong> Sie haben unbeschadet eines anderweitigen verwaltungsrechtlichen oder gerichtlichen Rechtsbehelfs das Recht auf Beschwerde bei einer Aufsichtsbehörde, insbesondere in dem Mitgliedstaat ihres gewöhnlichen Aufenthaltsorts, ihres Arbeitsplatzes oder des Orts des mutmaßlichen Verstoßes, wenn Sie der Ansicht sind, dass die Verarbeitung der Sie betreffenden personenbezogenen Daten gegen die Vorgaben der DSGVO verstößt.</li></ul>
<p>Rechte der betroffenen Personen nach dem Schweizer DSG: </p>
<p>Ihnen stehen als betroffene Person nach Maßgabe der Vorgaben des Schweizer DSG die folgenden Rechte zu:</p><ul><li><strong>Recht auf Auskunft: </strong>Sie haben das Recht, eine Bestätigung darüber zu verlangen, ob Sie betreffende Personendaten verarbeitet werden, und auf Erhalt derjenigen Informationen, die erforderlich sind, damit Sie Ihre Rechte nach diesem Gesetz geltend machen können und eine transparente Datenbearbeitung gewährleistet ist.</li><li><strong>Recht auf Datenherausgabe oder -übertragung: </strong>Sie haben das Recht, die Herausgabe Ihrer Personendaten, die Sie uns bekanntgegeben haben, in einem gängigen elektronischen Format zu verlangen.</li><li><strong>Recht auf Berichtigung:</strong> Sie haben das Recht, die Berichtigung der Sie betreffenden unrichtigen Personendaten zu verlangen.</li><li><strong>Recht auf Widerspruch, Löschung und Vernichtung: </strong>Sie haben das Recht, der Verarbeitung Ihrer Daten zu widersprechen, sowie zu verlangen, dass die Sie betreffenden Personendaten gelöscht oder vernichtet werden.</li></ul>

<h2 id="m225">Bereitstellung des Onlineangebots und Webhosting</h2><p>Wir verarbeiten die Daten der Nutzer, um ihnen unsere Online-Dienste zur Verfügung stellen zu können. Zu diesem Zweck verarbeiten wir die IP-Adresse des Nutzers, die notwendig ist, um die Inhalte und Funktionen unserer Online-Dienste an den Browser oder das Endgerät der Nutzer zu übermitteln.</p>
<ul class="m-elements"><li><strong>Verarbeitete Datenarten:</strong> Nutzungsdaten (z. B. Seitenaufrufe und Verweildauer, Klickpfade, Nutzungsintensität und -frequenz, verwendete Gerätetypen und Betriebssysteme, Interaktionen mit Inhalten und Funktionen); Meta-, Kommunikations- und Verfahrensdaten (z. B. IP-Adressen, Zeitangaben, Identifikationsnummern, beteiligte Personen). Protokolldaten (z. B. Logfiles betreffend Logins oder den Abruf von Daten oder Zugriffszeiten.).</li><li><strong>Betroffene Personen:</strong> Nutzer (z. B. Webseitenbesucher, Nutzer von Onlinediensten).</li><li><strong>Zwecke der Verarbeitung:</strong> Bereitstellung unseres Onlineangebotes und Nutzerfreundlichkeit; Informationstechnische Infrastruktur (Betrieb und Bereitstellung von Informationssystemen und technischen Geräten (Computer, Server etc.)). Sicherheitsmaßnahmen.</li><li><strong>Aufbewahrung und Löschung:</strong> Löschung entsprechend Angaben im Abschnitt "Allgemeine Informationen zur Datenspeicherung und Löschung".</li><li class=""><strong>Rechtsgrundlagen:</strong> Berechtigte Interessen (Art. 6 Abs. 1 S. 1 lit. f) DSGVO).</li></ul><p><strong>Weitere Hinweise zu Verarbeitungsprozessen, Verfahren und Diensten:</strong></p><ul class="m-elements"><li><strong>Erhebung von Zugriffsdaten und Logfiles: </strong>Der Zugriff auf unser Onlineangebot wird in Form von sogenannten "Server-Logfiles" protokolliert. Zu den Serverlogfiles können die Adresse und der Name der abgerufenen Webseiten und Dateien, Datum und Uhrzeit des Abrufs, übertragene Datenmengen, Meldung über erfolgreichen Abruf, Browsertyp nebst Version, das Betriebssystem des Nutzers, Referrer URL (die zuvor besuchte Seite) und im Regelfall IP-Adressen und der anfragende Provider gehören. Die Serverlogfiles können zum einen zu Sicherheitszwecken eingesetzt werden, z. B. um eine Überlastung der Server zu vermeiden (insbesondere im Fall von missbräuchlichen Angriffen, sogenannten DDoS-Attacken), und zum anderen, um die Auslastung der Server und ihre Stabilität sicherzustellen; <span class=""><strong>Rechtsgrundlagen:</strong> Berechtigte Interessen (Art. 6 Abs. 1 S. 1 lit. f) DSGVO). </span><strong>Löschung von Daten:</strong> Logfile-Informationen werden für die Dauer von maximal 30 Tagen gespeichert und danach gelöscht oder anonymisiert. Daten, deren weitere Aufbewahrung zu Beweiszwecken erforderlich ist, sind bis zur endgültigen Klärung des jeweiligen Vorfalls von der Löschung ausgenommen.</li></ul>
<h2 id="m134">Einsatz von Cookies</h2><p>Unter dem Begriff „Cookies" werden Funktionen, die Informationen auf Endgeräten der Nutzer speichern und aus ihnen auslesen, verstanden. Cookies können ferner in Bezug auf unterschiedliche Anliegen Einsatz finden, etwa zu Zwecken der Funktionsfähigkeit, der Sicherheit und des Komforts von Onlineangeboten sowie der Erstellung von Analysen der Besucherströme. Wir verwenden Cookies gemäß den gesetzlichen Vorschriften. Dazu holen wir, wenn erforderlich, vorab die Zustimmung der Nutzer ein. Ist eine Zustimmung nicht notwendig, setzen wir auf unsere berechtigten Interessen. Dies gilt, wenn das Speichern und Auslesen von Informationen unerlässlich ist, um ausdrücklich angeforderte Inhalte und Funktionen bereitstellen zu können. Dazu zählen etwa die Speicherung von Einstellungen sowie die Sicherstellung der Funktionalität und Sicherheit unseres Onlineangebots. Die Einwilligung kann jederzeit widerrufen werden. Wir informieren klar über deren Umfang und welche Cookies genutzt werden.</p>
<p><strong>Hinweise zu datenschutzrechtlichen Rechtsgrundlagen: </strong>Ob wir personenbezogene Daten mithilfe von Cookies verarbeiten, hängt von einer Einwilligung ab. Liegt eine Einwilligung vor, dient sie als Rechtsgrundlage. Ohne Einwilligung stützen wir uns auf unsere berechtigten Interessen, die vorstehend in diesem Abschnitt und im Kontext der jeweiligen Dienste und Verfahren erläutert sind.</p>
<p><strong>Speicherdauer: </strong>Im Hinblick auf die Speicherdauer werden die folgenden Arten von Cookies unterschieden:</p><ul><li><strong>Temporäre Cookies (auch: Session- oder Sitzungscookies):</strong> Temporäre Cookies werden spätestens gelöscht, nachdem ein Nutzer ein Onlineangebot verlassen und sein Endgerät (z. B. Browser oder mobile Applikation) geschlossen hat.</li><li><strong>Permanente Cookies:</strong> Permanente Cookies bleiben auch nach dem Schließen des Endgeräts gespeichert. So können beispielsweise der Log-in-Status gespeichert und bevorzugte Inhalte direkt angezeigt werden, wenn der Nutzer eine Website erneut besucht. Ebenso können die mithilfe von Cookies erhobenen Nutzerdaten zur Reichweitenmessung Verwendung finden. Sofern wir Nutzern keine expliziten Angaben zur Art und Speicherdauer von Cookies mitteilen (z. B. im Rahmen der Einholung der Einwilligung), sollten sie davon ausgehen, dass diese permanent sind und die Speicherdauer bis zu zwei Jahre betragen kann.</li></ul><p><strong>Allgemeine Hinweise zum Widerruf und Widerspruch (Opt-out): </strong>Nutzer können die von ihnen abgegebenen Einwilligungen jederzeit widerrufen und zudem einen Widerspruch gegen die Verarbeitung entsprechend den gesetzlichen Vorgaben, auch mittels der Privatsphäre-Einstellungen ihres Browsers, erklären.</p>
<ul class="m-elements"><li><strong>Verarbeitete Datenarten:</strong> Meta-, Kommunikations- und Verfahrensdaten (z. B. IP-Adressen, Zeitangaben, Identifikationsnummern, beteiligte Personen).</li><li><strong>Betroffene Personen:</strong> Nutzer (z. B. Webseitenbesucher, Nutzer von Onlinediensten).</li><li class=""><strong>Rechtsgrundlagen:</strong> Berechtigte Interessen (Art. 6 Abs. 1 S. 1 lit. f) DSGVO). Einwilligung (Art. 6 Abs. 1 S. 1 lit. a) DSGVO).</li></ul><p><strong>Weitere Hinweise zu Verarbeitungsprozessen, Verfahren und Diensten:</strong></p><ul class="m-elements"><li><strong>Verarbeitung von Cookie-Daten auf Grundlage einer Einwilligung: </strong>Wir setzen eine Einwilligungs-Management-Lösung ein, bei der die Einwilligung der Nutzer zur Verwendung von Cookies oder zu den im Rahmen der Einwilligungs-Management-Lösung genannten Verfahren und Anbietern eingeholt wird. Dieses Verfahren dient der Einholung, Protokollierung, Verwaltung und dem Widerruf von Einwilligungen, insbesondere bezogen auf den Einsatz von Cookies und vergleichbaren Technologien, die zur Speicherung, zum Auslesen und zur Verarbeitung von Informationen auf den Endgeräten der Nutzer eingesetzt werden. Im Rahmen dieses Verfahrens werden die Einwilligungen der Nutzer für die Nutzung von Cookies und die damit verbundenen Verarbeitungen von Informationen, einschließlich der im Einwilligungs-Management-Verfahren genannten spezifischen Verarbeitungen und Anbieter, eingeholt. Die Nutzer haben zudem die Möglichkeit, ihre Einwilligungen zu verwalten und zu widerrufen. Die Einwilligungserklärungen werden gespeichert, um eine erneute Abfrage zu vermeiden und den Nachweis der Einwilligung gemäß der gesetzlichen Anforderungen führen zu können. Die Speicherung erfolgt serverseitig und/oder in einem Cookie (sogenanntes Opt-In-Cookie) oder mittels vergleichbarer Technologien, um die Einwilligung einem spezifischen Nutzer oder dessen Gerät zuordnen zu können. Sofern keine spezifischen Angaben zu den Anbietern von Einwilligungs-Management-Diensten vorliegen, gelten folgende allgemeine Hinweise: Die Dauer der Speicherung der Einwilligung beträgt bis zu zwei Jahre. Dabei wird ein pseudonymer Nutzer-Identifikator erstellt, der zusammen mit dem Zeitpunkt der Einwilligung, den Angaben zum Umfang der Einwilligung (z. B. betreffende Kategorien von Cookies und/oder Diensteanbieter) sowie Informationen über den Browser, das System und das verwendete Endgerät gespeichert wird; <span class=""><strong>Rechtsgrundlagen:</strong> Einwilligung (Art. 6 Abs. 1 S. 1 lit. a) DSGVO).</span></li></ul>
<h2 id="m367">Registrierung, Anmeldung und Nutzerkonto</h2><p>Nutzer können ein Nutzerkonto anlegen. Im Rahmen der Registrierung werden den Nutzern die erforderlichen Pflichtangaben mitgeteilt und zu Zwecken der Bereitstellung des Nutzerkontos auf Grundlage vertraglicher Pflichterfüllung verarbeitet. Zu den verarbeiteten Daten gehören insbesondere die Login-Informationen (Nutzername, Passwort sowie eine E-Mail-Adresse).</p>
<p>Im Rahmen der Inanspruchnahme unserer Registrierungs- und Anmeldefunktionen sowie der Nutzung des Nutzerkontos speichern wir die IP-Adresse und den Zeitpunkt der jeweiligen Nutzerhandlung. Die Speicherung erfolgt auf Grundlage unserer berechtigten Interessen als auch jener der Nutzer an einem Schutz vor Missbrauch und sonstiger unbefugter Nutzung. Eine Weitergabe dieser Daten an Dritte erfolgt grundsätzlich nicht, es sei denn, sie ist zur Verfolgung unserer Ansprüche erforderlich oder es besteht eine gesetzliche Verpflichtung hierzu.</p>
<p>Die Nutzer können über Vorgänge, die für deren Nutzerkonto relevant sind, wie z. B. technische Änderungen, per E-Mail informiert werden.</p>
<ul class="m-elements"><li><strong>Verarbeitete Datenarten:</strong> Bestandsdaten (z. B. der vollständige Name, Wohnadresse, Kontaktinformationen, Kundennummer, etc.); Kontaktdaten (z. B. Post- und E-Mail-Adressen oder Telefonnummern); Inhaltsdaten (z. B. textliche oder bildliche Nachrichten und Beiträge sowie die sie betreffenden Informationen, wie z. B. Angaben zur Autorenschaft oder Zeitpunkt der Erstellung); Nutzungsdaten (z. B. Seitenaufrufe und Verweildauer, Klickpfade, Nutzungsintensität und -frequenz, verwendete Gerätetypen und Betriebssysteme, Interaktionen mit Inhalten und Funktionen). Protokolldaten (z. B. Logfiles betreffend Logins oder den Abruf von Daten oder Zugriffszeiten.).</li><li><strong>Betroffene Personen:</strong> Nutzer (z. B. Webseitenbesucher, Nutzer von Onlinediensten).</li><li><strong>Zwecke der Verarbeitung:</strong> Erbringung vertraglicher Leistungen und Erfüllung vertraglicher Pflichten; Sicherheitsmaßnahmen; Organisations- und Verwaltungsverfahren. Bereitstellung unseres Onlineangebotes und Nutzerfreundlichkeit.</li><li><strong>Aufbewahrung und Löschung:</strong> Löschung entsprechend Angaben im Abschnitt "Allgemeine Informationen zur Datenspeicherung und Löschung". Löschung nach Kündigung.</li><li class=""><strong>Rechtsgrundlagen:</strong> Vertragserfüllung und vorvertragliche Anfragen (Art. 6 Abs. 1 S. 1 lit. b) DSGVO). Berechtigte Interessen (Art. 6 Abs. 1 S. 1 lit. f) DSGVO).</li></ul><p><strong>Weitere Hinweise zu Verarbeitungsprozessen, Verfahren und Diensten:</strong></p><ul class="m-elements"><li><strong>Registrierung mit Pseudonymen: </strong>Nutzer dürfen statt Klarnamen Pseudonyme als Nutzernamen verwenden; <span class=""><strong>Rechtsgrundlagen:</strong> Vertragserfüllung und vorvertragliche Anfragen (Art. 6 Abs. 1 S. 1 lit. b) DSGVO).</span></li><li><strong>Profile der Nutzer sind nicht öffentlich: </strong>Die Profile der Nutzer sind öffentlich nicht sichtbar und nicht zugänglich.</li></ul>
<h2 id="m432">Community Funktionen</h2><p>Die von uns bereitgestellten Community Funktionen erlauben es Nutzern  miteinander in Konversationen oder sonst miteinander in einen Austausch zu treten. Hierbei bitten wir zu beachten, dass die Nutzung der Communityfunktionen nur unter Beachtung der geltenden Rechtslage, unserer Bedingungen und Richtlinien sowie der Rechte anderer Nutzer und Dritter gestattet ist.</p>
<ul class="m-elements"><li><strong>Verarbeitete Datenarten:</strong> Bestandsdaten (z. B. der vollständige Name, Wohnadresse, Kontaktinformationen, Kundennummer, etc.). Nutzungsdaten (z. B. Seitenaufrufe und Verweildauer, Klickpfade, Nutzungsintensität und -frequenz, verwendete Gerätetypen und Betriebssysteme, Interaktionen mit Inhalten und Funktionen).</li><li><strong>Betroffene Personen:</strong> Nutzer (z. B. Webseitenbesucher, Nutzer von Onlinediensten).</li><li><strong>Zwecke der Verarbeitung:</strong> Erbringung vertraglicher Leistungen und Erfüllung vertraglicher Pflichten; Sicherheitsmaßnahmen. Bereitstellung unseres Onlineangebotes und Nutzerfreundlichkeit.</li><li><strong>Aufbewahrung und Löschung:</strong> Löschung entsprechend Angaben im Abschnitt "Allgemeine Informationen zur Datenspeicherung und Löschung".</li><li class=""><strong>Rechtsgrundlagen:</strong> Vertragserfüllung und vorvertragliche Anfragen (Art. 6 Abs. 1 S. 1 lit. b) DSGVO). Berechtigte Interessen (Art. 6 Abs. 1 S. 1 lit. f) DSGVO).</li></ul><p><strong>Weitere Hinweise zu Verarbeitungsprozessen, Verfahren und Diensten:</strong></p><ul class="m-elements"><li><strong>Speicherung von Daten zu Sicherheitszwecken: </strong>Die Beiträge und sonstige Eingaben der Nutzer werden zu Zwecken der Community- und Konversationsfunktionen verarbeitet und, vorbehaltlich gesetzlicher Pflichten oder gesetzlicher Erlaubnis nicht an Dritte herausgegeben. Eine Herausgabepflicht kann insbesondere im Fall von rechtswidrigen Beiträgen zu Zwecken der Rechtsverfolgung entstehen. Wir weisen darauf hin, dass neben den Inhalten der Beiträge auch deren Zeitpunkt und die IP-Adresse der Nutzer gespeichert werden. Dies geschieht, um zum Schutz anderer Nutzer und der Community angemessene Maßnahmen ergreifen zu können; <span class=""><strong>Rechtsgrundlagen:</strong> Vertragserfüllung und vorvertragliche Anfragen (Art. 6 Abs. 1 S. 1 lit. b) DSGVO).</span></li><li><strong>Recht zur Löschung von Inhalten und Informationen: </strong>Die Löschung von Beiträgen, Inhalten oder Angaben der Nutzer ist nach einer sachgerechten Abwägung im erforderlichen Umfang zulässig soweit konkrete Anhaltspunkte dafür bestehen, dass sie einen Verstoß gegen gesetzliche Regeln, unsere Vorgaben oder Rechte Dritter darstellen; <span class=""><strong>Rechtsgrundlagen:</strong> Vertragserfüllung und vorvertragliche Anfragen (Art. 6 Abs. 1 S. 1 lit. b) DSGVO).</span></li><li><strong>Eingeschränkte Löschung von Gesprächsbeiträgen: </strong>Aus Rücksicht auf andere Nutzer, bleiben Gesprächsbeiträge des Nutzers auch nach Kündigung und Kontolöschung gespeichert, damit Konversationen, Kommentare, Ratschläge o.ä. Kommunikation zwischen und unter Nutzern ihren Sinn nicht verlieren oder umkehren. Nutzernamen werden gelöscht oder pseudonymisiert, sofern sie nicht bereits Pseudonyme darstellten. Nutzer können die vollständige Löschung der Gesprächsbeiträge jederzeit bei uns geltend machen; <span class=""><strong>Rechtsgrundlagen:</strong> Vertragserfüllung und vorvertragliche Anfragen (Art. 6 Abs. 1 S. 1 lit. b) DSGVO).</span></li><li><strong>Schutz eigener Daten: </strong>Die Nutzer entscheiden selbst, welche Daten sie über sich innerhalb unseres Onlineangebotes preisgeben. Zum Beispiel, wenn Nutzer Angaben zur eigenen Person machen oder an Konversationen teilnehmen. Wir bitten die Nutzer ihre Daten zu schützen und persönliche Daten nur mit Bedacht und nur im erforderlichen Umfang zu veröffentlichen. Insbesondere bitten wir die Nutzer zu beachten, dass sie die Zugangsdaten ganz besonders schützen und sichere Passwörter verwenden müssen (d. h. vor allem möglichst lange und zufällige Zeichenkombinationen); <span class=""><strong>Rechtsgrundlagen:</strong> Vertragserfüllung und vorvertragliche Anfragen (Art. 6 Abs. 1 S. 1 lit. b) DSGVO).</span></li></ul>
<h2 id="m451">Single-Sign-On-Anmeldung</h2><p>Als "Single-Sign-On" oder "Single-Sign-On-Anmeldung bzw. "-Authentifizierung" werden Verfahren bezeichnet, die es Nutzern erlauben, sich mit Hilfe eines Nutzerkontos bei einem Anbieter von Single-Sign-On-Verfahren (z. B. einem sozialen Netzwerk), auch bei unserem Onlineangebot, anzumelden. Voraussetzung der Single-Sign-On-Authentifizierung ist, dass die Nutzer bei dem jeweiligen Single-Sign-On-Anbieter registriert sind und die erforderlichen Zugangsdaten in dem dafür vorgesehenen Onlineformular eingeben, bzw. schon bei dem Single-Sign-On-Anbieter angemeldet sind und die Single-Sign-On-Anmeldung via Schaltfläche bestätigen.</p>
<p>Die Authentifizierung erfolgt direkt bei dem jeweiligen Single-Sign-On-Anbieter. Im Rahmen einer solchen Authentifizierung erhalten wir eine Nutzer-ID mit der Information, dass der Nutzer unter dieser Nutzer-ID beim jeweiligen Single-Sign-On-Anbieter eingeloggt ist und eine für uns für andere Zwecke nicht weiter nutzbare ID (sog "User Handle"). Ob uns zusätzliche Daten übermittelt werden, hängt allein von dem genutzten Single-Sign-On-Verfahren ab, von den gewählten Datenfreigaben im Rahmen der Authentifizierung und zudem davon, welche Daten Nutzer in den Privatsphäre- oder sonstigen Einstellungen des Nutzerkontos beim Single-Sign-On-Anbieter freigegeben haben. Es können je nach Single-Sign-On-Anbieter und der Wahl der Nutzer verschiedene Daten sein, in der Regel sind es die E-Mail-Adresse und der Benutzername. Das im Rahmen des Single-Sign-On-Verfahrens eingegebene Passwort bei dem Single-Sign-On-Anbieter ist für uns weder einsehbar, noch wird es von uns gespeichert. </p>
<p>Die Nutzer werden gebeten, zu beachten, dass deren bei uns gespeicherte Angaben automatisch mit ihrem Nutzerkonto beim Single-Sign-On-Anbieter abgeglichen werden können, dies jedoch nicht immer möglich ist oder tatsächlich erfolgt. Ändern sich z. B. die E-Mail-Adressen der Nutzer, müssen sie diese manuell in ihrem Nutzerkonto bei uns ändern.</p>
<p>Die Single-Sign-On-Anmeldung können wir, sofern mit den Nutzern vereinbart, im Rahmen der oder vor der Vertragserfüllung einsetzen, soweit die Nutzer darum gebeten wurden, im Rahmen einer Einwilligung verarbeiten und setzen sie ansonsten auf Grundlage der berechtigten Interessen unsererseits und der Interessen der Nutzer an einem effektiven und sicheren Anmeldesystem ein.</p>
<p>Sollten Nutzer sich einmal entscheiden, die Verknüpfung ihres Nutzerkontos beim Single-Sign-On-Anbieter nicht mehr für das Single-Sign-On-Verfahren nutzen zu wollen, müssen sie diese Verbindung innerhalb ihres Nutzerkontos beim Single-Sign-On-Anbieter aufheben. Möchten Nutzer deren Daten bei uns löschen, müssen sie ihre Registrierung bei uns kündigen.</p>
<ul class="m-elements"><li><strong>Verarbeitete Datenarten:</strong> Bestandsdaten (z. B. der vollständige Name, Wohnadresse, Kontaktinformationen, Kundennummer, etc.); Kontaktdaten (z. B. Post- und E-Mail-Adressen oder Telefonnummern); Nutzungsdaten (z. B. Seitenaufrufe und Verweildauer, Klickpfade, Nutzungsintensität und -frequenz, verwendete Gerätetypen und Betriebssysteme, Interaktionen mit Inhalten und Funktionen). Meta-, Kommunikations- und Verfahrensdaten (z. B. IP-Adressen, Zeitangaben, Identifikationsnummern, beteiligte Personen).</li><li><strong>Betroffene Personen:</strong> Nutzer (z. B. Webseitenbesucher, Nutzer von Onlinediensten).</li><li><strong>Zwecke der Verarbeitung:</strong> Erbringung vertraglicher Leistungen und Erfüllung vertraglicher Pflichten; Sicherheitsmaßnahmen; Anmeldeverfahren. Bereitstellung unseres Onlineangebotes und Nutzerfreundlichkeit.</li><li><strong>Aufbewahrung und Löschung:</strong> Löschung entsprechend Angaben im Abschnitt "Allgemeine Informationen zur Datenspeicherung und Löschung". Löschung nach Kündigung.</li><li class=""><strong>Rechtsgrundlagen:</strong> Vertragserfüllung und vorvertragliche Anfragen (Art. 6 Abs. 1 S. 1 lit. b) DSGVO). Berechtigte Interessen (Art. 6 Abs. 1 S. 1 lit. f) DSGVO).</li></ul><p><strong>Weitere Hinweise zu Verarbeitungsprozessen, Verfahren und Diensten:</strong></p><ul class="m-elements"><li><strong>Google Single-Sign-On: </strong>Authentifizierungsdienste für Nutzeranmeldungen, Bereitstellung von Single Sign-On-Funktionen, Verwaltung von Identitätsinformationen und Anwendungsintegrationen; <strong>Dienstanbieter:</strong> Google Ireland Limited, Gordon House, Barrow Street, Dublin 4, Irland; <span class=""><strong>Rechtsgrundlagen:</strong> Berechtigte Interessen (Art. 6 Abs. 1 S. 1 lit. f) DSGVO); </span><strong>Website:</strong> <a href="https://www.google.de" target="_blank">https://www.google.de</a>; <strong>Datenschutzerklärung:</strong> <a href="https://policies.google.com/privacy" target="_blank">https://policies.google.com/privacy</a>; <strong>Grundlage Drittlandtransfers:</strong> EU/EWR - Data Privacy Framework (DPF), Schweiz - Data Privacy Framework (DPF). <strong>Widerspruchsmöglichkeit (Opt-Out):</strong> Einstellungen für die Darstellung von Werbeeinblendungen: <a href="https://myadcenter.google.com/" target="_blank">https://myadcenter.google.com/</a>.</li></ul>
<h2 id="m182">Kontakt- und Anfrageverwaltung</h2><p>Bei der Kontaktaufnahme mit uns (z. B. per Post, Kontaktformular, E-Mail, Telefon oder via soziale Medien) sowie im Rahmen bestehender Nutzer- und Geschäftsbeziehungen werden die Angaben der anfragenden Personen verarbeitet, soweit dies zur Beantwortung der Kontaktanfragen und etwaiger angefragter Maßnahmen erforderlich ist.</p>
<ul class="m-elements"><li><strong>Verarbeitete Datenarten:</strong> Bestandsdaten (z. B. der vollständige Name, Wohnadresse, Kontaktinformationen, Kundennummer, etc.); Kontaktdaten (z. B. Post- und E-Mail-Adressen oder Telefonnummern); Inhaltsdaten (z. B. textliche oder bildliche Nachrichten und Beiträge sowie die sie betreffenden Informationen, wie z. B. Angaben zur Autorenschaft oder Zeitpunkt der Erstellung); Nutzungsdaten (z. B. Seitenaufrufe und Verweildauer, Klickpfade, Nutzungsintensität und -frequenz, verwendete Gerätetypen und Betriebssysteme, Interaktionen mit Inhalten und Funktionen). Meta-, Kommunikations- und Verfahrensdaten (z. B. IP-Adressen, Zeitangaben, Identifikationsnummern, beteiligte Personen).</li><li><strong>Betroffene Personen:</strong> Kommunikationspartner.</li><li><strong>Zwecke der Verarbeitung:</strong> Kommunikation; Organisations- und Verwaltungsverfahren; Feedback (z. B. Sammeln von Feedback via Online-Formular). Bereitstellung unseres Onlineangebotes und Nutzerfreundlichkeit.</li><li><strong>Aufbewahrung und Löschung:</strong> Löschung entsprechend Angaben im Abschnitt "Allgemeine Informationen zur Datenspeicherung und Löschung".</li><li class=""><strong>Rechtsgrundlagen:</strong> Berechtigte Interessen (Art. 6 Abs. 1 S. 1 lit. f) DSGVO). Vertragserfüllung und vorvertragliche Anfragen (Art. 6 Abs. 1 S. 1 lit. b) DSGVO).</li></ul><p><strong>Weitere Hinweise zu Verarbeitungsprozessen, Verfahren und Diensten:</strong></p><ul class="m-elements"><li><strong>Kontaktformular: </strong>Bei Kontaktaufnahme über unser Kontaktformular, per E-Mail oder anderen Kommunikationswegen, verarbeiten wir die uns übermittelten personenbezogenen Daten zur Beantwortung und Bearbeitung des jeweiligen Anliegens. Dies umfasst in der Regel Angaben wie Name, Kontaktinformationen und gegebenenfalls weitere Informationen, die uns mitgeteilt werden und zur angemessenen Bearbeitung erforderlich sind. Wir nutzen diese Daten ausschließlich für den angegebenen Zweck der Kontaktaufnahme und Kommunikation; <span class=""><strong>Rechtsgrundlagen:</strong> Vertragserfüllung und vorvertragliche Anfragen (Art. 6 Abs. 1 S. 1 lit. b) DSGVO), Berechtigte Interessen (Art. 6 Abs. 1 S. 1 lit. f) DSGVO).</span></li></ul>
<h2 id="m237">Gewinnspiele und Wettbewerbe</h2><p>Wir verarbeiten personenbezogene Daten der Teilnehmer von Gewinnspielen und Wettbewerben nur unter Einhaltung der einschlägigen Datenschutzbestimmungen, soweit die Verarbeitung zur Bereitstellung, Durchführung und Abwicklung des Gewinnspiels vertraglich erforderlich ist, die Teilnehmer in die Verarbeitung eingewilligt haben oder die Verarbeitung unseren berechtigten Interessen dient (z. B. an der Sicherheit des Gewinnspiels oder dem Schutz unserer Interessen vor Missbrauch durch mögliche Erfassung von IP-Adressen bei Einreichung von Gewinnspielbeiträgen).</p>
<p>Falls im Rahmen der Gewinnspiele Beiträge der Teilnehmer veröffentlicht werden (z. B. im Rahmen einer Abstimmung oder Präsentation der Gewinnspielbeiträge bzw. der Gewinner oder der Berichterstattung zum Gewinnspiel), weisen wir darauf hin, dass die Namen der Teilnehmer in diesem Zusammenhang ebenfalls veröffentlicht werden können. Die Teilnehmer können dem jederzeit widersprechen.</p>
<p>Findet das Gewinnspiel innerhalb einer Online-Plattform oder eines sozialen Netzwerks (z. B. Facebook oder Instagram, nachfolgend bezeichnet als "Online-Plattform") statt, gelten zusätzlich die Nutzungs- und Datenschutzbestimmungen der jeweiligen Plattformen. In diesen Fällen weisen wir darauf hin, dass wir für die im Rahmen des Gewinnspiels mitgeteilten Angaben der Teilnehmer verantwortlich sind und Anfragen im Hinblick auf das Gewinnspiel an uns zu richten sind.</p>
<p>Die Daten der Teilnehmer werden gelöscht, sobald das Gewinnspiel oder der Wettbewerb beendet sind und die Daten nicht mehr erforderlich sind, um die Gewinner zu informieren oder weil nicht mehr mit Rückfragen zum Gewinnspiel zu rechnen ist. Grundsätzlich werden die Daten der Teilnehmer spätestens 6 Monate nach Ende des Gewinnspiels gelöscht. Daten der Gewinner können länger einbehalten werden, um z. B. Rückfragen zu den Gewinnen beantworten oder die Gewinnleistungen erfüllen zu können; in diesem Fall richtet sich die Aufbewahrungsdauer nach der Art des Gewinns und beträgt z. B. bei Sachen oder Leistungen bis zu drei Jahre, um z. B. Gewährleistungsfälle bearbeiten zu können. Ferner können die Daten der Teilnehmer länger gespeichert werden, z. B. in Form der Berichterstattung zum Gewinnspiel in Online- und Offline-Medien.</p>
<p>Sofern Daten im Rahmen des Gewinnspiels auch zu anderen Zwecken erhoben wurden, richten sich deren Verarbeitung und die Aufbewahrungsdauer nach den Datenschutzhinweisen zu dieser Nutzung (z. B. im Fall einer Anmeldung zum Newsletter im Rahmen eines Gewinnspiels).</p>
<ul class="m-elements"><li><strong>Verarbeitete Datenarten:</strong> Bestandsdaten (z. B. der vollständige Name, Wohnadresse, Kontaktinformationen, Kundennummer, etc.); Kontaktdaten (z. B. Post- und E-Mail-Adressen oder Telefonnummern). Inhaltsdaten (z. B. textliche oder bildliche Nachrichten und Beiträge sowie die sie betreffenden Informationen, wie z. B. Angaben zur Autorenschaft oder Zeitpunkt der Erstellung).</li><li><strong>Betroffene Personen:</strong> Gewinnspiel- und Wettbewerbsteilnehmer.</li><li><strong>Zwecke der Verarbeitung:</strong> Durchführung von Gewinnspielen und Wettbewerben.</li><li><strong>Aufbewahrung und Löschung:</strong> Löschung entsprechend Angaben im Abschnitt "Allgemeine Informationen zur Datenspeicherung und Löschung".</li><li class=""><strong>Rechtsgrundlagen:</strong> Vertragserfüllung und vorvertragliche Anfragen (Art. 6 Abs. 1 S. 1 lit. b) DSGVO). Berechtigte Interessen (Art. 6 Abs. 1 S. 1 lit. f) DSGVO).</li></ul>
<h2 id="m263">Webanalyse, Monitoring und Optimierung</h2><p>Die Webanalyse (auch als „Reichweitenmessung" bezeichnet) dient der Auswertung der Besucherströme unseres Onlineangebots und kann Verhalten, Interessen oder demografische Informationen zu den Besuchern, wie beispielsweise Alter oder Geschlecht, als pseudonyme Werte umfassen. Mithilfe der Reichweitenanalyse können wir zum Beispiel erkennen, zu welcher Zeit unser Onlineangebot oder dessen Funktionen beziehungsweise Inhalte am häufigsten genutzt werden, oder zur Wiederverwendung einladen. Ebenso ist es uns möglich, nachzuvollziehen, welche Bereiche der Optimierung bedürfen. </p>
<p>Neben der Webanalyse können wir auch Testverfahren einsetzen, um etwa unterschiedliche Versionen unseres Onlineangebots oder seiner Bestandteile zu testen und zu optimieren.</p>
<p>Sofern nachfolgend nicht anders angegeben, können zu diesen Zwecken Profile, also zu einem Nutzungsvorgang zusammengefasste Daten, angelegt und Informationen in einem Browser bzw. in einem Endgerät gespeichert und dann ausgelesen werden. Zu den erhobenen Angaben gehören insbesondere besuchte Websites und dort genutzte Elemente sowie technische Auskünfte, wie etwa der verwendete Browser, das benutzte Computersystem sowie Angaben zu Nutzungszeiten. Sofern sich Nutzer in die Erhebung ihrer Standortdaten uns gegenüber oder gegenüber den Anbietern der von uns eingesetzten Dienste einverstanden erklärt haben, ist auch die Verarbeitung von Standortdaten möglich.</p>
<p>Darüber hinaus werden die IP-Adressen der Nutzer gespeichert. Jedoch nutzen wir ein IP-Masking-Verfahren (d. h. Pseudonymisierung durch Kürzung der IP-Adresse) zum Schutz der Nutzer. Generell werden die im Rahmen von Webanalyse, A/B-Testings und Optimierung keine Klardaten der Nutzer (wie z. B. E-Mail-Adressen oder Namen) gespeichert, sondern Pseudonyme. Das heißt, wir als auch die Anbieter der eingesetzten Software kennen nicht die tatsächliche Identität der Nutzer, sondern nur die zum Zweck der jeweiligen Verfahren in deren Profilen gespeicherten Angaben.</p>
<p>Hinweise zu Rechtsgrundlagen: Sofern wir die Nutzer um deren Einwilligung in den Einsatz der Drittanbieter bitten, stellt die Rechtsgrundlage der Datenverarbeitung die Einwilligung dar. Ansonsten werden die Nutzerdaten auf Grundlage unserer berechtigten Interessen (d. h. Interesse an effizienten, wirtschaftlichen und empfängerfreundlichen Leistungen) verarbeitet. In diesem Zusammenhang möchten wir Sie auch auf die Informationen zur Verwendung von Cookies in dieser Datenschutzerklärung hinweisen.</p>
<ul class="m-elements"><li><strong>Verarbeitete Datenarten:</strong> Nutzungsdaten (z. B. Seitenaufrufe und Verweildauer, Klickpfade, Nutzungsintensität und -frequenz, verwendete Gerätetypen und Betriebssysteme, Interaktionen mit Inhalten und Funktionen). Meta-, Kommunikations- und Verfahrensdaten (z. B. IP-Adressen, Zeitangaben, Identifikationsnummern, beteiligte Personen).</li><li><strong>Betroffene Personen:</strong> Nutzer (z. B. Webseitenbesucher, Nutzer von Onlinediensten).</li><li><strong>Zwecke der Verarbeitung:</strong> Reichweitenmessung (z. B. Zugriffsstatistiken, Erkennung wiederkehrender Besucher); Profile mit nutzerbezogenen Informationen (Erstellen von Nutzerprofilen). Bereitstellung unseres Onlineangebotes und Nutzerfreundlichkeit.</li><li><strong>Aufbewahrung und Löschung:</strong> Löschung entsprechend Angaben im Abschnitt "Allgemeine Informationen zur Datenspeicherung und Löschung". Speicherung von Cookies von bis zu 2 Jahren (Sofern nicht anders angegeben, können Cookies und ähnliche Speichermethoden für einen Zeitraum von zwei Jahren auf den Geräten der Nutzer gespeichert werden.).</li><li><strong>Sicherheitsmaßnahmen:</strong> IP-Masking (Pseudonymisierung der IP-Adresse).</li><li class=""><strong>Rechtsgrundlagen:</strong> Einwilligung (Art. 6 Abs. 1 S. 1 lit. a) DSGVO). Berechtigte Interessen (Art. 6 Abs. 1 S. 1 lit. f) DSGVO).</li></ul><p><strong>Weitere Hinweise zu Verarbeitungsprozessen, Verfahren und Diensten:</strong></p><ul class="m-elements"><li><strong>Google Analytics: </strong>Wir verwenden Google Analytics zur Messung und Analyse der Nutzung unseres Onlineangebotes auf der Grundlage einer pseudonymen Nutzeridentifikationsnummer. Diese Identifikationsnummer enthält keine eindeutigen Daten, wie Namen oder E-Mail-Adressen. Sie dient dazu, Analyseinformationen einem Endgerät zuzuordnen, um zu erkennen, welche Inhalte die Nutzer innerhalb eines oder verschiedener Nutzungsvorgänge aufgerufen haben, welche Suchbegriffe sie verwendet haben, diese erneut aufgerufen haben oder mit unserem Onlineangebot interagiert haben. Ebenso werden der Zeitpunkt der Nutzung und deren Dauer gespeichert, sowie die Quellen der Nutzer, die auf unser Onlineangebot verweisen und technische Aspekte ihrer Endgeräte und Browser.<br>Dabei werden pseudonyme Profile von Nutzern mit Informationen aus der Nutzung verschiedener Geräte erstellt, wobei Cookies eingesetzt werden können. Google Analytics protokolliert und speichert keine individuellen IP-Adressen für EU-Nutzer. Analytics stellt jedoch grobe geografische Standortdaten bereit, indem es die folgenden Metadaten von IP-Adressen ableitet: Stadt (und der abgeleitete Breiten- und Längengrad der Stadt), Kontinent, Land, Region, Subkontinent (und ID-basierte Gegenstücke). Beim EU-Datenverkehr werden die IP-Adressdaten ausschließlich für diese Ableitung von Geolokalisierungsdaten verwendet, bevor sie sofort gelöscht werden. Sie werden nicht protokolliert, sind nicht zugänglich und werden nicht für weitere Verwendungszwecke genutzt. Wenn Google Analytics Messdaten sammelt, werden alle IP-Abfragen auf EU-basierten Servern durchgeführt, bevor der Verkehr zur Verarbeitung an Analytics-Server weitergeleitet wird; <strong>Dienstanbieter:</strong> Google Ireland Limited, Gordon House, Barrow Street, Dublin 4, Irland; <span class=""><strong>Rechtsgrundlagen:</strong> Einwilligung (Art. 6 Abs. 1 S. 1 lit. a) DSGVO); </span><strong>Website:</strong> <a href="https://marketingplatform.google.com/intl/de/about/analytics/" target="_blank">https://marketingplatform.google.com/intl/de/about/analytics/</a>; <strong>Sicherheitsmaßnahmen:</strong> IP-Masking (Pseudonymisierung der IP-Adresse); <strong>Datenschutzerklärung:</strong> <a href="https://policies.google.com/privacy" target="_blank">https://policies.google.com/privacy</a>; <strong>Auftragsverarbeitungsvertrag:</strong> <a href="https://business.safety.google/adsprocessorterms/" target="_blank">https://business.safety.google/adsprocessorterms/</a>; <strong>Grundlage Drittlandtransfers:</strong> EU/EWR - Data Privacy Framework (DPF), Standardvertragsklauseln (<a href="https://business.safety.google/adsprocessorterms" target="_blank">https://business.safety.google/adsprocessorterms</a>), Schweiz - Data Privacy Framework (DPF), Standardvertragsklauseln ( <a href="https://business.safety.google/adsprocessorterms" target="_blank">https://business.safety.google/adsprocessorterms</a>); <strong>Widerspruchsmöglichkeit (Opt-Out):</strong> Opt-Out-Plugin: <a href="https://tools.google.com/dlpage/gaoptout?hl=de" target="_blank">https://tools.google.com/dlpage/gaoptout?hl=de</a>,  Einstellungen für die Darstellung von Werbeeinblendungen: <a href="https://myadcenter.google.com/personalizationoff" target="_blank">https://myadcenter.google.com/personalizationoff</a>. <strong>Weitere Informationen:</strong> <a href="https://business.safety.google/adsservices/" target="_blank">https://business.safety.google/adsservices/</a> (Arten der Verarbeitung sowie der verarbeiteten Daten).</li></ul>
<h2 id="m264">Onlinemarketing</h2><p>Wir verarbeiten personenbezogene Daten zum Zweck des Onlinemarketings, worunter insbesondere die Vermarktung von Werbeflächen oder die Darstellung von werbenden und sonstigen Inhalten (zusammenfassend als „Inhalte" bezeichnet) anhand potenzieller Interessen der Nutzer sowie die Messung ihrer Effektivität fallen können.</p>
<p>Zu diesen Zwecken werden sogenannte Nutzerprofile angelegt und in einer Datei (der sogenannte „Cookie") gespeichert oder ähnliche Verfahren genutzt, mittels derer die für die Darstellung der vorgenannten Inhalte relevanten Angaben zum Nutzer gespeichert werden. Hierzu können beispielsweise betrachtete Inhalte, besuchte Websites, genutzte Onlinenetzwerke, aber auch Kommunikationspartner und technische Angaben gehören, wie etwa der verwendete Browser, das benutzte Computersystem sowie Auskünfte zu Nutzungszeiten und genutzten Funktionen. Sofern Nutzer in die Erhebung ihrer Standortdaten eingewilligt haben, können auch diese verarbeitet werden.</p>
<p>Zudem werden die IP-Adressen der Nutzer gespeichert. Jedoch nutzen wir zur Verfügung stehende IP-Masking-Verfahren (d. h. Pseudonymisierung durch Kürzung der IP-Adresse) zum Nutzerschutz. Generell werden im Rahmen des Onlinemarketingverfahrens keine Klardaten der Nutzer (wie z. B. E-Mail-Adressen oder Namen) gespeichert, sondern Pseudonyme. Das heißt, wir als auch die Anbieter der Onlinemarketingverfahren kennen nicht die tatsächliche Nutzeridentität, sondern nur die in deren Profilen gespeicherten Angaben.</p>
<p>Die Aussagen in den Profilen werden im Regelfall in den Cookies oder mittels ähnlicher Verfahren gespeichert. Diese Cookies können später generell auch auf anderen Websites, die dasselbe Onlinemarketingverfahren einsetzen, ausgelesen und zum Zweck der Darstellung von Inhalten analysiert sowie mit weiteren Daten ergänzt und auf dem Server des Onlinemarketingverfahrensanbieters gespeichert werden.</p>
<p>Ausnahmsweise ist es möglich, Klardaten den Profilen zuzuordnen, vornehmlich dann, wenn die Nutzer zum Beispiel Mitglieder eines sozialen Netzwerks sind, dessen Onlinemarketingverfahren wir einsetzen und das Netzwerk die Nutzerprofile mit den vorgenannten Angaben verbindet. Wir bitten darum, zu beachten, dass Nutzer mit den Anbietern zusätzliche Abreden treffen können, etwa durch Einwilligung im Rahmen der Registrierung.</p>
<p>Wir erhalten grundsätzlich nur Zugang zu zusammengefassten Informationen über den Erfolg unserer Werbeanzeigen. Jedoch können wir im Rahmen sogenannter Konversionsmessungen prüfen, welche unserer Onlinemarketingverfahren zu einer sogenannten Konversion geführt haben, d. h. beispielsweise zu einem Vertragsschluss mit uns. Die Konversionsmessung wird alleine zur Erfolgsanalyse unserer Marketingmaßnahmen verwendet.</p>
<p>Solange nicht anders angegeben, bitten wir Sie, davon auszugehen, dass eingesetzte Cookies für einen Zeitraum von zwei Jahren gespeichert werden.</p>
<p><strong>Hinweise zu Rechtsgrundlagen:</strong> Sofern wir die Nutzer um deren Einwilligung in den Einsatz der Drittanbieter bitten, stellt die Rechtsgrundlage der Datenverarbeitung die Erlaubnis dar. Ansonsten werden die Daten der Nutzer auf Grundlage unserer berechtigten Interessen (d. h. Interesse an effizienten, wirtschaftlichen und empfängerfreundlichen Leistungen) verarbeitet. In diesem Zusammenhang möchten wir Sie auch auf die Informationen zur Verwendung von Cookies in dieser Datenschutzerklärung hinweisen.</p>
<p><strong>Hinweise zum Widerruf und Widerspruch:</strong> </p>
<p>Wir verweisen auf die Datenschutzhinweise der jeweiligen Anbieter und die zu den Anbietern angegebenen Widerspruchsmöglichkeiten (sog. "Opt-Out"). Sofern keine explizite Opt-Out-Möglichkeit angegeben wurde, besteht zum einen die Möglichkeit, dass Sie Cookies in den Einstellungen Ihres Browsers abschalten. Hierdurch können jedoch Funktionen unseres Onlineangebotes eingeschränkt werden. Wir empfehlen daher zusätzlich die folgenden Opt-Out-Möglichkeiten, die zusammenfassend auf jeweilige Gebiete gerichtet angeboten werden: </p>
<p>a) Europa: <a href="https://www.youronlinechoices.eu" target="_blank">https://www.youronlinechoices.eu.</a> </p>
<p>b) Kanada: <a href="https://www.youradchoices.ca/choices" target="_blank">https://www.youradchoices.ca/choices.</a> </p>
<p>c) USA: <a href="https://www.aboutads.info/choices" target="_blank">https://www.aboutads.info/choices.</a> </p>
<p>d) Gebietsübergreifend: <a href="https://optout.aboutads.info" target="_blank">https://optout.aboutads.info.</a></p>
<ul class="m-elements"><li><strong>Verarbeitete Datenarten:</strong> Nutzungsdaten (z. B. Seitenaufrufe und Verweildauer, Klickpfade, Nutzungsintensität und -frequenz, verwendete Gerätetypen und Betriebssysteme, Interaktionen mit Inhalten und Funktionen). Meta-, Kommunikations- und Verfahrensdaten (z. B. IP-Adressen, Zeitangaben, Identifikationsnummern, beteiligte Personen).</li><li><strong>Betroffene Personen:</strong> Nutzer (z. B. Webseitenbesucher, Nutzer von Onlinediensten).</li><li><strong>Zwecke der Verarbeitung:</strong> Reichweitenmessung (z. B. Zugriffsstatistiken, Erkennung wiederkehrender Besucher); Tracking (z. B. interessens-/verhaltensbezogenes Profiling, Nutzung von Cookies); Zielgruppenbildung; Marketing. Profile mit nutzerbezogenen Informationen (Erstellen von Nutzerprofilen).</li><li><strong>Aufbewahrung und Löschung:</strong> Löschung entsprechend Angaben im Abschnitt "Allgemeine Informationen zur Datenspeicherung und Löschung". Speicherung von Cookies von bis zu 2 Jahren (Sofern nicht anders angegeben, können Cookies und ähnliche Speichermethoden für einen Zeitraum von zwei Jahren auf den Geräten der Nutzer gespeichert werden.).</li><li><strong>Sicherheitsmaßnahmen:</strong> IP-Masking (Pseudonymisierung der IP-Adresse).</li><li class=""><strong>Rechtsgrundlagen:</strong> Einwilligung (Art. 6 Abs. 1 S. 1 lit. a) DSGVO).</li></ul><p><strong>Weitere Hinweise zu Verarbeitungsprozessen, Verfahren und Diensten:</strong></p><ul class="m-elements"><li><strong>Google Adsense mit personalisierten Anzeigen: </strong>Wir binden den Dienst Google Adsense ein, der es ermöglicht, personalisierte Anzeigen innerhalb unseres Onlineangebots zu platzieren. Google Adsense analysiert das Nutzerverhalten und verwendet diese Daten, um zielgerichtete Werbung auszuspielen, die auf die Interessen unserer Besucher abgestimmt ist. Für jede Anzeigenschaltung oder andere Nutzungsarten dieser Anzeigen erhalten wir eine finanzielle Vergütung; <strong>Dienstanbieter:</strong> Google Ireland Limited, Gordon House, Barrow Street, Dublin 4, Irland; <span class=""><strong>Rechtsgrundlagen:</strong> Einwilligung (Art. 6 Abs. 1 S. 1 lit. a) DSGVO); </span><strong>Website:</strong> <a href="https://marketingplatform.google.com" target="_blank">https://marketingplatform.google.com</a>; <strong>Datenschutzerklärung:</strong> <a href="https://policies.google.com/privacy" target="_blank">https://policies.google.com/privacy</a>; <strong>Grundlage Drittlandtransfers:</strong> EU/EWR - Data Privacy Framework (DPF), Schweiz - Data Privacy Framework (DPF); <strong>Weitere Informationen:</strong> Arten der Verarbeitung sowie der verarbeiteten Daten: <a href="https://business.safety.google/adsservices/" target="_blank">https://business.safety.google/adsservices/</a>. Datenverarbeitungsbedingungen für Google Werbeprodukte: Informationen zu den Diensten Datenverarbeitungsbedingungen zwischen Verantwortlichen und Standardvertragsklauseln für Drittlandtransfers von Daten: <a href="https://business.safety.google/adscontrollerterms" target="_blank">https://business.safety.google/adscontrollerterms</a>.</li><li><strong>Google Adsense mit nicht-personalisierten Anzeigen: </strong>Wir nutzen den Dienst Google Adsense, um nicht-personalisierte Anzeigen in unserem Onlineangebot zu schalten. Diese Anzeigen basieren nicht auf dem individuellen Nutzerverhalten, sondern werden anhand allgemeiner Merkmale wie dem Inhalt der Seite oder Ihrer ungefähren geografischen Lage ausgewählt. Für die Einblendung oder sonstige Nutzung dieser Anzeigen erhalten wir eine Vergütung; <strong>Dienstanbieter:</strong> Google Ireland Limited, Gordon House, Barrow Street, Dublin 4, Irland; <span class=""><strong>Rechtsgrundlagen:</strong> Einwilligung (Art. 6 Abs. 1 S. 1 lit. a) DSGVO); </span><strong>Website:</strong> <a href="https://marketingplatform.google.com" target="_blank">https://marketingplatform.google.com</a>; <strong>Datenschutzerklärung:</strong> <a href="https://policies.google.com/privacy" target="_blank">https://policies.google.com/privacy</a>; <strong>Grundlage Drittlandtransfers:</strong> EU/EWR - Data Privacy Framework (DPF), Schweiz - Data Privacy Framework (DPF); <strong>Weitere Informationen:</strong> Arten der Verarbeitung sowie der verarbeiteten Daten: <a href="https://business.safety.google/adsservices/" target="_blank">https://business.safety.google/adsservices/</a>. Datenverarbeitungsbedingungen für Google Werbeprodukte: Informationen zu den Diensten Datenverarbeitungsbedingungen zwischen Verantwortlichen und Standardvertragsklauseln für Drittlandtransfers von Daten: <a href="https://business.safety.google/adscontrollerterms" target="_blank">https://business.safety.google/adscontrollerterms</a>.</li></ul>
<h2 id="m135">Affiliate-Programme und Affiliate-Links</h2><p>In unser Onlineangebot binden wir sogenannte Affiliate-Links oder andere Verweise (zu denen z. B. Suchmasken, Widgets oder Rabatt-Codes gehören können) auf die Angebote und Leistungen von Drittanbietern ein (zusammenfassend bezeichnet als "Affiliate-Links"). Wenn Nutzer den Affiliate-Links folgen, bzw. anschließend die Angebote wahrnehmen, können wir von diesen Drittanbietern eine Provision oder sonstige Vorteile erhalten (zusammenfassend bezeichnet als "Provision").</p>
<p>Um nachverfolgen zu können, ob die Nutzer die Angebote eines von uns eingesetzten Affiliate-Links wahrgenommen haben, ist es notwendig, dass die jeweiligen Drittanbieter erfahren, dass die Nutzer einem innerhalb unseres Onlineangebotes eingesetzten Affiliate-Link gefolgt sind. Die Zuordnung der Affiliate-Links zu den jeweiligen Geschäftsabschlüssen oder zu sonstigen Aktionen (z. B. Käufen) dient alleine dem Zweck der Provisionsabrechnung und wird aufgehoben, sobald sie für den Zweck nicht mehr erforderlich ist.</p>
<p>Für die Zwecke der vorgenannten Zuordnung der Affiliate-Links können die Affiliate-Links um bestimmte Werte ergänzt werden, die ein Bestandteil des Links sind oder anderweitig, z. B. in einem Cookie, gespeichert werden können. Zu den Werten können insbesondere die Ausgangswebseite (Referrer), der Zeitpunkt, eine Online-Kennung der Betreiber der Webseite, auf der sich der Affiliate-Link befand, eine Online-Kennung des jeweiligen Angebotes, die Art des verwendeten Links, die Art des Angebotes und eine Online-Kennung des Nutzers gehören.</p>
<p><strong>Hinweise zu Rechtsgrundlagen:</strong> Sofern wir die Nutzer um deren Einwilligung in den Einsatz der Drittanbieter bitten, ist die Rechtsgrundlage der Verarbeitung von Daten die Einwilligung. Ansonsten werden die Daten der Nutzer auf Grundlage unserer berechtigten Interessen (d. h. Interesse an effizienten, wirtschaftlichen und empfängerfreundlichen Leistungen) verarbeitet. In diesem Zusammenhang möchten wir Sie auch auf die Informationen zur Verwendung von Cookies in dieser Datenschutzerklärung hinweisen.</p>
<ul class="m-elements"><li><strong>Verarbeitete Datenarten:</strong> Vertragsdaten (z. B. Vertragsgegenstand, Laufzeit, Kundenkategorie); Nutzungsdaten (z. B. Seitenaufrufe und Verweildauer, Klickpfade, Nutzungsintensität und -frequenz, verwendete Gerätetypen und Betriebssysteme, Interaktionen mit Inhalten und Funktionen). Meta-, Kommunikations- und Verfahrensdaten (z. B. IP-Adressen, Zeitangaben, Identifikationsnummern, beteiligte Personen).</li><li><strong>Betroffene Personen:</strong> Interessenten. Nutzer (z. B. Webseitenbesucher, Nutzer von Onlinediensten).</li><li><strong>Zwecke der Verarbeitung:</strong> Affiliate-Nachverfolgung.</li><li><strong>Aufbewahrung und Löschung:</strong> Löschung entsprechend Angaben im Abschnitt "Allgemeine Informationen zur Datenspeicherung und Löschung".</li><li class=""><strong>Rechtsgrundlagen:</strong> Einwilligung (Art. 6 Abs. 1 S. 1 lit. a) DSGVO). Berechtigte Interessen (Art. 6 Abs. 1 S. 1 lit. f) DSGVO).</li></ul>
<h2 id="m299">Kundenrezensionen und Bewertungsverfahren</h2><p>Wir nehmen an Rezensions- und Bewertungsverfahren teil, um unsere Leistungen zu evaluieren, zu optimieren und zu bewerben. Wenn Nutzer uns über die beteiligten Bewertungsplattformen oder -verfahren bewerten oder anderweitig Feedback geben, gelten zusätzlich die Allgemeinen Geschäfts- oder Nutzungsbedingungen und die Datenschutzhinweise der Anbieter. Im Regelfall setzt die Bewertung zudem eine Registrierung bei den jeweiligen Anbietern voraus. </p>
<p>Um sicherzustellen, dass die bewertenden Personen tatsächlich unsere Leistungen in Anspruch genommen haben, übermitteln wir mit Einwilligung der Kunden die hierzu erforderlichen Daten im Hinblick auf den Kunden und die in Anspruch genommene Leistung an die jeweilige Bewertungsplattform (einschließlich Name, E-Mail-Adresse und Bestellnummer bzw. Artikelnummer). Diese Daten werden alleine zur Verifizierung der Authentizität des Nutzers verwendet.</p>
<ul class="m-elements"><li><strong>Verarbeitete Datenarten:</strong> Vertragsdaten (z. B. Vertragsgegenstand, Laufzeit, Kundenkategorie); Nutzungsdaten (z. B. Seitenaufrufe und Verweildauer, Klickpfade, Nutzungsintensität und -frequenz, verwendete Gerätetypen und Betriebssysteme, Interaktionen mit Inhalten und Funktionen). Meta-, Kommunikations- und Verfahrensdaten (z. B. IP-Adressen, Zeitangaben, Identifikationsnummern, beteiligte Personen).</li><li><strong>Betroffene Personen:</strong> Leistungsempfänger und Auftraggeber. Nutzer (z. B. Webseitenbesucher, Nutzer von Onlinediensten).</li><li><strong>Zwecke der Verarbeitung:</strong> Feedback (z. B. Sammeln von Feedback via Online-Formular). Marketing.</li><li class=""><strong>Rechtsgrundlagen:</strong> Berechtigte Interessen (Art. 6 Abs. 1 S. 1 lit. f) DSGVO).</li></ul>
<h2 id="m328">Plug-ins und eingebettete Funktionen sowie Inhalte</h2><p>Wir binden Funktions- und Inhaltselemente in unser Onlineangebot ein, die von den Servern ihrer jeweiligen Anbieter (nachfolgend als „Drittanbieter" bezeichnet) bezogen werden. Dabei kann es sich zum Beispiel um Grafiken, Videos oder Stadtpläne handeln (nachfolgend einheitlich als „Inhalte" bezeichnet).</p>
<p>Die Einbindung setzt immer voraus, dass die Drittanbieter dieser Inhalte die IP-Adresse der Nutzer verarbeiten, da sie ohne IP-Adresse die Inhalte nicht an deren Browser senden könnten. Die IP-Adresse ist damit für die Darstellung dieser Inhalte oder Funktionen erforderlich. Wir bemühen uns, nur solche Inhalte zu verwenden, deren jeweilige Anbieter die IP-Adresse lediglich zur Auslieferung der Inhalte anzuwenden. Drittanbieter können ferner sogenannte Pixel-Tags (unsichtbare Grafiken, auch als „Web Beacons" bezeichnet) für statistische oder Marketingzwecke einsetzen. Durch die „Pixel-Tags" können Informationen, wie etwa der Besucherverkehr auf den Seiten dieser Website, ausgewertet werden. Die pseudonymen Informationen können darüber hinaus in Cookies auf dem Gerät der Nutzer gespeichert werden und unter anderem technische Auskünfte zum Browser und zum Betriebssystem, zu verweisenden Websites, zur Besuchszeit sowie weitere Angaben zur Nutzung unseres Onlineangebots enthalten, aber auch mit solchen Informationen aus anderen Quellen verbunden werden.</p>
<p><strong>Hinweise zu Rechtsgrundlagen:</strong> Sofern wir die Nutzer um ihre Einwilligung in den Einsatz der Drittanbieter bitten, stellt die Rechtsgrundlage der Datenverarbeitung die Erlaubnis dar. Ansonsten werden die Nutzerdaten auf Grundlage unserer berechtigten Interessen (d. h. Interesse an effizienten, wirtschaftlichen und empfängerfreundlichen Leistungen) verarbeitet. In diesem Zusammenhang möchten wir Sie auch auf die Informationen zur Verwendung von Cookies in dieser Datenschutzerklärung hinweisen.</p>
<ul class="m-elements"><li><strong>Verarbeitete Datenarten:</strong> Nutzungsdaten (z. B. Seitenaufrufe und Verweildauer, Klickpfade, Nutzungsintensität und -frequenz, verwendete Gerätetypen und Betriebssysteme, Interaktionen mit Inhalten und Funktionen). Meta-, Kommunikations- und Verfahrensdaten (z. B. IP-Adressen, Zeitangaben, Identifikationsnummern, beteiligte Personen).</li><li><strong>Betroffene Personen:</strong> Nutzer (z. B. Webseitenbesucher, Nutzer von Onlinediensten).</li><li><strong>Zwecke der Verarbeitung:</strong> Bereitstellung unseres Onlineangebotes und Nutzerfreundlichkeit.</li><li><strong>Aufbewahrung und Löschung:</strong> Löschung entsprechend Angaben im Abschnitt "Allgemeine Informationen zur Datenspeicherung und Löschung". Speicherung von Cookies von bis zu 2 Jahren (Sofern nicht anders angegeben, können Cookies und ähnliche Speichermethoden für einen Zeitraum von zwei Jahren auf den Geräten der Nutzer gespeichert werden.).</li><li class=""><strong>Rechtsgrundlagen:</strong> Einwilligung (Art. 6 Abs. 1 S. 1 lit. a) DSGVO). Berechtigte Interessen (Art. 6 Abs. 1 S. 1 lit. f) DSGVO).</li></ul><p><strong>Weitere Hinweise zu Verarbeitungsprozessen, Verfahren und Diensten:</strong></p><ul class="m-elements"><li><strong>Google Fonts (Bezug vom Google Server): </strong>Bezug von Schriften (und Symbolen) zum Zwecke einer technisch sicheren, wartungsfreien und effizienten Nutzung von Schriften und Symbolen im Hinblick auf Aktualität und Ladezeiten, deren einheitliche Darstellung und Berücksichtigung möglicher lizenzrechtlicher Beschränkungen. Dem Anbieter der Schriftarten wird die IP-Adresse des Nutzers mitgeteilt, damit die Schriftarten im Browser des Nutzers zur Verfügung gestellt werden können. Darüber hinaus werden technische Daten (Spracheinstellungen, Bildschirmauflösung, Betriebssystem, verwendete Hardware) übermittelt, die für die Bereitstellung der Schriften in Abhängigkeit von den verwendeten Geräten und der technischen Umgebung notwendig sind. Diese Daten können auf einem Server des Anbieters der Schriftarten in den USA verarbeitet werden - Beim Besuch unseres Onlineangebotes senden die Browser der Nutzer ihre Browser HTTP-Anfragen an die Google Fonts Web API (d. h. eine Softwareschnittstelle für den Abruf der Schriftarten). Die Google Fonts Web API stellt den Nutzern die Cascading Style Sheets (CSS) von Google Fonts und danach die in der CCS angegebenen Schriftarten zur Verfügung. Zu diesen HTTP-Anfragen gehören (1) die vom jeweiligen Nutzer für den Zugriff auf das Internet verwendete IP-Adresse, (2) die angeforderte URL auf dem Google-Server und (3) die HTTP-Header, einschließlich des User-Agents, der die Browser- und Betriebssystemversionen der Websitebesucher beschreibt, sowie die Verweis-URL (d. h. die Webseite, auf der die Google-Schriftart angezeigt werden soll). IP-Adressen werden weder auf Google-Servern protokolliert noch gespeichert und sie werden nicht analysiert. Die Google Fonts Web API protokolliert Details der HTTP-Anfragen (angeforderte URL, User-Agent und Verweis-URL). Der Zugriff auf diese Daten ist eingeschränkt und streng kontrolliert. Die angeforderte URL identifiziert die Schriftfamilien, für die der Nutzer Schriftarten laden möchte. Diese Daten werden protokolliert, damit Google bestimmen kann, wie oft eine bestimmte Schriftfamilie angefordert wird. Bei der Google Fonts Web API muss der User-Agent die Schriftart anpassen, die für den jeweiligen Browsertyp generiert wird. Der User-Agent wird in erster Linie zum Debugging protokolliert und verwendet, um aggregierte Nutzungsstatistiken zu generieren, mit denen die Beliebtheit von Schriftfamilien gemessen wird. Diese zusammengefassten Nutzungsstatistiken werden auf der Seite „Analysen" von Google Fonts veröffentlicht. Schließlich wird die Verweis-URL protokolliert, sodass die Daten für die Wartung der Produktion verwendet und ein aggregierter Bericht zu den Top-Integrationen basierend auf der Anzahl der Schriftartenanfragen generiert werden kann. Google verwendet laut eigener Auskunft keine der von Google Fonts erfassten Informationen, um Profile von Endnutzern zu erstellen oder zielgerichtete Anzeigen zu schalten; <strong>Dienstanbieter:</strong> Google Ireland Limited, Gordon House, Barrow Street, Dublin 4, Irland; <span class=""><strong>Rechtsgrundlagen:</strong> Berechtigte Interessen (Art. 6 Abs. 1 S. 1 lit. f) DSGVO); </span><strong>Website:</strong> <a href="https://fonts.google.com/" target="_blank">https://fonts.google.com/</a>; <strong>Datenschutzerklärung:</strong> <a href="https://policies.google.com/privacy" target="_blank">https://policies.google.com/privacy</a>; <strong>Grundlage Drittlandtransfers:</strong> EU/EWR - Data Privacy Framework (DPF), Schweiz - Data Privacy Framework (DPF). <strong>Weitere Informationen:</strong> <a href="https://developers.google.com/fonts/faq/privacy?hl=de" target="_blank">https://developers.google.com/fonts/faq/privacy?hl=de</a>.</li></ul>
<p class="seal"><a href="https://datenschutz-generator.de/" title="Rechtstext von Dr. Schwenke - für weitere Informationen bitte anklicken." target="_blank" rel="noopener noreferrer nofollow">Erstellt mit kostenlosem Datenschutz-Generator.de von Dr. Thomas Schwenke</a></p>
</section>
<!-- ERSETZE DEN INHALT DEINER <section id="admin"> HIERMIT -->
<section id="admin" class="page-section py-12 fade-in">
    <div class="container mx-auto px-6 max-w-6xl">
        <h2 class="text-4xl font-bold text-white mb-8 text-center">Admin-Dashboard</h2>

        <!-- Admin Tabs -->
        <div id="admin-tabs" class="border-b border-gray-700 mb-6 flex justify-center gap-6">
            <button data-target="admin-content-users" class="profile-tab-btn font-semibold pb-3 border-b-2 active">Nutzerverwaltung</button>
            <button data-target="admin-content-blog" class="profile-tab-btn font-semibold pb-3 border-b-2">Blog-Verwaltung</button>
        </div>

        <!-- Admin Tab Inhalte -->
        <div id="admin-tab-content-container">

            <!-- Nutzerverwaltung (dein bisheriger Code) -->
            <div id="admin-content-users" class="profile-tab-content active">
                <div class="bg-gray-800 border border-gray-700 rounded-xl p-8">
                    <div class="mb-4">
                        <input type="text" id="admin-user-filter" placeholder="Nach Nutzername oder E-Mail filtern..." class="w-full bg-gray-900 border border-gray-600 rounded-lg p-3 focus:outline-none focus:ring-2 focus:ring-yellow-400 text-gray-50">
                    </div>
                    <div class="overflow-x-auto">
                        <table class="min-w-full text-sm text-left text-gray-300">
                            <thead class="text-xs text-gray-400 uppercase bg-gray-700/50">
                                <tr>
                                    <th scope="col" class="px-6 py-3">Nutzername</th>
                                    <th scope="col" class="px-6 py-3">E-Mail</th>
                                    <th scope="col" class="px-6 py-3">Level / XP</th>
                                    <th scope="col" class="px-6 py-3">Registriert am</th>
                                    <th scope="col" class="px-6 py-3">Aktionen</th>
                                </tr>
                            </thead>
                            <tbody id="admin-user-list-body"></tbody>
                        </table>
                    </div>
                    <div id="admin-user-list-empty" class="hidden text-center text-gray-500 py-10">Keine Nutzer gefunden.</div>
                </div>
            </div>

            <!-- Blog-Verwaltung (NEU) -->
            <div id="admin-content-blog" class="profile-tab-content">
                <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                    <!-- Formular für neue Beiträge -->
                    <div class="md:col-span-1">
                        <div class="bg-gray-800 border border-gray-700 rounded-xl p-6">
                            <h3 class="text-xl font-bold text-white mb-4">Neuen Beitrag erstellen</h3>
                            <form id="blog-post-form" class="space-y-4">
                                <input type="hidden" id="blog-post-id">
                                <div>
                                    <label for="blog-post-title" class="block text-sm font-medium text-gray-300">Titel</label>
                                    <input type="text" id="blog-post-title" required class="mt-1 w-full bg-gray-900 border border-gray-600 rounded-lg p-3 focus:outline-none focus:ring-2 focus:ring-yellow-400 text-gray-50">
                                </div>
                                <div>
                                    <label for="blog-post-content" class="block text-sm font-medium text-gray-300">Inhalt</label>
                                    <textarea id="blog-post-content" rows="10" required class="mt-1 w-full bg-gray-900 border border-gray-600 rounded-lg p-3 focus:outline-none focus:ring-2 focus:ring-yellow-400 text-gray-50"></textarea>
                                </div>
                                <div class="flex gap-4">
                                    <button type="submit" class="w-full bg-yellow-500 text-gray-900 font-semibold py-2 rounded-lg hover:bg-yellow-400 transition-colors">Beitrag speichern</button>
                                    <button type="button" id="clear-blog-form" class="w-full bg-gray-600 text-white font-semibold py-2 rounded-lg hover:bg-gray-500 transition-colors">Leeren</button>
                                </div>
                            </form>
                        </div>
                    </div>
                    <!-- Liste bestehender Beiträge -->
                    <div class="md:col-span-2">
                        <div class="bg-gray-800 border border-gray-700 rounded-xl p-6">
                            <h3 class="text-xl font-bold text-white mb-4">Bestehende Beiträge</h3>
                            <div id="admin-blog-post-list" class="space-y-4">
                                <!-- Beiträge werden hier per JS geladen -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </div>
</section>
    </main>
    
   <footer class="bg-gray-800 border-t border-gray-700 mt-20">
        <div class="container mx-auto px-6 py-4 text-center">
            <div class="flex justify-center gap-6 mb-4">
                <a href="#impressum" class="text-gray-400 hover:text-white nav-trigger">Impressum</a>
                <a href="#datenschutz" class="text-gray-400 hover:text-white nav-trigger">Datenschutz</a>
                <button id="open-cookie-settings" class="text-gray-400 hover:text-white">Cookie-Einstellungen</button>
            </div>
            <p class="text-gray-400 text-sm mb-2">Besucher: <span id="visit-counter">Lade...</span></p>
            <p class="text-gray-400 text-sm">&copy; 2025 GameMatch. Alle Rechte vorbehalten. Made with ❤️ in Austria</p>
        </div>
    </footer>

    <!-- Cookie Banner mit Opt-out-Möglichkeit -->
    <div id="cookie-banner" class="fixed bottom-0 left-0 right-0 bg-gray-800 border-t border-gray-700 p-4 shadow-lg z-50 hidden">
        <div class="container mx-auto max-w-6xl">
            <div class="flex flex-col md:flex-row md:items-center justify-between gap-4">
                <div class="flex-1">
                    <p class="text-gray-300">
                        Wir verwenden Cookies, um die Funktionalität der Website zu gewährleisten und deine Erfahrung zu verbessern. 
                        <a href="#datenschutz" class="text-cyan-400 hover:underline nav-trigger">Mehr erfahren</a>
                    </p>
                </div>
                <div class="flex flex-col sm:flex-row gap-2">
                    <button id="accept-necessary-cookies" class="px-4 py-2 bg-gray-700 hover:bg-gray-600 text-white rounded-lg transition-colors">
                        Nur notwendige Cookies
                    </button>
                    <button id="accept-all-cookies" class="px-4 py-2 bg-cyan-600 hover:bg-cyan-500 text-white rounded-lg transition-colors">
                        Alle Cookies akzeptieren
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Cookie Einstellungen Modal -->
    <div id="cookie-settings-modal" class="fixed inset-0 bg-black bg-opacity-70 z-[1000] flex items-center justify-center p-4 invisible opacity-0 transition-opacity">
        <div class="glow-bg bg-gray-800 rounded-xl p-6 w-full max-w-2xl border border-cyan-700/50 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-4">Cookie-Einstellungen</h2>
            
            <div class="space-y-6">
                <div class="border-b border-gray-700 pb-4">
                    <div class="flex items-center justify-between mb-2">
                        <h3 class="text-lg font-semibold text-white">Notwendige Cookies</h3>
                        <span class="px-2 py-1 bg-gray-700 text-xs rounded text-gray-300">Immer aktiv</span>
                    </div>
                    <p class="text-gray-400 text-sm">
                        Diese Cookies sind für den Betrieb der Website essenziell und können nicht deaktiviert werden.
                    </p>
                </div>
                
                <div class="border-b border-gray-700 pb-4">
                    <div class="flex items-center justify-between mb-2">
                        <h3 class="text-lg font-semibold text-white">Funktionale Cookies</h3>
                        <label class="relative inline-flex items-center cursor-pointer">
                            <input type="checkbox" id="functional-cookies" class="sr-only peer" checked>
                            <div class="w-11 h-6 bg-gray-700 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-0.5 after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-cyan-600"></div>
                        </label>
                    </div>
                    <p class="text-gray-400 text-sm">
                        Ermöglichen erweiterte Funktionen wie gespeicherte Anmeldedaten und Einstellungen.
                    </p>
                </div>
                
                <div class="border-b border-gray-700 pb-4">
                    <div class="flex items-center justify-between mb-2">
                        <h3 class="text-lg font-semibold text-white">Analytics Cookies</h3>
                        <label class="relative inline-flex items-center cursor-pointer">
                            <input type="checkbox" id="analytics-cookies" class="sr-only peer">
                            <div class="w-11 h-6 bg-gray-700 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-0.5 after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-cyan-600"></div>
                        </label>
                    </div>
                    <p class="text-gray-400 text-sm">
                        Helfen uns zu verstehen, wie Besucher unsere Website nutzen.
                    </p>
                </div>
            </div>
            
            <div class="flex justify-end gap-4 mt-6">
                <button id="save-cookie-settings" class="px-6 py-2 bg-cyan-600 hover:bg-cyan-500 text-white rounded-lg transition-colors">
                    Einstellungen speichern
                </button>
                <button id="close-cookie-settings" class="px-6 py-2 bg-gray-700 hover:bg-gray-600 text-white rounded-lg transition-colors">
                    Abbrechen
                </button>
            </div>
        </div>
    </div>
    <canvas id="confetti-canvas" class="fixed top-0 left-0 w-full h-full pointer-events-none z-50"></canvas>

<div id="auth-modal" class="auth-modal fixed inset-0 bg-black bg-opacity-70 z-[100] flex items-center justify-center p-4 invisible opacity-0">
    <div id="auth-modal-content" class="auth-modal-content glow-bg bg-gray-800 rounded-2xl w-full max-w-md p-8 border border-cyan-700/50 shadow-2xl shadow-cyan-900/20 transform scale-95">
        
        <div id="login-view">
            <h2 data-i18n="auth_welcome_back" class="text-2xl font-bold text-white text-center mb-6"></h2>
            <form id="login-form" class="space-y-4">
                <input type="email" id="login-email" data-i18n="[placeholder]auth_placeholder_email" required class="w-full bg-gray-900 border border-gray-600 rounded-lg p-3 focus:outline-none focus:ring-2 focus:ring-cyan-500 text-gray-50">
                
                <input type="password" id="login-password" data-i18n="[placeholder]auth_placeholder_password" required class="w-full bg-gray-900 border border-gray-600 rounded-lg p-3 focus:outline-none focus:ring-2 focus:ring-cyan-500 text-gray-50">
                
                <p id="login-error" class="text-red-400 text-sm hidden"></p>
                <button type="submit" data-i18n="nav_login" class="w-full bg-cyan-600 text-white font-semibold py-3 rounded-lg hover:bg-cyan-500 transition-colors"></button>
            </form>
            <div class="flex items-center my-4">
                <hr class="flex-grow border-gray-600">
                <span data-i18n="auth_or" class="px-2 text-gray-400 text-sm"></span>
                <hr class="flex-grow border-gray-600">
            </div>
            <button id="google-signin-btn" class="w-full bg-gray-700 text-white font-semibold py-3 rounded-lg hover:bg-gray-600 transition-colors flex items-center justify-center gap-2">
                <svg class="w-5 h-5" viewBox="0 0 48 48"><path fill="#FFC107" d="M43.611,20.083H42V20H24v8h11.303c-1.649,4.657-6.08,8-11.303,8c-6.627,0-12-5.373-12-12s5.373-12,12-12c3.059,0,5.842,1.154,7.961,3.039l5.657-5.657C34.046,6.053,29.268,4,24,4C12.955,4,4,12.955,4,24s8.955,20,20,20s20-8.955,20-20C44,22.659,43.862,21.35,43.611,20.083z"></path><path fill="#FF3D00" d="M6.306,14.691l6.571,4.819C14.655,15.108,18.961,12,24,12c3.059,0,5.842,1.154,7.961,3.039l5.657-5.657C34.046,6.053,29.268,4,24,4C16.318,4,9.656,8.337,6.306,14.691z"></path><path fill="#4CAF50" d="M24,44c5.166,0,9.86-1.977,13.409-5.192l-6.19-5.238C29.211,35.091,26.715,36,24,36c-5.202,0-9.619-3.317-11.283-7.946l-6.522,5.025C9.505,39.556,16.227,44,24,44z"></path><path fill="#1976D2" d="M43.611,20.083H42V20H24v8h11.303c-0.792,2.237-2.231,4.166-4.087,5.571l6.19,5.238C42.021,35.596,44,30.138,44,24C44,22.659,43.862,21.35,43.611,20.083z"></path></svg>
                <span data-i18n="auth_continue_with_google"></span>
            </button>
            <p class="text-center text-sm text-gray-400 mt-6">
                <span data-i18n="auth_no_account_yet"></span>
                <button data-i18n="nav_register" id="switch-to-register" class="font-semibold text-cyan-400 hover:underline"></button>
            </p>
        </div>

        <div id="register-view" class="hidden">
            <h2 data-i18n="auth_register_title" class="text-2xl font-bold text-white text-center mb-6"></h2>
             <form id="register-form" class="space-y-4">
                <input type="email" id="register-email" data-i18n="[placeholder]auth_placeholder_email" required class="w-full bg-gray-900 border border-gray-600 rounded-lg p-3">
                <input type="text" id="register-username" data-i18n="[placeholder]auth_placeholder_username" required class="w-full bg-gray-900 border border-gray-600 rounded-lg p-3">
                <input type="password" id="register-password" data-i18n="[placeholder]auth_placeholder_password_min" required class="w-full bg-gray-900 border border-gray-600 rounded-lg p-3">
                 <input type="text" id="register-referral-code" placeholder="Empfehlungscode (Optional)" class="w-full bg-gray-900 border border-gray-600 rounded-lg p-3">
                <p id="register-error" class="text-red-400 text-sm hidden"></p>
                <button type="submit" data-i18n="auth_create_account" class="w-full bg-cyan-500 text-gray-900 font-semibold py-3 rounded-lg hover:bg-cyan-400"></button>
            </form>
             <div class="flex items-center my-4">
                <hr class="flex-grow border-gray-600">
                <span data-i18n="auth_or" class="px-2 text-gray-400 text-sm"></span>
                <hr class="flex-grow border-gray-600">
            </div>
            <button id="google-signup-btn" class="w-full bg-gray-700 text-white font-semibold py-3 rounded-lg hover:bg-gray-600 transition-colors flex items-center justify-center gap-2">
                <svg class="w-5 h-5" viewBox="0 0 48 48"><path fill="#FFC107" d="M43.611,20.083H42V20H24v8h11.303c-1.649,4.657-6.08,8-11.303,8c-6.627,0-12-5.373-12-12s5.373-12,12-12c3.059,0,5.842,1.154,7.961,3.039l5.657-5.657C34.046,6.053,29.268,4,24,4C12.955,4,4,12.955,4,24s8.955,20,20,20s20-8.955,20-20C44,22.659,43.862,21.35,43.611,20.083z"></path><path fill="#FF3D00" d="M6.306,14.691l6.571,4.819C14.655,15.108,18.961,12,24,12c3.059,0,5.842,1.154,7.961,3.039l5.657-5.657C34.046,6.053,29.268,4,24,4C16.318,4,9.656,8.337,6.306,14.691z"></path><path fill="#4CAF50" d="M24,44c5.166,0,9.86-1.977,13.409-5.192l-6.19-5.238C29.211,35.091,26.715,36,24,36c-5.202,0-9.619-3.317-11.283-7.946l-6.522,5.025C9.505,39.556,16.227,44,24,44z"></path><path fill="#1976D2" d="M43.611,20.083H42V20H24v8h11.303c-0.792,2.237-2.231,4.166-4.087,5.571l6.19,5.238C42.021,35.596,44,30.138,44,24C44,22.659,43.862,21.35,43.611,20.083z"></path></svg>
                <span data-i18n="auth_register_with_google"></span>
            </button>
            <p class="text-center text-sm text-gray-400 mt-6">
                <span data-i18n="auth_already_have_account"></span>
                <button data-i18n="nav_login" id="switch-to-login" class="font-semibold text-cyan-400 hover:underline"></button>
            </p>
        </div>
        
        <button id="close-auth-modal-btn" class="absolute top-4 right-4 text-gray-500 hover:text-white transition-colors">
            <svg class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>
        </button>
    </div>
</div>

<div id="game-detail-modal" class="fixed inset-0 bg-black bg-opacity-70 z-[100] flex items-center justify-center p-4 invisible opacity-0 transition-opacity duration-300">
    <div id="game-detail-modal-content" class="bg-gray-800 rounded-2xl w-full max-w-4xl max-h-[90vh] flex flex-col border border-gray-700 shadow-2xl shadow-cyan-900/20 transform scale-95 transition-all duration-300">
        <div class="flex-shrink-0 p-4 border-b border-gray-700 flex justify-between items-center">
            <h2 id="modal-game-title" class="text-2xl font-bold text-white"></h2>
            <button id="close-comment-modal" class="text-gray-500 hover:text-white transition-colors">
                <svg class="w-8 h-8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>
            </button>
        </div>
        <div class="flex-grow overflow-y-auto p-6">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                    <img id="modal-game-image" src="https://placehold.co/600x400/111827/06B6D4?text=Lade..." data-i18n="[alt]matchmaker_alt_game_cover" class="w-full h-auto object-cover rounded-lg mb-4">
                    <p id="modal-game-description" class="text-gray-300"></p>
                </div>
                <div>
                    <h3 data-i18n="modal_community_ratings" class="text-xl font-semibold text-white mb-4"></h3>
                    <div id="modal-rating-section" class="space-y-3 mb-6"></div>
                    <h3 data-i18n="modal_comments" class="text-xl font-semibold text-white mb-4"></h3>
                    <div id="modal-comment-list" class="space-y-4 max-h-60 overflow-y-auto pr-2"></div>
                    <div id="modal-comment-form" class="mt-4 pt-4 border-t border-gray-700"></div>
                </div>
            </div>
        </div>
    </div>
</div>

    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-storage-compat.js"></script>
    <script>
function sanitizeHTML(str) {
    if (!str) return '';
    return str.replace(/[&<>"']/g, function(tag) {
        const replacements = {
            '&': '&amp;',
            '<': '&lt;',
            '>': '&gt;',
            '"': '&quot;',
            "'": '&#39;'
        };
        return replacements[tag] || tag;
    });
}
const partners = [
    {
        name: 'Bodycam',
        logoUrl: 'img/partners/logo2.png',
        websiteUrl: 'https://discord.gg/XwXvKGjUYy',
        description: 'BodyCam - der realistischste Shooter auf dem Markt, schaut heute noch auf dem Discord vorbei!'
    },
    {
        name: 'GameMatch - Discord',
        logoUrl: 'img/partners/logo1.png',
        websiteUrl: 'https://discord.gg/CTUERAwgNE', // Hier den Link zum Partner einfügen
        description: 'Besuche uns auf Discord'
    },
    {
        name: 'Partner 3',
        logoUrl: 'img/partners/logo3.png',
        websiteUrl: '#',
        description: 'Wir suchen nach weiteren Partnern'
    }
    // Füge hier bei Bedarf weitere Partner hinzu...
];
 const affiliatePartners = [
        {
            name: 'G2A',
            urlTemplate: 'https://www.g2a.com/search?query={{GAME_NAME}}&r=reflink-0a5413ec7b',
            logo: 'img/affiliates/g2a_logo.png'
        },
        {
            name: 'Instant Gaming',
            urlTemplate: 'https://www.instant-gaming.com/de/suche/?q={{GAME_NAME}}&igr=gamer-918c25',
            logo: 'img/affiliates/instant-gaming_logo.png'
        },
        {
            name: 'GAMIVO',
            urlTemplate: 'https://www.gamivo.com/search/{{GAME_NAME}}?glv=wbrggj3c',
            logo: 'img/affiliates/gamivo_logo.png'
        }
    ];
const translations = {
  de: {
    translation: {
      "nav_find_game": "Finde dein Spiel",
      "nav_login": "Login",
      "nav_register": "Registrieren",
      "nav_news": "News",
      "nav_community": "Community",
      "nav_partners": "Partner", 
      "partners_title": "Unsere Partner",
      "partners_subtitle": "Ein großes Dankeschön an die Communities und Projekte, die GameMatch unterstützen und mit denen wir zusammenarbeiten.",
      "nav_profile": "Mein Profil",
      "nav_leaderboard": "Rangliste",
      "nav_feedback": "Feedback",
      "nav_admin": "Admin",
      "nav_logout": "Logout",
      "hero_title": "Finde dein nächstes Lieblingsspiel. <br class=\"hidden md:inline\"/> Ohne endloses Scrollen.",
      "hero_subtitle": "Unser KI-Berater kennt deinen Geschmack. Egal ob du entspannen, schwitzen oder die Nacht durchzocken willst.",
      "hero_cta": "Jetzt dein Spiel finden,kostenlos",
      "daily_mission_title": "Tägliche Challenge",
      "daily_mission_reward": "Belohnung:",
      "daily_mission_cta": "Challenge ansehen!",
      "member_advantage": "Dein Vorteil als Mitglied",
      "become_part_of": "Werde Teil von GameMatch",
      "discover_platform": "Entdecke eine Plattform, die dich versteht. Vom perfekten Spielvorschlag bis zur lebendigen Community – hier findest du alles.",
      "feature_ai_title": "Deine persönliche KI",
      "feature_ai_desc": "Schluss mit der Unentschlossenheit. Unsere KI führt ein echtes Gespräch mit dir und findet zielsicher das Spiel, auf das du gerade wirklich Lust hast.",
      "feature_archive_title": "Dein Spiele-Archiv",
      "feature_archive_desc": "Jedes \"gelikte\" Spiel landet in deinem Profil. Bewerte und kommentiere deine Sammlung und baue dir so deinen digitalen Trophäenschrank auf.",
      "feature_crew_title": "Finde deine Crew",
      "feature_crew_desc": "Verbinde dich mit Gamern, die deinen Geschmack teilen. Vergleicht eure Sammlungen, entdeckt gemeinsame Favoriten und werdet Teil einer wachsenden Community.",
      "guest_cta_title": "Bereit für dein nächstes Lieblingsspiel?",
      "guest_cta_desc": "Als Gast kannst du unsere KI <strong>2-mal täglich</strong> kostenlos testen. <strong>Registriere dich jetzt</strong>, um unbegrenzte Vorschläge und alle oben genannten Features freizuschalten.",
      "guest_cta_register": "Jetzt kostenlos registrieren",
      "guest_cta_login": "Ich habe schon ein Konto &rarr;",
      "stay_updated": "Bleib auf dem Laufenden",
      "latest_news": "Aktuelles von GameMatch",
      "read_our_posts": "Lies unsere neuesten Beiträge über Updates, Spiel-Highlights und Community-News.",
      "loading_posts": "Lade neueste Beiträge...",
      "our_partners": "Unsere Partner",
      "community_title": "Community",
      "community_subtitle": "Entdecke andere Spieler oder verfolge die letzten Aktivitäten.",
      "community_tab_discover": "Nutzer entdecken",
      "community_tab_feed": "Aktivitäten",
      "community_search_placeholder": "Nach Benutzernamen filtern...",
      "community_no_users_found": "Keine anderen Nutzer gefunden.",
      "matchmaker_result_title": "Dein perfektes Match!",
      "matchmaker_reset_button": "Neues Gespräch starten &crarr;",
      "matchmaker_alt_game_cover": "Game Cover",
      "matchmaker_initial_greeting": "Hallo! Ich bin GameMatch. Damit ich das perfekte Spiel für dich finde, erzähl mir doch mal: Worauf hast du gerade Lust?",
      "matchmaker_initial_placeholder": "z.B. etwas Entspanntes zum Abschalten",
      "matchmaker_user_bubble": "Du",
      "matchmaker_ai_bubble": "GameMatch KI",
      "matchmaker_find_on_g2a": "Auf G2A finden",
      "matchmaker_error_title": "Hoppla!",
      "matchmaker_error_button": "Neu beginnen",
      "matchmaker_loading_ai": "KI denkt nach",
      "matchmaker_guest_limit_title": "Du hast dein Limit erreicht!",
      "matchmaker_guest_limit_desc": "Als Gast kannst du 3 Spiele pro Tag entdecken. Registriere dich jetzt kostenlos, um unbegrenzte Empfehlungen und viele weitere Features freizuschalten.",
      "matchmaker_guest_limit_register": "Jetzt Registrieren",
      "profile_alt_avatar": "Avatar",
      "profile_change_avatar": "Profilbild ändern",
      "profile_tab_games": "Meine Spiele",
      "profile_tab_friends": "Freunde",
      "profile_tab_stats": "Statistiken",
      "profile_tab_lfg": "Mitspieler finden",
      "profile_tab_news": "Gaming News",
      "profile_filter_all": "Alle",
      "profile_filter_liked": "👍 Gemocht",
      "profile_filter_disliked": "👎 Abgelehnt",
      "profile_no_saved_games": "Du hast noch keine Spiele gespeichert.",
      "profile_lfg_title": "Wähle ein Spiel, um Mitspieler zu finden",
      "profile_lfg_back_button": "&larr; Zurück zur Spielauswahl",
      "profile_friend_requests_title": "Offene Freundschaftsanfragen",
      "profile_friends_list_title": "Meine Freundesliste",
      "profile_stat_rank": "Rang",
      "profile_stat_level": "Level",
      "profile_stat_xp": "XP",
      "profile_loading": "Lade...",
      "profile_user_not_found": "Nutzer nicht gefunden",
      "profile_no_friends": "Du hast noch keine Freunde.",
      "profile_friends_list_private": "Du kannst nur deine eigene Freundesliste einsehen.",
      "profile_error_loading": "Fehler beim Laden",
      "profile_lfg_loading_games": "Lade deine Spiele...",
      "profile_lfg_no_liked_games": "Du hast noch keine Spiele gelikt, um Mitspieler zu finden.",
      "profile_lfg_error_loading": "Fehler beim Laden deiner Spiele.",
      "profile_lfg_results_title": "Spieler, die auch \"{{gameTitle}}\" mögen:",
      "profile_lfg_searching": "Suche nach Spielern...",
      "profile_lfg_no_one_else": "Noch niemand außer dir mag dieses Spiel.",
      "profile_lfg_trendsetter": "Bisher hat nur du dieses Spiel gelikt. Sei ein Trendsetter!",
      "profile_lfg_error_player_list": "Spielerliste konnte nicht geladen werden.",
      "profile_games_compare": "Vergleichen",
      "profile_games_chat": "Chat",
      "profile_xp_until_next_level": "{{xp}} XP bis Lvl {{level}}",
      "profile_load_more": "Mehr laden",
      "profile_no_games_for_filter": "Keine Spiele für den Filter \"{{filter}}\" gefunden.",
      "alert_friend_request_accepted": "Freundschaftsanfrage angenommen!",
      "alert_friend_request_declined": "Freundschaftsanfrage abgelehnt.",
      "alert_login_to_send_request": "Bitte logge dich ein, um Anfragen zu senden.",
      "alert_request_already_sent": "Du hast bereits eine Anfrage an diesen Nutzer gesendet oder bist bereits mit ihm befreundet.",
      "alert_friend_request_sent": "Freundschaftsanfrage gesendet!",
      "alert_friend_request_failed": "Die Anfrage konnte nicht gesendet werden.",
      "prompt_enter_new_username": "Gib deinen neuen Benutzernamen ein:",
      "alert_username_empty": "Der Benutzername darf nicht leer sein.",
      "alert_username_changed": "Benutzername erfolgreich geändert!",
      "alert_username_change_failed": "Der Name konnte nicht geändert werden.",
      "alert_uploading_image": "Lade Bild hoch...",
      "alert_avatar_changed": "Profilbild erfolgreich aktualisiert!",
      "alert_avatar_failed": "Upload fehlgeschlagen.",
      "button_text_requested": "Angefragt",
      "leaderboard_title": "Rangliste",
      "leaderboard_subtitle": "Die Top 10 Spieler mit den meisten Erfahrungspunkten.",
      "leaderboard_loading": "Lade Rangliste...",
      "leaderboard_no_players": "Noch keine Spieler in der Rangliste.",
      "leaderboard_error": "Rangliste konnte nicht geladen werden.",
      "news_title": "Neuigkeiten & Updates",
      "news_loading": "Lade Beiträge...",
      "news_no_posts": "Es gibt noch keine Neuigkeiten.",
      "news_error": "Beiträge konnten nicht geladen werden.",
      "news_published_on": "Veröffentlicht am",
      "auth_welcome_back": "Willkommen zurück!",
      "auth_placeholder_email": "E-Mail",
      "auth_placeholder_password": "Passwort",
      "auth_placeholder_username": "Benutzername",
      "auth_placeholder_password_min": "Passwort (min. 6 Zeichen)",
      "auth_or": "ODER",
      "auth_continue_with_google": "Mit Google fortfahren",
      "auth_no_account_yet": "Noch kein Konto?",
      "auth_register_title": "Werde Teil der Community",
      "auth_create_account": "Konto erstellen",
      "auth_register_with_google": "Mit Google registrieren",
      "auth_already_have_account": "Bereits ein Konto?",
      "modal_loading_game": "Spiel wird geladen...",
      "modal_loading_description": "Beschreibung wird geladen...",
      "modal_community_ratings": "Community-Bewertungen",
      "modal_comments": "Kommentare",
      "alert_register_success": "Registrierung erfolgreich! Du bist jetzt eingeloggt.",
      "alert_login_success": "Login erfolgreich!",
      "alert_account_banned": "Dein Account wurde gesperrt. Bitte kontaktiere den Support.",
      "alert_google_register_success": "Konto erfolgreich mit Google erstellt!",
      "alert_google_welcome_back": "Willkommen zurück, {{name}}!",
      "alert_google_signin_error": "Google Sign-In Fehler ({{errorCode}}): {{errorMessage}}",
      "alert_logout_success": "Du wurdest erfolgreich ausgeloggt.",
      "alert_logout_error": "Fehler beim Logout: {{message}}",
      "alert_comment_failed": "Fehler beim Speichern deines Kommentars.",
      "alert_login_for_rating": "Bitte logge dich ein, um eine Bewertung abzugeben.",
      "alert_rating_success": "Danke für deine Bewertung!",
      "alert_rating_failed": "Deine Bewertung konnte nicht gespeichert werden.",
      "footer_imprint": "Impressum",
      "footer_privacy": "Datenschutz",
      "footer_cookies": "Cookie-Einstellungen",
      "footer_visitors": "Besucher:",
      "footer_copyright": "&copy; 2025 GameMatch. Alle Rechte vorbehalten. Made with ❤️ in Austria",
      "cookie_banner_text": "Wir verwenden Cookies, um die Funktionalität der Website zu gewährleisten und deine Erfahrung zu verbessern.",
      "cookie_learn_more": "Mehr erfahren",
      "cookie_accept_necessary": "Nur notwendige Cookies",
      "cookie_accept_all": "Alle Cookies akzeptieren",
      "cookie_settings_title": "Cookie-Einstellungen",
      "cookie_necessary_title": "Notwendige Cookies",
      "cookie_necessary_active": "Immer aktiv",
      "cookie_necessary_desc": "Diese Cookies sind für den Betrieb der Website essenziell und können nicht deaktiviert werden.",
      "cookie_functional_title": "Funktionale Cookies",
      "cookie_functional_desc": "Ermöglichen erweiterte Funktionen wie gespeicherte Anmeldedaten und Einstellungen.",
      "cookie_analytics_title": "Analytics Cookies",
      "cookie_analytics_desc": "Helfen uns zu verstehen, wie Besucher unsere Website nutzen.",
      "cookie_save_settings": "Einstellungen speichern",
      "cookie_cancel": "Abbrechen",
      "admin_dashboard_title": "Admin-Dashboard",
      "admin_tab_users": "Nutzerverwaltung",
      "admin_tab_blog": "Blog-Verwaltung",
      "admin_users_filter_placeholder": "Nach Nutzername oder E-Mail filtern...",
      "admin_users_th_user": "Nutzername",
      "admin_users_th_email": "E-Mail",
      "admin_users_th_level": "Level / XP",
      "admin_users_th_registered": "Registriert am",
      "admin_users_th_actions": "Aktionen",
      "admin_users_no_users": "Keine Nutzer gefunden.",
      "admin_blog_create_title": "Neuen Beitrag erstellen",
      "admin_blog_form_title": "Titel",
      "admin_blog_form_content": "Inhalt",
      "admin_blog_form_save": "Beitrag speichern",
      "admin_blog_form_clear": "Leeren",
      "admin_blog_existing_title": "Bestehende Beiträge",
      "admin_blog_edit": "Bearbeiten",
      "admin_blog_delete": "Löschen",
      "chat_back": "&larr; Zurück",
      "chat_loading": "Lade...",
      "chat_placeholder": "Nachricht schreiben...",
      "chat_send": "Senden",
      "profile_request_received": "hat dir eine Anfrage gesendet.",
      "profile_request_accept": "Annehmen",
      "profile_request_decline": "Ablehnen",
      "giveaway_banner_title": "Sommer-Giveaway!",
    "giveaway_banner_text": "Gewinne einen 50€ Steam-Gutschein! Der Nutzer mit den meisten XP am 31. August gewinnt. Viel Glück!",
    "feature_section_title": "Dein persönliches Gaming-Universum",
    "feature_section_subtitle": "Mehr als nur Empfehlungen",
    "feature_section_desc": "Ein GameMatch-Konto ist dein zentraler Hub für alles, was mit deinen Spielen zu tun hat. Sammle, teile und verfolge deinen Fortschritt.",
    "feature_new_library_title": "Deine Bibliothek",
    "feature_new_library_desc": "Jedes Spiel, das du magst, wird hier gespeichert. Erstelle deine ultimative Sammlung, bewerte sie und zeige sie deinen Freunden.",
    "feature_new_crew_title": "Deine Crew",
    "feature_new_crew_desc": "Finde Spieler, die deinen Geschmack teilen. Vergleicht eure Bibliotheken und findet heraus, welche Spiele ihr gemeinsam zocken könnt.",
    "feature_new_progress_title": "Dein Fortschritt",
    "feature_new_progress_desc": "Sammle für deine Aktivitäten auf der Seite Erfahrungspunkte (XP), steige im Level auf und schalte neue Ränge frei.",
    }
  },
  en: {
    translation: {
      "nav_find_game": "Find your Game",
      "nav_login": "Login",
      "nav_register": "Register",
      "nav_news": "News",
      "nav_community": "Community",
      "nav_partners": "Partners",
      "partners_title": "Our Partners",
      "partners_subtitle": "A huge thank you to the communities and projects that support GameMatch and collaborate with us.",
      "nav_profile": "My Profile",
      "nav_leaderboard": "Leaderboard",
      "nav_feedback": "Feedback",
      "nav_admin": "Admin",
      "nav_logout": "Logout",
      "hero_title": "Find your next favorite game. <br class=\"hidden md:inline\"/> Without endless scrolling.",
      "hero_subtitle": "Our AI advisor knows your taste. Whether you want to relax, sweat, or game all night.",
      "hero_cta": "Find your game now,free",
      "daily_mission_title": "Your Daily Mission",
      "daily_mission_reward": "Reward:",
      "daily_mission_cta": "View Challenge!",
      "member_advantage": "Your Advantage as a Member",
      "become_part_of": "Become a Part of GameMatch",
      "discover_platform": "Discover a platform that understands you. From the perfect game suggestion to a vibrant community – you'll find everything here.",
      "feature_ai_title": "Your Personal AI",
      "feature_ai_desc": "No more indecision. Our AI has a real conversation with you and reliably finds the game you're in the mood for.",
      "feature_archive_title": "Your Game Archive",
      "feature_archive_desc": "Every \"liked\" game lands in your profile. Rate and comment on your collection and build your digital trophy case.",
      "feature_crew_title": "Find Your Crew",
      "feature_crew_desc": "Connect with gamers who share your taste. Compare your collections, discover mutual favorites, and become part of a growing community.",
      "guest_cta_title": "Ready for your next favorite game?",
      "guest_cta_desc": "As a guest, you can test our AI <strong>2 times daily</strong> for free. <strong>Register now</strong> to unlock unlimited suggestions and all the features mentioned above.",
      "guest_cta_register": "Register now for free",
      "guest_cta_login": "I already have an account &rarr;",
      "stay_updated": "Stay Up-to-Date",
      "latest_news": "Latest from GameMatch",
      "read_our_posts": "Read our latest posts about updates, game highlights, and community news.",
      "loading_posts": "Loading latest posts...",
      "our_partners": "Our Partners",
      "community_title": "Community",
      "community_subtitle": "Discover other players or follow the latest activities.",
      "community_tab_discover": "Discover Users",
      "community_tab_feed": "Activity Feed",
      "community_search_placeholder": "Filter by username...",
      "community_no_users_found": "No other users found.",
      "matchmaker_result_title": "Your Perfect Match!",
      "matchmaker_reset_button": "Start a new conversation &crarr;",
      "matchmaker_alt_game_cover": "Game Cover",
      "matchmaker_initial_greeting": "Hi! I'm GameMatch. To help me find the perfect game for you, tell me: What are you in the mood for?",
      "matchmaker_initial_placeholder": "e.g., something relaxing to unwind",
      "matchmaker_user_bubble": "You",
      "matchmaker_ai_bubble": "GameMatch AI",
      "matchmaker_find_on_g2a": "Find on G2A",
      "matchmaker_error_title": "Oops!",
      "matchmaker_error_button": "Start Over",
      "matchmaker_loading_ai": "AI is thinking",
      "matchmaker_guest_limit_title": "You've reached your limit!",
      "matchmaker_guest_limit_desc": "As a guest, you can discover 3 games per day. Register now for free to unlock unlimited recommendations and many more features.",
      "matchmaker_guest_limit_register": "Register Now",
      "profile_alt_avatar": "Avatar",
      "profile_change_avatar": "Change profile picture",
      "profile_tab_games": "My Games",
      "profile_tab_friends": "Friends",
      "profile_tab_stats": "Statistics",
      "profile_tab_lfg": "Find Players",
      "profile_tab_news": "Gaming News",
      "profile_filter_all": "All",
      "profile_filter_liked": "👍 Liked",
      "profile_filter_disliked": "👎 Disliked",
      "profile_no_saved_games": "You haven't saved any games yet.",
      "profile_lfg_title": "Select a game to find players",
      "profile_lfg_back_button": "&larr; Back to game selection",
      "profile_friend_requests_title": "Open Friend Requests",
      "profile_friends_list_title": "My Friend List",
      "profile_stat_rank": "Rank",
      "profile_stat_level": "Level",
      "profile_stat_xp": "XP",
      "profile_loading": "Loading...",
      "profile_user_not_found": "User not found",
      "profile_no_friends": "You don't have any friends yet.",
      "profile_friends_list_private": "You can only view your own friend list.",
      "profile_error_loading": "Error loading",
      "profile_lfg_loading_games": "Loading your games...",
      "profile_lfg_no_liked_games": "You haven't liked any games to find players for.",
      "profile_lfg_error_loading": "Error loading your games.",
      "profile_lfg_results_title": "Players who also like \"{{gameTitle}}\":",
      "profile_lfg_searching": "Searching for players...",
      "profile_lfg_no_one_else": "Nobody else likes this game yet.",
      "profile_lfg_trendsetter": "So far, only you have liked this game. Be a trendsetter!",
      "profile_lfg_error_player_list": "Player list could not be loaded.",
      "profile_games_compare": "Compare",
      "profile_games_chat": "Chat",
      "profile_xp_until_next_level": "{{xp}} XP to Lvl {{level}}",
      "profile_load_more": "Load more",
      "profile_no_games_for_filter": "No games found for the \"{{filter}}\" filter.",
      "alert_friend_request_accepted": "Friend request accepted!",
      "alert_friend_request_declined": "Friend request declined.",
      "alert_login_to_send_request": "Please log in to send requests.",
      "alert_request_already_sent": "You have already sent a request to this user or are already friends.",
      "alert_friend_request_sent": "Friend request sent!",
      "alert_friend_request_failed": "The request could not be sent.",
      "prompt_enter_new_username": "Enter your new username:",
      "alert_username_empty": "Username cannot be empty.",
      "alert_username_changed": "Username changed successfully!",
      "alert_username_change_failed": "The name could not be changed.",
      "alert_uploading_image": "Uploading image...",
      "alert_avatar_changed": "Profile picture updated successfully!",
      "alert_avatar_failed": "Upload failed.",
      "button_text_requested": "Requested",
      "leaderboard_title": "Leaderboard",
      "leaderboard_subtitle": "The Top 10 players with the most experience points.",
      "leaderboard_loading": "Loading leaderboard...",
      "leaderboard_no_players": "No players on the leaderboard yet.",
      "leaderboard_error": "Leaderboard could not be loaded.",
      "news_title": "News & Updates",
      "news_loading": "Loading posts...",
      "news_no_posts": "There are no news yet.",
      "news_error": "Posts could not be loaded.",
      "news_published_on": "Published on",
      "auth_welcome_back": "Welcome back!",
      "auth_placeholder_email": "E-Mail",
      "auth_placeholder_password": "Password",
      "auth_placeholder_username": "Username",
      "auth_placeholder_password_min": "Password (min. 6 characters)",
      "auth_or": "OR",
      "auth_continue_with_google": "Continue with Google",
      "auth_no_account_yet": "No account yet?",
      "auth_register_title": "Join the Community",
      "auth_create_account": "Create Account",
      "auth_register_with_google": "Register with Google",
      "auth_already_have_account": "Already have an account?",
      "modal_loading_game": "Loading game...",
      "modal_loading_description": "Loading description...",
      "modal_community_ratings": "Community Ratings",
      "modal_comments": "Comments",
      "alert_register_success": "Registration successful! You are now logged in.",
      "alert_login_success": "Login successful!",
      "alert_account_banned": "Your account has been suspended. Please contact support.",
      "alert_google_register_success": "Account successfully created with Google!",
      "alert_google_welcome_back": "Welcome back, {{name}}!",
      "alert_google_signin_error": "Google Sign-In Error ({{errorCode}}): {{errorMessage}}",
      "alert_logout_success": "You have been successfully logged out.",
      "alert_logout_error": "Error during logout: {{message}}",
      "alert_comment_failed": "Error saving your comment.",
      "alert_login_for_rating": "Please log in to submit a rating.",
      "alert_rating_success": "Thank you for your rating!",
      "alert_rating_failed": "Your rating could not be saved.",
      "footer_imprint": "Imprint",
      "footer_privacy": "Privacy Policy",
      "footer_cookies": "Cookie Settings",
      "footer_visitors": "Visitors:",
      "footer_copyright": "&copy; 2025 GameMatch. All rights reserved. Made with ❤️ in Austria",
      "cookie_banner_text": "We use cookies to ensure website functionality and improve your experience.",
      "cookie_learn_more": "Learn more",
      "cookie_accept_necessary": "Necessary cookies only",
      "cookie_accept_all": "Accept all cookies",
      "cookie_settings_title": "Cookie Settings",
      "cookie_necessary_title": "Necessary Cookies",
      "cookie_necessary_active": "Always active",
      "cookie_necessary_desc": "These cookies are essential for the website's operation and cannot be disabled.",
      "cookie_functional_title": "Functional Cookies",
      "cookie_functional_desc": "Enable enhanced functionality like saved login credentials and settings.",
      "cookie_analytics_title": "Analytics Cookies",
      "cookie_analytics_desc": "Help us understand how visitors use our website.",
      "cookie_save_settings": "Save settings",
      "cookie_cancel": "Cancel",
      "admin_dashboard_title": "Admin Dashboard",
      "admin_tab_users": "User Management",
      "admin_tab_blog": "Blog Management",
      "admin_users_filter_placeholder": "Filter by username or email...",
      "admin_users_th_user": "Username",
      "admin_users_th_email": "E-Mail",
      "admin_users_th_level": "Level / XP",
      "admin_users_th_registered": "Registered on",
      "admin_users_th_actions": "Actions",
      "admin_users_no_users": "No users found.",
      "admin_blog_create_title": "Create New Post",
      "admin_blog_form_title": "Title",
      "admin_blog_form_content": "Content",
      "admin_blog_form_save": "Save Post",
      "admin_blog_form_clear": "Clear",
      "admin_blog_existing_title": "Existing Posts",
      "admin_blog_edit": "Edit",
      "admin_blog_delete": "Delete",
      "chat_back": "&larr; Back",
      "chat_loading": "Loading...",
      "chat_placeholder": "Write a message...",
      "chat_send": "Send",
      "profile_request_received": "sent you a friend request.",
      "profile_request_accept": "Accept",
      "profile_request_decline": "Decline",
      "giveaway_banner_title": "Summer Giveaway!",
    "giveaway_banner_text": "Win a 50€ Steam Gift Card! The user with the most XP on August 31st wins. Good luck!",
    "feature_section_title": "Your Personal Gaming Universe",
    "feature_section_subtitle": "More Than Just Recommendations",
    "feature_section_desc": "A GameMatch account is your central hub for everything related to your games. Collect, share, and track your progress.",
    "feature_new_library_title": "Your Library",
    "feature_new_library_desc": "Every game you like is saved here. Create your ultimate collection, rate it, and show it to your friends.",
    "feature_new_crew_title": "Your Crew",
    "feature_new_crew_desc": "Find players who share your taste. Compare your libraries and discover which games you can play together.",
    "feature_new_progress_title": "Your Progress",
    "feature_new_progress_desc": "Earn experience points (XP) for your activities on the site, level up, and unlock new ranks.",
    }
  }
};
// DIREKT NACH DEM `translations`-OBJEKT EINFÜGEN

// Diese Funktion aktualisiert alle Texte auf der Seite
// ERSETZE DEINE BISHERIGE updateContent FUNKTION HIERMIT

function updateContent() {
  document.querySelectorAll('[data-i18n]').forEach(element => {
    let key = element.getAttribute('data-i18n');
    let attribute = 'innerHTML'; // Standard ist, den Text im Element zu ändern

    // Prüfen, ob eine Attribut-Übersetzung wie [placeholder]key gemeint ist
    if (key.startsWith('[')) {
      const match = key.match(/\[(.*?)\](.*)/);
      if (match) {
        attribute = match[1]; // z.B. "placeholder"
        key = match[2];       // z.B. "auth_placeholder_email"
      }
    }

    const translation = i18next.t(key);

    // Je nachdem, ob es ein Attribut oder der Inhalt ist, wird die passende Methode verwendet
    if (attribute === 'innerHTML') {
      element.innerHTML = translation;
    } else {
      element.setAttribute(attribute, translation);
    }
  });
}

// Initialisiert i18next und führt die erste Übersetzung aus
i18next.init({
  lng: 'de', // Startsprache
  fallbackLng: 'de', // Falls eine Sprache nicht gefunden wird
  debug: false, // Auf false setzen, wenn alles funktioniert
  resources: translations
}).then(function(t) {
  // Sobald i18next bereit ist, die Inhalte aktualisieren
  updateContent();
});

// Wenn die Sprache geändert wird, rufe die Aktualisierungsfunktion auf
i18next.on('languageChanged', () => {
  updateContent();
});

        let chatHistory = [];
        let lastUserInput = '';
        let availableTags = [];
        let availableGenres = [];
        let currentGameCandidates = []

        let currentOpenChatId = null; 
        let unsubscribeFromMessages = null;
        let lastVisibleGameDoc = null; 
        const GAMES_PER_PAGE = 9;

        // UI ELEMENTE SAMMLUNG
        const ui = {
            navTriggers: document.querySelectorAll('.nav-trigger'),
            pageSections: document.querySelectorAll('.page-section'),
            chatLog: document.getElementById('chat-log'),
            userInputArea: document.getElementById('user-input-area'),
            resultContainer: document.getElementById('matchmaker-result'),
            chatWindow: document.getElementById('ai-chat-window'),
            resetQuizButton: document.getElementById('reset-quiz'),
            authModal: document.getElementById('auth-modal'),
            authModalContent: document.getElementById('auth-modal-content'),
            loginView: document.getElementById('login-view'),
            registerView: document.getElementById('register-view'),
        };
        
    
const systemPromptConversation = `DU BIST EIN GAME-SCOUT. Dein Ziel ist es, in einem lockeren Gespräch die Wünsche des Nutzers für ein PC-Spiel zu verstehen. STELLE IMMER NUR EINE EINZIGE FRAGE PRO ANTWORT. Frage nach Genre, Stimmung, Spielstil (realistisch, Fantasy etc.) und ob der Nutzer AAA-Titel oder Indie-Spiele bevorzugt. STELLE FRAGEN, BIS DU DIR SICHER BIST, GENUG INFOS ZU HABEN (NORMALERWEISE NACH 2-3 ANTWORTEN DES NUTZERS). DEINE ALLERLETZTE ANTWORT MUSS EINE ABSCHLIESSENDE BEMERKUNG SEIN UND DARF KEINE FRAGE MEHR ENTHALTEN. ZUM BEISPIEL: "Perfekt, das reicht mir schon. Ich suche jetzt das passende Spiel für dich!". Setze NUR in diesem finalen Fall 'conversation_complete' auf true. ANTWORTE IMMER IM FOLGENDEN JSON-FORMAT: { "type": "response", "next_question": "Deine nächste Frage ODER die abschließende Bemerkung.", "conversation_complete": false }`;

const systemPromptExtractor = `
    You are a data extraction engine for the IGDB API.
    **RULES:**
    1.  From the user's request, identify the **ONE SINGLE MOST IMPORTANT genre** that describes the core gameplay (e.g., 'rpg', 'shooter', 'adventure').
    2.  Identify a **category**: 'indie' or 'aaa'. If not mentioned, this must be null.
    3.  Identify a **maximum of 2-3 essential themes** that are explicitly mentioned or strongly implied (e.g., 'fantasy', 'horror', 'open-world'). Do NOT add generic themes like 'singleplayer' or 'atmospheric' unless they are the primary request. Be conservative.
    4.  Output ONLY a valid JSON object in the format: { "genre": "THE_SINGLE_GENRE_SLUG", "themes": ["theme1"], "category": "indie" }
`;
const systemPromptFinal = `
    You are a highly precise recommendation engine. Your ONLY task is to select one single game from the JSON list of candidates provided in the user's prompt. You MUST follow these rules exactly:

    **CRITICAL RULES:**

    1.  **MANDATORY SELECTION FROM LIST:** You are absolutely forbidden to suggest any game that is NOT in the provided candidate list. You MUST choose one from the list.

    2.  **STRICT TAG ANALYSIS:** Review the user's original request (provided in the prompt). Then, for each game in the candidate list, examine its "tags" array. Select the game whose tags provide the **best and most accurate match** to the user's request.

    3.  **VERIFY THE CORE GENRE:** If the user asked for a "Shooter", you MUST verify that the selected game's tags include "shooter". If the user asked for an "RPG", verify that the tags include "rpg". Do not misclassify genres. For example, "God of War" is NOT a "Shooter".

    4.  **GERMAN JUSTIFICATION:** Your "description" in the JSON output must be in GERMAN and directly address the user ('Du'/'dir').

    5.  **JSON ONLY:** Your entire response must be a single, valid JSON object and nothing more.

    Here is the required JSON structure: { "game": { "id": THE_UNIQUE_ID_FROM_THE_LIST, "description": "YOUR_PERSONAL_REASONING_IN_GERMAN." } }
`;
const systemPromptDescription = `
    You are a creative game journalist. Your task is to write a short, enthusiastic, 2-3 sentence recommendation for a given game, based on provided facts.
    
    **RULES:**
    1.  Address the user directly in German ('Du'/'dir').
    2.  Your tone should be convincing and exciting.
    3.  **Your entire response MUST be ONLY the text of the recommendation. Do NOT output JSON, markdown, or any other formatting. Just the plain text.**
`;


        // FIREBASE INITIALISIERUNG
        const firebaseConfig = {
            apiKey: "AIzaSyDdIe7bx3ub3Sna3p9UYvvwrCaBcPOeMHM",
            authDomain: "gamematch-f462c.firebaseapp.com",
            projectId: "gamematch-f462c",
            storageBucket: "gamematch-f462c.appspot.com",
            messagingSenderId: "598499532222",
            appId: "1:598499532222:web:0027a5cd04a0652ed36def",
            measurementId: "G-NQYQ6V1RLW"
        };
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();
        const storage = firebase.storage();
        

// +++ NEUE AUTH MODAL FUNKTIONEN +++
function openAuthModal(view = 'login') {
    const loginError = document.getElementById('login-error');
    const registerError = document.getElementById('register-error');
    loginError.classList.add('hidden');
    loginError.textContent = '';
    registerError.classList.add('hidden');
    registerError.textContent = '';

    if (view === 'login') {
        ui.loginView.classList.remove('hidden');
        ui.registerView.classList.add('hidden');
    } else {
        ui.loginView.classList.add('hidden');
        ui.registerView.classList.remove('hidden');
    }
    ui.authModal.classList.remove('invisible', 'opacity-0');
    ui.authModalContent.classList.remove('scale-95');
}
async function incrementVisitCounter() {
  const dbRef = firebase.firestore().collection('siteStats').doc('visitCounter');
  const counterEl = document.getElementById('visit-counter');

  try {
    const doc = await dbRef.get();
    if (!doc.exists) {
      // Erstes Anlegen mit Startwert 1
      await dbRef.set({ count: 350 });
      counterEl.textContent = '1';
    } else {
      // Zähler erhöhen
      await dbRef.update({
        count: firebase.firestore.FieldValue.increment(1)
      });
      const updatedSnap = await dbRef.get();
      const newCount = updatedSnap.data().count || 0;
      counterEl.textContent = newCount.toLocaleString('de-DE');
    }
  } catch (err) {
    console.error("Fehler beim Zähler:", err);
    counterEl.textContent = 'Fehler';
  }
}
function closeAuthModal() {
    ui.authModal.classList.add('opacity-0');
    ui.authModalContent.classList.add('scale-95');
    setTimeout(() => {
        ui.authModal.classList.add('invisible');
    }, 300); // Wait for transition to finish
}
let unsubscribeFromUserDoc = null; 
// +++ NEUE, VERBESSERTE AUTH-FUNKTIONEN +++
async function handleEmailRegister(event) {
    event.preventDefault();
    const email = document.getElementById('register-email').value;
    const password = document.getElementById('register-password').value;
    const username = document.getElementById('register-username').value;
    const referralCodeInput = document.getElementById('register-referral-code').value.trim().toUpperCase(); // NEU
    const errorP = document.getElementById('register-error');

    if (!email || !password || !username) {
        errorP.textContent = "Bitte fülle alle Felder aus.";
        errorP.classList.remove('hidden');
        return;
    }

    try {
        const userCredential = await auth.createUserWithEmailAndPassword(email, password);
        const user = userCredential.user;
        
        // NEU: Logik zur Verarbeitung des Empfehlungscodes
        let referredBy = null;
        if (referralCodeInput) {
            const querySnapshot = await db.collection("users").where("referralCode", "==", referralCodeInput).limit(1).get();
            if (!querySnapshot.empty) {
                const referrerDoc = querySnapshot.docs[0];
                referredBy = referrerDoc.id;
                // Erhöhe den Zähler des Werbenden
                await db.collection("users").doc(referredBy).update({
                    referralCount: firebase.firestore.FieldValue.increment(1)
                });
            } else {
                console.warn("Eingegebener Empfehlungscode existiert nicht:", referralCodeInput);
            }
        }

        await db.collection("users").doc(user.uid).set({
            email: user.email,
            username: username, 
            avatarUrl: null, 
            createdAt: firebase.firestore.FieldValue.serverTimestamp(),
            xp: 0,
            level: 1,
            referralCode: generateReferralCode(), // NEU: Code bei Erstellung zuweisen
            referralCount: 0, // NEU: Initialen Zähler setzen
            referredBy: referredBy // NEU: Speichern, wer geworben hat
        });

        alert(i18next.t('alert_register_success'));
        closeAuthModal();
    } catch (error) {
        errorP.textContent = "Error: " + error.message;
        errorP.classList.remove('hidden');
    }
}

async function sendMessage(friendId, messageText) {
    const currentUser = auth.currentUser;
    if (!currentUser || !messageText.trim()) return;

    const chatId = [currentUser.uid, friendId].sort().join('_');
    const conversationRef = db.collection('conversations').doc(chatId);
    const messagesRef = conversationRef.collection('messages');
    
    // NEU: Referenz auf das Nutzerdokument des Empfängers
    const recipientUserRef = db.collection('users').doc(friendId);

    try {
        // Füge die Nachricht hinzu
        await messagesRef.add({
            senderId: currentUser.uid,
            text: messageText,
            timestamp: firebase.firestore.FieldValue.serverTimestamp()
        });

        
        await conversationRef.set({
    users: [currentUser.uid, friendId],

    ['unread_' + friendId]: firebase.firestore.FieldValue.increment(1)
}, { merge: true });

        
        await recipientUserRef.update({
            totalUnreadMessages: firebase.firestore.FieldValue.increment(1)
        });
        
    } catch (error) {
        console.error("Fehler beim Senden der Nachricht oder Aktualisieren der Zähler:", error);
    }
}
function changeLang(lang) {
  i18next.changeLanguage(lang);
}

function listenForMessages(friendId, callback) {
    const currentUser = auth.currentUser;
    if (!currentUser) return;

    const chatId = [currentUser.uid, friendId].sort().join('_');

    const query = db.collection('conversations').doc(chatId)
      .collection('messages')
      .orderBy('timestamp', 'asc');
      
    // Gib die von onSnapshot zurückgegebene Funktion direkt zurück
    return query.onSnapshot(querySnapshot => {
        const messages = [];
        querySnapshot.forEach(doc => {
            messages.push({ id: doc.id, ...doc.data() });
        });
        callback(messages);
    });
}
// ERSETZE DEINE BISHERIGE openChat FUNKTION

async function openChat(friendId, friendUsername, friendAvatar) {
    const currentUser = auth.currentUser;
    if (!currentUser) return;

    if (unsubscribeFromMessages) {
        unsubscribeFromMessages();
    }

    currentOpenChatId = friendId;
    document.getElementById('chat-friend-name').textContent = friendUsername;
    // KORREKTUR: Fügt ein Standard-Avatarbild hinzu, falls keines vorhanden ist
    document.getElementById('chat-friend-avatar').src = friendAvatar || `https://i.pravatar.cc/40?u=${friendId}`;
    document.getElementById('chat-log-messages').innerHTML = `<p class="text-center text-gray-400">${i18next.t('chat_loading')}</p>`;

    // --- Logik zum Zurücksetzen der Zähler bleibt gleich ---
    const chatId = [currentUser.uid, friendId].sort().join('_');
    const conversationRef = db.collection('conversations').doc(chatId);
    const currentUserRef = db.collection('users').doc(currentUser.uid);

    try {
        const conversationDoc = await conversationRef.get();
        if (conversationDoc.exists) {
            const unreadCount = conversationDoc.data()['unread_' + currentUser.uid] || 0;
            if (unreadCount > 0) {
                await db.runTransaction(async (transaction) => {
                    transaction.update(currentUserRef, {
                        totalUnreadMessages: firebase.firestore.FieldValue.increment(-unreadCount)
                    });
                    transaction.update(conversationRef, {
                        ['unread_' + currentUser.uid]: 0
                    });
                });
            }
        }
    } catch (error) {
        console.error("Fehler beim Zurücksetzen der Zähler:", error);
    }
    
    showPage('#chat-view');
    unsubscribeFromMessages = listenForMessages(friendId, renderMessages);
}
// NEUE FUNKTION, UM DIE NACHRICHTEN IM UI DARZUSTELLEN
function renderMessages(messages) {
    const chatLog = document.getElementById('chat-log-messages');
    const currentUser = auth.currentUser;
    
    if (!currentUser) return;
    
    chatLog.innerHTML = ''; // Leere alte Nachrichten

    if (messages.length === 0) {
        chatLog.innerHTML = '<p class="text-center text-gray-500 text-sm">Noch keine Nachrichten. Sag Hallo!</p>';
        return;
    }

    messages.forEach(message => {
        const isMe = message.senderId === currentUser.uid;
        
        const bubble = document.createElement('div');
        bubble.className = `flex items-end gap-2 max-w-[80%] ${isMe ? 'self-end flex-row-reverse' : 'self-start'}`;
        
        // Die eigentliche Nachrichtenblase
        const textBubble = document.createElement('div');
        textBubble.textContent = message.text;
        textBubble.className = `px-4 py-2 rounded-xl ${isMe ? 'bg-blue-600 rounded-br-none' : 'bg-gray-700 rounded-bl-none'}`;
        
        bubble.appendChild(textBubble);
        chatLog.appendChild(bubble);
    });

    // Scrolle immer zur neuesten Nachricht
    chatLog.scrollTop = chatLog.scrollHeight;
}
async function displayGamePoolList(userId) {
    const listContainer = document.getElementById('mitspieler-gamelist');
    if (!listContainer) return;
    listContainer.innerHTML = `<p class="text-gray-400">${i18next.t('profile_lfg_loading_games')}</p>`;

    try {
        const querySnapshot = await db.collection("users").doc(userId).collection("suggestedGames")
                                    .where('status', '==', 'liked')
                                    .orderBy('suggestedAt', 'desc')
                                    .get();

        if (querySnapshot.empty) {
            listContainer.innerHTML = `<p class="text-gray-500">${i18next.t('profile_lfg_no_liked_games')}</p>`;
            return;
        }

        let gamesHtml = '';
        querySnapshot.forEach(doc => {
            const game = doc.data();
            // KORREKTUR: Titel wird desinfiziert
            const safeTitle = sanitizeHTML(game.title);
            gamesHtml += `
                <div onclick="showPlayersForGame('${game.rawgId}', '${game.title.replace(/'/g, "\\'")}')" 
                     class="bg-gray-900 p-3 rounded-lg flex items-center gap-4 cursor-pointer hover:bg-gray-800 transition-colors">
                    <img src="${game.imageUrl}" class="w-16 h-10 object-cover rounded">
                    <span class="font-semibold text-white">${safeTitle}</span>
                </div>
            `;
        });
        listContainer.innerHTML = gamesHtml;
    } catch (error) {
        console.error("Fehler beim Laden der Game-Pool-Liste:", error);
        listContainer.innerHTML = `<p class="text-red-400">${i18next.t('profile_lfg_error_loading')}</p>`;
    }
}
async function showPlayersForGame(gameId, gameTitle) {
    document.getElementById('mitspieler-gamelist-view').classList.add('hidden');
    const resultsView = document.getElementById('mitspieler-results-view');
    const resultsList = document.getElementById('mitspieler-results-list');

    document.getElementById('mitspieler-results-title').textContent = i18next.t('profile_lfg_results_title', { gameTitle: gameTitle });
    resultsList.innerHTML = `<p class="text-gray-400">${i18next.t('profile_lfg_searching')}</p>`;
    resultsView.classList.remove('hidden');

    try {
        const gameLikesDoc = await db.collection("gameLikes").doc(String(gameId)).get();
        if (!gameLikesDoc.exists || !gameLikesDoc.data().users) {
            resultsList.innerHTML = `<p class="text-gray-500">${i18next.t('profile_lfg_no_one_else')}</p>`;
            return;
        }

        const usersMap = gameLikesDoc.data().users;
        const currentUser = auth.currentUser;
        let playersHtml = '';
        let playerCount = 0;

        for (const userId in usersMap) {
            if (currentUser && currentUser.uid === userId) continue;
            const userData = usersMap[userId];
            playerCount++;
            // KORREKTUR: Nutzername wird desinfiziert
            const safeUsername = sanitizeHTML(userData.username);
            playersHtml += `
                <a href="#profile?user=${userId}" class="nav-trigger bg-gray-900 p-3 rounded-lg flex items-center gap-4 hover:bg-gray-800 transition-colors">
                    <img src="${userData.avatarUrl || `https://i.pravatar.cc/150?u=${userId}`}" class="w-12 h-12 object-cover rounded-full">
                    <span class="font-semibold text-white">${safeUsername}</span>
                </a>
            `;
        }

        if (playerCount === 0) {
             resultsList.innerHTML = `<p class="text-gray-500">${i18next.t('profile_lfg_trendsetter')}</p>`;
        } else {
            resultsList.innerHTML = playersHtml;
        }

    } catch (error) {
        console.error(`Fehler beim Abrufen der Spieler für Spiel ${gameId}:`, error);
        resultsList.innerHTML = `<p class="text-red-400">${i18next.t('profile_lfg_error_player_list')}</p>`;
    }
}
function displayPartners() {
    const container = document.getElementById('partner-list');
    if (!container) return;

    let html = '';
    partners.forEach(partner => {
        html += `
            <a href="${partner.websiteUrl}" target="_blank" rel="noopener noreferrer" 
               class="block bg-gray-800 border border-gray-700 rounded-xl p-6 text-center transition-all duration-300 hover:border-cyan-500 hover:-translate-y-1">
                <img src="${partner.logoUrl}" alt="Logo von ${sanitizeHTML(partner.name)}" 
                     class="h-20 mx-auto mb-4 object-contain filter grayscale hover:grayscale-0 transition-all">
                <h3 class="text-xl font-bold text-white mb-2">${sanitizeHTML(partner.name)}</h3>
                <p class="text-gray-400 text-sm">${sanitizeHTML(partner.description)}</p>
            </a>
        `;
    });
    container.innerHTML = html;
}
async function displayUserManagement() {
    const userListBody = document.getElementById('admin-user-list-body');
    const emptyMessage = document.getElementById('admin-user-list-empty');
    if (!userListBody) return;

    userListBody.innerHTML = '<tr><td colspan="5" class="text-center p-6 text-gray-400">Lade Nutzerdaten...</td></tr>';
    emptyMessage.classList.add('hidden');

    try {
        const querySnapshot = await db.collection("users").orderBy("createdAt", "desc").get();

        if (querySnapshot.empty) {
            userListBody.innerHTML = '';
            emptyMessage.classList.remove('hidden');
            return;
        }

        let usersHtml = '';
        querySnapshot.forEach(doc => {
            const userData = doc.data();
            const userId = doc.id;
            const currentUser = auth.currentUser;
            const registeredAt = userData.createdAt?.toDate().toLocaleDateString('de-DE') || 'Unbekannt';
            let actionButtons = `<a href="#profile?user=${userId}" class="nav-trigger font-medium text-cyan-400 hover:underline">Profil</a>`;
            if (currentUser && currentUser.uid !== userId) {
                actionButtons += userData.isBanned ? `<button onclick="toggleUserBan('${userId}', true)" class="ml-4 font-medium text-green-400 hover:underline">Entsperren</button>` : `<button onclick="toggleUserBan('${userId}', false)" class="ml-4 font-medium text-red-500 hover:underline">Sperren</button>`;
                actionButtons += userData.isAdmin ? `<button onclick="toggleAdminStatus('${userId}', true)" class="ml-4 font-medium text-red-500 hover:underline">Admin entfernen</button>` : `<button onclick="toggleAdminStatus('${userId}', false)" class="ml-4 font-medium text-yellow-400 hover:underline">Zum Admin machen</button>`;
            }

            // KORREKTUR: Nutzername und E-Mail werden desinfiziert
            const safeUsername = sanitizeHTML(userData.username || '');
            const safeEmail = sanitizeHTML(userData.email);
            
            usersHtml += `
                <tr class="bg-gray-800 border-b border-gray-700 hover:bg-gray-700/50 ${userData.isBanned ? 'opacity-50' : ''}">
                    <td class="px-6 py-4 font-medium text-white">${safeUsername} ${userData.isAdmin ? '<span class="text-xs text-yellow-400 ml-1">(Admin)</span>' : ''}</td>
                    <td class="px-6 py-4">${safeEmail}</td>
                    <td class="px-6 py-4">Lvl ${userData.level || 1} / ${userData.xp || 0} XP</td>
                    <td class="px-6 py-4">${registeredAt}</td>
                    <td class="px-6 py-4">${actionButtons}</td>
                </tr>
            `;
        });
        userListBody.innerHTML = usersHtml;
    } catch (error) {
        console.error("Fehler beim Laden der Nutzer für das Admin-Panel:", error);
        userListBody.innerHTML = '<tr><td colspan="5" class="text-center p-6 text-red-400">Fehler beim Laden der Nutzer.</td></tr>';
    }
}
async function handleEmailLogin(event) {
    event.preventDefault();
    const email = document.getElementById('login-email').value;
    const password = document.getElementById('login-password').value;
    const errorP = document.getElementById('login-error');

    try {
        const userCredential = await auth.signInWithEmailAndPassword(email, password);
        const user = userCredential.user;

        const userDoc = await db.collection('users').doc(user.uid).get();
        if (userDoc.exists && userDoc.data().isBanned === true) {
            await auth.signOut();
            alert(i18next.t('alert_account_banned'));
            closeAuthModal();
            return;
        }

        alert(i18next.t('alert_login_success'));
        closeAuthModal();
    
    } catch (error) {
        errorP.textContent = "Error: " + error.message;
        errorP.classList.remove('hidden');
    }
}

async function signInWithGoogle() {
    const provider = new firebase.auth.GoogleAuthProvider();
    try {
        const result = await auth.signInWithPopup(provider);
        const user = result.user;
        const isNewUser = result.additionalUserInfo.isNewUser;

        if (isNewUser) {
            await db.collection("users").doc(user.uid).set({
                email: user.email,
                username: user.displayName || 'Google User',
                avatarUrl: user.photoURL,
                createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                xp: 0,
                level: 1,
                isBanned: false,
                referralCode: generateReferralCode(), // 
                referralCount: 0, // 
                referredBy: null // 
            });
            
            alert(i18next.t('alert_google_register_success'));

        } else {
            const userDoc = await db.collection('users').doc(user.uid).get();
            // Wenn der Nutzer wiederkehrt, aber aus irgendeinem Grund kein DB-Eintrag existiert, erstelle ihn.
            if (!userDoc.exists) {
                await db.collection("users").doc(user.uid).set({
                    email: user.email,
                    username: user.displayName || 'Google User',
                    avatarUrl: user.photoURL,
                    createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                    xp: 0,
                    level: 1,
                    isBanned: false
                });
            } else if (userDoc.data().isBanned === true) {
                // Wenn der Nutzer existiert und gesperrt ist, logge ihn aus.
                await auth.signOut();
                alert(i18next.t('alert_account_banned'));
                closeAuthModal();
                return;
            }
            
            alert(i18next.t('alert_google_welcome_back', { name: user.displayName }));
        }
        
        closeAuthModal();

    } catch (error) {
        alert(i18next.t('alert_google_signin_error', { errorCode: error.code, errorMessage: error.message }));
    }
}
 async function handleLogout() {
    try {
        await auth.signOut();
        // Ein Alert ist hier nicht nötig, da die Seite sofort neu lädt,
        // was für den Nutzer Bestätigung genug ist.
        window.location.hash = '#home';
        location.reload(); 
    } catch (error) {
        console.error("Fehler beim Logout:", error);
        alert(i18next.t('alert_logout_error', { message: error.message }));
    }
}       
    
async function postGameComment(event, gameId) {
  event.preventDefault();
  const input = document.getElementById(`comment-input-${gameId}`);
  const commentText = input.value.trim();
  const user = auth.currentUser;

  if (!commentText || !user) return;

  try {
    const userDoc = await db.collection("users").doc(user.uid).get();
    const username = userDoc.exists ? (userDoc.data().username || user.email) : "Unbekannt";

    await db.collection("comments").doc(gameId.toString()).collection("entries").add({
      username,
      comment: commentText,
      timestamp: firebase.firestore.FieldValue.serverTimestamp()
    });
const gameDoc = await db.collection("game_ratings").doc(String(gameId)).get();
        db.collection('activity_feed').add({
            type: 'COMMENT',
            userId: user.uid,
            username: username,
            details: {
                gameId: gameId,
                gameTitle: gameDoc.data()?.gameTitle || 'einem Spiel',
                commentText: commentText
            },
            timestamp: firebase.firestore.FieldValue.serverTimestamp()
        });
    
input.value = '';
await grantXpAndCheckLevelUp(user.uid, 10);
loadCommentsForGame(gameId, 'modal-comment-list');


  } catch (error) {
    console.error("Kommentar konnte nicht gespeichert werden:", error);
    alert("Fehler beim Speichern deines Kommentars.");
  }
}
// ERSETZE DEINE KOMPLETTE loadSavedGames FUNKTION HIERMIT

async function loadSavedGames(userId, filter, isInitialLoad = false) {
    const savedGamesList = document.getElementById('saved-games-list');
    const noGamesMessage = document.getElementById('no-saved-games');
    const loadMoreContainer = document.getElementById('load-more-container');
    const isOwnProfile = auth.currentUser && auth.currentUser.uid === userId;

    if (isInitialLoad) {
        savedGamesList.innerHTML = '';
        noGamesMessage.classList.add('hidden');
        lastVisibleGameDoc = null;
    }

    loadMoreContainer.innerHTML = `<p class="text-gray-400">${i18next.t('profile_loading')}</p>`;

    try {
        let gamesQuery = db.collection("users").doc(userId).collection("suggestedGames");

        if (filter === 'liked') {
            gamesQuery = gamesQuery.where('status', '==', 'liked');
        } else if (filter === 'disliked') {
            gamesQuery = gamesQuery.where('status', '==', 'disliked');
        }
        
        gamesQuery = gamesQuery.orderBy("suggestedAt", "desc");

        if (lastVisibleGameDoc) {
            gamesQuery = gamesQuery.startAfter(lastVisibleGameDoc);
        }
        gamesQuery = gamesQuery.limit(GAMES_PER_PAGE);

        const gamesSnapshot = await gamesQuery.get();

        if (gamesSnapshot.empty && isInitialLoad) {
            noGamesMessage.textContent = i18next.t('profile_no_games_for_filter', { filter: filter });
            noGamesMessage.classList.remove('hidden');
            loadMoreContainer.innerHTML = '';
            return;
        }

        if (gamesSnapshot.docs.length > 0) {
            lastVisibleGameDoc = gamesSnapshot.docs[gamesSnapshot.docs.length - 1];
        }

        let gamesHtml = '';
        gamesSnapshot.forEach(doc => {
            const game = doc.data();
            gamesHtml += `
                <div class="game-card-trigger bg-gray-900 rounded-lg overflow-hidden border border-gray-700 flex flex-col cursor-pointer hover:border-cyan-500 transition-all duration-300 hover:-translate-y-1"
                     data-game-id="${game.rawgId}"
                     data-game-title="${escapeJS(game.title)}"
                     data-game-image-url="${game.imageUrl}"
                     data-game-description="${escapeJS(game.description)}"
                     data-is-own-profile="${isOwnProfile}">
                    <img src="${game.imageUrl}" alt="Cover für ${game.title}" class="w-full h-40 object-cover pointer-events-none">
                    <div class="p-4 flex flex-col flex-grow pointer-events-none">
                        <h4 class="font-bold text-xl text-white">${game.title}</h4>
                        <p class="text-gray-300 text-sm mt-2 line-clamp-3">${game.description}</p>
                        <div class="mt-auto pt-4">
                            <div id="avg-rating-${game.rawgId}" class="flex items-center text-sm text-gray-400"></div>
                        </div>
                    </div>
                </div>
            `;
        });
        
        savedGamesList.insertAdjacentHTML('beforeend', gamesHtml);

        const uiPromises = gamesSnapshot.docs.map(doc => {
            const avgRatingContainer = document.getElementById(`avg-rating-${doc.data().rawgId}`);
            if (avgRatingContainer) {
                return db.collection("game_ratings").doc(String(doc.data().rawgId)).get().then(gameRatingDoc => {
                    if (gameRatingDoc.exists) {
                        displayStars(avgRatingContainer, gameRatingDoc.data().averageRating, gameRatingDoc.data().ratingCount);
                    } else {
                         avgRatingContainer.innerHTML = `<span class="text-xs text-gray-500">Noch keine Bewertungen</span>`;
                    }
                });
            }
        });
        await Promise.all(uiPromises);

        if (gamesSnapshot.docs.length < GAMES_PER_PAGE) {
            loadMoreContainer.innerHTML = '';
        } else {
            loadMoreContainer.innerHTML = `<button id="load-more-btn" class="bg-gray-700 hover:bg-gray-600 text-white font-semibold px-6 py-2 rounded-lg">${i18next.t('profile_load_more')}</button>`;
            document.getElementById('load-more-btn').onclick = () => loadSavedGames(userId, filter, false);
        }

    } catch (error) {
        console.error("Fehler beim Laden der Spiele:", error);
        loadMoreContainer.innerHTML = `<p class="text-red-400">${i18next.t('profile_error_loading')} (${error.message})</p>`;
    }
}
async function loadCommentsForGame(gameId, containerId) {
    const container = document.getElementById(containerId);
    if (!container) return;

    try {
        const querySnapshot = await db.collection("comments").doc(gameId.toString()).collection("entries").orderBy("timestamp", "desc").limit(5).get();
        if (querySnapshot.empty) {
            container.innerHTML = `<p class="text-xs text-gray-500 italic px-2">Noch keine Kommentare.</p>`;
            return;
        }

        let html = '';
        querySnapshot.forEach(doc => {
            const entry = doc.data();
            const avatarUrl = `https://i.pravatar.cc/40?u=${encodeURIComponent(entry.username)}`;
            // KORREKTUR: Name und Kommentar werden desinfiziert
            const safeUsername = sanitizeHTML(entry.username);
            const safeComment = sanitizeHTML(entry.comment);
            html += `
                <div class="flex items-start gap-2.5 p-2 rounded-lg hover:bg-gray-800/50">
                    <img class="w-8 h-8 rounded-full" src="${avatarUrl}" alt="${safeUsername} avatar">
                    <div class="flex flex-col w-full">
                        <p class="text-sm font-semibold text-white">${safeUsername}</p>
                        <p class="text-sm text-gray-300 break-words">${safeComment}</p>
                    </div>
                </div>
            `;
        });
        container.innerHTML = html;
    } catch (error) {
        console.error("Fehler beim Laden der Kommentare:", error);
        container.innerHTML = `<p class="text-red-400">Fehler beim Laden der Kommentare.</p>`;
    }
}
async function loadUserList() {
    const container = document.getElementById('user-list');
    const emptyMsg = document.getElementById('user-list-empty');
    if (!container || !emptyMsg) return;

    container.innerHTML = '<p class="text-gray-400 text-center">Lade Community...</p>';
    const currentUser = auth.currentUser;

    try {
        // --- SCHRITT 1: Hole ALLE Nutzer in einer Anfrage ---
        const usersSnapshot = await db.collection("users").get();
        
        let friendships = new Map(); // Hier speichern wir die Freundschafts-Stati

        // --- SCHRITT 2: WENN eingeloggt, hole ALLE Freundschaften in einer zweiten Anfrage ---
        if (currentUser) {
            const friendshipsSnapshot = await db.collection("friendships")
                                              .where("users", "array-contains", currentUser.uid)
                                              .get();
            
            friendshipsSnapshot.forEach(doc => {
                const data = doc.data();
                const friendId = data.users.find(id => id !== currentUser.uid);
                if (friendId) {
                    friendships.set(friendId, data.status); // z.B. { "freundesId": "accepted" }
                }
            });
        }
        
        // --- SCHRITT 3: Baue die Nutzerkarten, ohne weitere DB-Anfragen im Loop ---
        const userDocs = currentUser
            ? usersSnapshot.docs.filter(doc => doc.id !== currentUser.uid)
            : usersSnapshot.docs;

        if (userDocs.length === 0) {
            emptyMsg.classList.remove('hidden');
            container.innerHTML = '';
            return;
        }

        let cardsHtml = userDocs.map(doc => {
            const user = doc.data();
            let buttonHtml = '';

            if (currentUser) {
                const friendshipStatus = friendships.get(doc.id); // Prüfe die lokale Map
                if (friendshipStatus === 'accepted') {
                    buttonHtml = `<span class="text-green-400 font-semibold text-sm">✅ Bereits Freund</span>`;
                } else if (friendshipStatus === 'pending') {
                    buttonHtml = `<span class="text-yellow-400 font-semibold text-sm">⏳ Angefragt</span>`;
                } else {
                    buttonHtml = `<button onclick="sendFriendRequest('${doc.id}')" class="bg-cyan-600 text-white font-semibold px-4 py-2 rounded-lg hover:bg-cyan-500 transition-colors text-sm">Freund hinzufügen</button>`;
                }
            }

            // KORREKTUR HIER: 'user.username' wird desinfiziert, bevor es im HTML verwendet wird.
            const safeUsername = sanitizeHTML(user.username || 'Nutzer');

            return `
                <a href="#profile?user=${doc.id}" class="nav-trigger block bg-gray-800 border border-gray-700 rounded-xl p-4 shadow-lg flex flex-col items-center text-center transition-transform transform hover:scale-105 hover:border-cyan-500">
                    <img src="${user.avatarUrl || 'https://i.pravatar.cc/150?u=' + doc.id}" class="w-20 h-20 rounded-full mb-4 border-2 border-cyan-400 object-cover" alt="${safeUsername}">
                    <h3 class="text-xl font-bold text-white mb-1">${safeUsername}</h3>
                    <p class="text-yellow-400 text-sm mb-4">Level ${user.level || 1} – ${user.xp || 0} XP</p>
                    <div onclick="event.stopPropagation(); event.preventDefault();" class="h-8">${buttonHtml}</div>
                </a>
            `;
        }).join('');

        container.innerHTML = cardsHtml;
        emptyMsg.classList.add('hidden');

    } catch (error) {
        console.error("Fehler beim Laden der Nutzerliste:", error);
        container.innerHTML = `<p class="text-red-400 text-center">Die Community konnte nicht geladen werden. Fehler: ${error.message}</p>`;
    }
}
async function handleAvatarUpload(event) {
    const user = auth.currentUser;
    if (!user) return;
    const file = event.target.files[0];
    if (!file) return;

    const avatarRef = storage.ref(`avatars/${user.uid}/${file.name}`);
    try {
        alert("Lade Bild hoch...");
        const snapshot = await avatarRef.put(file);
        const downloadURL = await snapshot.ref.getDownloadURL();
        await db.collection("users").doc(user.uid).update({ avatarUrl: downloadURL });
        document.getElementById('profile-avatar').src = downloadURL;
        alert("Profilbild erfolgreich aktualisiert!");
    } catch (error) {
        console.error("Upload-Fehler:", error);
        alert("Upload fehlgeschlagen.");
    }
}
async function handleUsernameChange() {
    const user = auth.currentUser;
    if (!user) return;

    const newUsername = prompt(i18next.t('prompt_enter_new_username'));
    if (!newUsername || newUsername.trim() === "") {
        alert(i18next.t('alert_username_empty'));
        return;
    }

    try {
        await db.collection("users").doc(user.uid).update({ username: newUsername });
        document.getElementById('profile-user-username').textContent = newUsername;
        alert(i18next.t('alert_username_changed'));
    } catch (error) {
        console.error("Fehler beim Ändern des Benutzernamens:", error);
        alert(i18next.t('alert_username_change_failed'));
    }
}
function setupProfileListeners() {
    // Event-Listener für das Hochladen des Avatars
    const avatarUploadInput = document.getElementById('avatar-upload');
    if (avatarUploadInput) {
        avatarUploadInput.addEventListener('change', handleAvatarUpload);
    }
    // Event-Listener für das Ändern des Benutzernamens
    const editUsernameBtn = document.getElementById('edit-username-btn');
    if (editUsernameBtn) {
        editUsernameBtn.addEventListener('click', handleUsernameChange);
    }

    // ======================================================================
    // NEUE LOGIK FÜR DIE FILTER-BUTTONS ("Gemocht", "Abgelehnt", etc.)
    // ======================================================================
    const filterButtons = document.querySelectorAll('#game-filter-buttons .filter-btn');
    filterButtons.forEach(button => {
        button.addEventListener('click', () => {
            // Finde heraus, welches Profil gerade angezeigt wird
            const hash = window.location.hash.substring(1);
            const [pageId, params] = hash.split('?');
            const urlParams = new URLSearchParams(params);
            const userId = urlParams.get('user') || auth.currentUser?.uid;

            if (!userId) {
                console.error("Filter-Klick: Keine UserID gefunden.");
                return;
            }

            // Welcher Filter wurde geklickt? ('all', 'liked', 'disliked')
            const filter = button.dataset.filter;

            // Setze den "active"-Style für den geklickten Button
            filterButtons.forEach(btn => btn.classList.remove('active'));
            button.classList.add('active');

            // Lade die Spieleliste mit dem neuen Filter neu
            // Der 'true'-Parameter sorgt dafür, dass die alte Liste zuerst geleert wird.
            loadSavedGames(userId, filter, true);
        });
    });
    
    // Klick-Logik für die einzelnen Spielkarten
    document.getElementById('saved-games-list').addEventListener('click', (event) => {
        const card = event.target.closest('.game-card-trigger');
        if (card) {
            openCommentModal(
                card.dataset.gameId,
                card.dataset.gameTitle,
                card.dataset.gameImageUrl,
                card.dataset.gameDescription,
                card.dataset.isOwnProfile === 'true'
            );
        }
    });
}
async function displayDailyChallenge() {
    const challengeContainer = document.getElementById('daily-challenge-container');
    const challengeText = document.getElementById('daily-challenge-text');

    try {
        const doc = await db.collection("dailyChallenge").doc("current").get();
        if (doc.exists) {
            const challenge = doc.data();
            challengeText.textContent = challenge.text;
            challengeContainer.classList.remove('hidden');
        } else {
            challengeText.textContent = "Heute gibt es keine Challenge.";
        }
    } catch (error) {
        console.error("Fehler beim Laden der Daily Challenge:", error);
        challengeContainer.classList.add('hidden');
    }
}
async function displayDailyChallengeForHome() {
    const challengeTextEl = document.getElementById('home-daily-challenge-text');
    try {
        const doc = await db.collection("dailyChallenge").doc("current").get();
        if (doc.exists) {
            challengeTextEl.textContent = doc.data().text;
            // Optional: Button-Link anpassen, falls die Challenge zu einer bestimmten Seite führen soll
            document.getElementById('home-daily-challenge-cta').onclick = () => window.location.hash = '#profile';
        } else {
            challengeTextEl.textContent = "Heute gibt es eine kleine Pause. Komm morgen wieder!";
        }
    } catch (error) {
        console.error("Fehler beim Laden der Daily Challenge für die Startseite:", error);
        challengeTextEl.textContent = "Challenge konnte nicht geladen werden.";
    }
}
async function displayLeaderboard() {
    const leaderboardList = document.getElementById('leaderboard-list');
    leaderboardList.innerHTML = `<p class="text-gray-400">${i18next.t('leaderboard_loading')}</p>`;

    try {
        const querySnapshot = await db.collection("users").orderBy("xp", "desc").limit(10).get();
        if (querySnapshot.empty) {
            leaderboardList.innerHTML = `<p class="text-gray-500">${i18next.t('leaderboard_no_players')}</p>`;
            return;
        }

        let leaderboardHtml = '';
        let rank = 1; 

        querySnapshot.forEach((doc) => { 
            const user = doc.data();
            // KORREKTUR: Name oder E-Mail wird desinfiziert
            const displayName = sanitizeHTML(user.username || user.email);
            leaderboardHtml += `
                <div class="flex items-center justify-between bg-gray-900 p-4 rounded-lg border border-gray-700">
                    <div class="flex items-center gap-4">
                        <span class="font-bold text-lg text-yellow-400">${rank}.</span>
                        <span class="font-semibold text-white">${displayName}</span>
                    </div>
                    <span class="font-bold text-lg text-yellow-400">${user.xp} XP</span>
                </div>
            `;
            rank++;
        });
        leaderboardList.innerHTML = leaderboardHtml;
    } catch (error) {
        console.error("Fehler beim Laden der Rangliste:", error);
        leaderboardList.innerHTML = `<p class="text-red-400">${i18next.t('leaderboard_error')}</p>`;
    }
}
async function loadActivityFeed() {
    const feedList = document.getElementById('activity-feed-list');
    feedList.innerHTML = '<p class="text-gray-400 text-center">Lade Aktivitäten...</p>';

    try {
        const querySnapshot = await db.collection("activity_feed").orderBy("timestamp", "desc").limit(30).get();

        if (querySnapshot.empty) {
            feedList.innerHTML = '<p class="text-gray-500 text-center">Noch keine Aktivitäten in der Community.</p>';
            return;
        }

        let feedHtml = '';
        querySnapshot.forEach(doc => {
            const event = doc.data();
            let eventHtml = '';

            const userLink = event.userId ? `<a href="#profile?user=${event.userId}" class="font-bold text-cyan-400 hover:underline">${event.username}</a>` : '';

            switch (event.type) {
                case 'RATING':
                    eventHtml = `
                        <p>${userLink} hat ${event.details.rating} Sterne für <strong>${event.details.gameTitle}</strong> vergeben.</p>
                    `;
                    break;
                case 'FRIENDSHIP':
                    const user1Link = `<a href="#profile?user=${event.details.user1Id}" class="font-bold text-cyan-400 hover:underline">${event.details.user1Username}</a>`;
                    const user2Link = `<a href="#profile?user=${event.details.user2Id}" class="font-bold text-cyan-400 hover:underline">${event.details.user2Username}</a>`;
                    eventHtml = `
                        <p>${user1Link} und ${user2Link} sind jetzt Freunde.</p>
                    `;
                    break;
                
            }
           
            const timestamp = event.timestamp?.toDate().toLocaleString('de-DE', { day: '2-digit', month: '2-digit', hour: '2-digit', minute: '2-digit' }) || '';

            feedHtml += `
                <div class="bg-gray-800 border border-gray-700 rounded-lg p-4 text-gray-300 text-sm">
                    ${eventHtml}
                    <p class="text-xs text-gray-500 text-right mt-1">${timestamp}</p>
                </div>
            `;
        });
        feedList.innerHTML = feedHtml;

    } catch (error) {
        console.error("Fehler beim Laden des Feeds:", error);
        feedList.innerHTML = '<p class="text-red-400 text-center">Der Aktivitäten-Feed konnte nicht geladen werden.</p>';
    }
}        
async function acceptFriendRequest(friendshipId) {
    try {
        // Zähler für den aktuellen Nutzer (Empfänger) um 1 verringern
        await db.collection('users').doc(auth.currentUser.uid).update({ pendingFriendRequests: firebase.firestore.FieldValue.increment(-1) });
        
        // Status der Freundschaft auf "accepted" setzen (NUR EINMAL)
        await db.collection("friendships").doc(friendshipId).update({ status: 'accepted' });
        
        // Feed-Eintrag erstellen
        const friendshipDoc = await db.collection("friendships").doc(friendshipId).get();
        const data = friendshipDoc.data();
        const user1Doc = await db.collection('users').doc(data.senderId).get();
        const user2Doc = await db.collection('users').doc(data.recipientId).get();
        db.collection('activity_feed').add({
            type: 'FRIENDSHIP',
            details: {
                user1Id: data.senderId,
                user1Username: user1Doc.data()?.username || 'jemand',
                user2Id: data.recipientId,
                user2Username: user2Doc.data()?.username || 'jemand anderem'
            },
            timestamp: firebase.firestore.FieldValue.serverTimestamp()
        });

        alert(i18next.t('alert_friend_request_accepted'));
        displayUserProfile(auth.currentUser.uid); // Profil neu laden, um die Listen zu aktualisieren
    } catch (error) {
        console.error("Fehler beim Annehmen der Anfrage:", error);
    }
}


async function declineFriendRequest(friendshipId) {
    try {
        // Zähler für den aktuellen Nutzer (Empfänger) um 1 verringern
        await db.collection('users').doc(auth.currentUser.uid).update({ pendingFriendRequests: firebase.firestore.FieldValue.increment(-1) });
        
        // Freundschaftsanfrage löschen (NUR EINMAL)
        await db.collection("friendships").doc(friendshipId).delete();
        
        // KORREKTUR: alert mit Übersetzung
        alert(i18next.t('alert_friend_request_declined'));
        
        // KORREKTUR: displayUserProfile mit der ID des aktuellen Nutzers aufrufen
        displayUserProfile(auth.currentUser.uid); 
    } catch (error) {
        console.error("Fehler beim Ablehnen der Anfrage:", error);
    }
}
// ERSETZE DEINE KOMPLETTE sendFriendRequest FUNKTION HIERMIT

async function sendFriendRequest(recipientId) {
    const sender = auth.currentUser;
    if (!sender) {
        alert(i18next.t('alert_login_to_send_request'));
        return;
    }

    const senderId = sender.uid;
    if (senderId === recipientId) return;

    // KORREKTUR 1: Die ID wird jetzt wieder korrekt aus beiden UIDs erstellt
    const docId = [senderId, recipientId].sort().join('_');
    const friendshipRef = db.collection("friendships").doc(docId);

    try {
        const doc = await friendshipRef.get();
        if (doc.exists) {
            alert(i18next.t('alert_request_already_sent'));
            return;
        }

        // KORREKTUR 2: Wir benutzen .set() anstatt .add() und die korrekte Variable 'recipientId'
        await friendshipRef.set({
            users: [senderId, recipientId],
            senderId: senderId,
            recipientId: recipientId,
            status: 'pending',
            createdAt: firebase.firestore.FieldValue.serverTimestamp()
        });
        await db.collection('users').doc(recipientId).update({ pendingFriendRequests: firebase.firestore.FieldValue.increment(1) });


        const addButton = document.querySelector(`button[onclick="sendFriendRequest('${recipientId}')"]`);
        if (addButton) {
            addButton.textContent = i18next.t('button_text_requested');
            addButton.disabled = true;
            addButton.classList.remove('bg-cyan-600', 'hover:bg-cyan-500');
            addButton.classList.add('bg-gray-500', 'cursor-not-allowed');
        }
        alert(i18next.t('alert_friend_request_sent'));

    } catch (error) {
        console.error("Fehler beim Senden der Freundschaftsanfrage:", error);
        alert(i18next.t('alert_friend_request_failed'));
    }
}
        

        // GAMEMATCH FUNKTIONEN
     async function loadTagsFromAPI() {
    try {
        const response = await fetch('/.netlify/functions/call-rawg', {
            method: 'POST',
            body: JSON.stringify({
                path: '/api/tags',
                params: { page_size: 40 }
            })
        });
        if (!response.ok) throw new Error(`RAWG API error: ${response.status}`);
        const data = await response.json();
        availableTags = data.results.map(tag => tag.slug);
    } catch (error) {
        console.error("Fehler beim Laden der Tags:", error);
        availableTags = ["singleplayer", "multiplayer", "co-op", "procedural-generation", "story-rich", "open-world", "atmospheric", "relaxing", "fast-paced", "horror", "difficult"];
    }
}

async function loadGenresFromAPI() {
    try {
        const response = await fetch('/.netlify/functions/call-rawg', {
            method: 'POST',
            body: JSON.stringify({
                path: '/api/genres',
                params: {} // 
            })
        });
        if (!response.ok) throw new Error(`RAWG API error: ${response.status}`);
        const data = await response.json();
        availableGenres = data.results.map(genre => genre.slug);
    } catch (error) {
        console.error("Fehler beim Laden der Genres:", error);
        availableGenres = ["action", "indie", "adventure", "rpg", "strategy", "shooter", "casual", "simulation", "puzzle", "arcade", "platformer", "racing", "sports", "fighting", "family", "board-games", "educational", "card"];
    }
}
        
function getGuestUsage() {
    const usageData = localStorage.getItem('guestUsage');
    console.log('Lese guestUsage aus localStorage:', usageData);
    if (!usageData) {
        return { count: 0, date: new Date().toDateString() };
    }

    const parsedData = JSON.parse(usageData);
    const today = new Date().toDateString();

    if (parsedData.date !== today) {
        // NEU: Der zurückgesetzte Zähler wird sofort gespeichert
        const resetData = { count: 0, date: today };
        localStorage.setItem('guestUsage', JSON.stringify(resetData));
        return resetData;
    }

    return parsedData;
}
function incrementGuestUsage() {
    const usage = getGuestUsage();
    usage.count++;
    console.log('Zähler wird erhöht auf:', usage.count);
    localStorage.setItem('guestUsage', JSON.stringify(usage));
}
        function showPage(pageId) {
            if (!pageId || pageId === '#') pageId = '#home';
            ui.pageSections.forEach(section => section.classList.remove('active', 'fade-in'));
            const targetSection = document.querySelector(pageId);
            if (targetSection) {
                targetSection.classList.add('active');
                if (pageId !== '#home') targetSection.classList.add('fade-in');
            }
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }
 function setupProfileTabs() {
    const tabContainer = document.getElementById('profile-tabs');
    // Verhindern, dass der Listener mehrfach hinzugefügt wird
    if (!tabContainer || tabContainer.dataset.listenerAttached) return;

    tabContainer.addEventListener('click', (e) => {
        const clickedButton = e.target.closest('.profile-tab-btn');
        if (!clickedButton) return;

        // Alle Buttons und Inhalte deaktivieren
        tabContainer.querySelectorAll('.profile-tab-btn').forEach(btn => btn.classList.remove('active'));
        document.querySelectorAll('.profile-tab-content').forEach(content => content.classList.remove('active'));
        
        // Geklickten Button und passenden Inhalt aktivieren
        clickedButton.classList.add('active');
        const targetContent = document.getElementById(clickedButton.dataset.target);
        if (targetContent) {
            targetContent.classList.add('active');
        }
    });

    tabContainer.dataset.listenerAttached = 'true';
}
function setupCommunityTabs() {
    // Die Nutzerliste wird jetzt immer sofort geladen, da die Regeln es erlauben.
    loadUserList(); 

    // KORREKTUR: Der richtige Klassenname für die Buttons wird hier verwendet.
    const tabButtons = document.querySelectorAll('.community-tab-btn');
    const tabContents = document.querySelectorAll('.community-tab-content');

    // Stellt sicher, dass der erste Tab ("Nutzer entdecken") standardmäßig aktiv ist.
    if (tabButtons.length > 0 && tabContents.length > 0) {
        // Zuerst alle deaktivieren
        tabButtons.forEach(btn => btn.classList.remove('active'));
        tabContents.forEach(content => content.classList.remove('active'));
        
        // Dann den ersten aktivieren
        tabButtons[0].classList.add('active');
        const defaultContent = document.getElementById(tabButtons[0].dataset.target);
        if (defaultContent) {
            defaultContent.classList.add('active');
        }
    }

    // Fügt die Klick-Logik für jeden Tab-Button hinzu.
    tabButtons.forEach(button => {
        button.addEventListener('click', () => {
            // Alle Tabs und Inhalte ausblenden
            tabButtons.forEach(btn => btn.classList.remove('active'));
            tabContents.forEach(content => content.classList.remove('active'));
            
            // Den geklickten Tab und den zugehörigen Inhalt anzeigen
            button.classList.add('active');
            const targetContent = document.getElementById(button.dataset.target);
            if (targetContent) {
                targetContent.classList.add('active');
            }

            // Lade den Inhalt für den jeweiligen Tab (erneut), falls nötig.
            if (button.dataset.target === 'community-content-suche') {
                loadUserList();
            } else if (button.dataset.target === 'community-content-feed') {
                loadActivityFeed();
            }
        });
    });
}

function handleAIResponse(responseText, nextStepHandler) {
    try {
        // Die Funktion erwartet jetzt direkt den JSON-Text, kein komplexes Objekt mehr
        const parsedJson = JSON.parse(responseText);
        nextStepHandler(parsedJson);
    } catch (e) {
        console.error("Parsing fehlgeschlagen:", e.message, "Original-Text:", responseText);
        renderErrorState("Fehler bei der Verarbeitung der KI-Antwort. Bitte versuche es erneut.");
    }
}
function processConversationStep(parsedJson) {
    renderInteraction({ 
        text: parsedJson.next_question, 
        inputType: 'text', 
        placeholder: 'Deine Antwort...', 
        isComplete: parsedJson.conversation_complete 
    });
}
function handleResponse(userText) {
    console.log("handleResponse aufgerufen mit:", userText);
    const userContainer = document.createElement('div');
    userContainer.className = 'user-bubble-container self-end w-full flex flex-col items-end';
    userContainer.innerHTML = `<span class="text-xs text-gray-400 mr-3 mb-1">${i18next.t('matchmaker_user_bubble')}</span><div class="bg-blue-600 rounded-lg rounded-br-none px-4 py-3">${sanitizeHTML(userText)}</div>`;
    ui.chatLog.appendChild(userContainer);
    ui.chatLog.scrollTop = ui.chatLog.scrollHeight;
    lastUserInput = userText;
    
    callGeminiAPI(userText, systemPromptConversation, true)
        .then(responseText => {
            if (responseText) handleAIResponse(responseText, processConversationStep);
        });
}
function renderInteraction({ text, inputType, placeholder, isComplete = false }) {
    const aiContainer = document.createElement('div');
    aiContainer.className = 'ai-bubble-container self-start w-full flex flex-col items-start';
    const sanitizedText = sanitizeHTML(text);
    aiContainer.innerHTML = `<span class="text-xs text-cyan-400 ml-3 mb-1">${i18next.t('matchmaker_ai_bubble')}</span><div class="bg-gray-700 rounded-lg rounded-bl-none px-4 py-3">${sanitizedText.replace(/\n/g, '<br>')}</div>`;
    ui.chatLog.appendChild(aiContainer);
    ui.chatLog.scrollTop = ui.chatLog.scrollHeight;
    ui.userInputArea.innerHTML = '';
    
    if (isComplete) {
        const searchButton = document.createElement('button');
        searchButton.className = 'w-full bg-cyan-500 text-gray-900 font-bold text-lg px-10 py-3 rounded-lg hover:bg-cyan-400 transition-all duration-300 transform hover:scale-105';
        searchButton.textContent = 'Finde mein Spiel!';
        searchButton.onclick = extractTagsAndSearch;
        ui.userInputArea.appendChild(searchButton);
    } else if (inputType === 'text') {
        const form = document.createElement('form');
        form.innerHTML = `<input type="text" placeholder="${placeholder || 'Deine Antwort...'}" class="w-full bg-gray-900 border border-gray-600 rounded-lg p-3 focus:outline-none focus:ring-2 focus:ring-blue-500 text-gray-50">`;
        form.onsubmit = (e) => {
            e.preventDefault();
            const userText = form.elements[0].value.trim();
            if (userText) handleResponse(userText);
        };
        ui.userInputArea.appendChild(form);
        form.elements[0].focus();
    }
}
function startConversation() {
            chatHistory = []; 
            ui.chatLog.innerHTML = '';
            ui.userInputArea.innerHTML = '';
            ui.resultContainer.classList.add('hidden');
            ui.chatWindow.style.display = 'flex';
            const initialAIMessage = i18next.t('matchmaker_initial_greeting');
            renderInteraction({ text: initialAIMessage, inputType: 'text', placeholder: i18next.t('matchmaker_initial_placeholder') });
        }
async function handleNavigation() {
    const hash = window.location.hash.substring(1);
    const [pageId, params] = hash.split('?');
    const targetPageId = '#' + (pageId || 'home');

    // Sicherheits-Check für die Admin-Seite
    if (targetPageId === '#admin') {
        const user = auth.currentUser;
        if (!user) {
            window.location.hash = '#home';
            return;
        }
        const userDoc = await db.collection('users').doc(user.uid).get();
        if (!userDoc.data()?.isAdmin) {
            alert("Zugriff verweigert.");
            window.location.hash = '#home';
            return;
        }
        displayUserManagement();
        displayBlogManagement();
    }
    
    // Lade die öffentliche News-Seite
    if (targetPageId === '#news') {
        displayNews();
    }

    // Lade die Partner-Seite
    if (targetPageId === '#partners') {
        displayPartners();
    }

    // KORREKTUR: Der Aufruf für das Datenschutz-Akkordeon ist jetzt an der richtigen Stelle
    if (targetPageId === '#datenschutz') {
        setupPrivacyPolicyAccordion();
    }

    // Dieser Teil steuert die allgemeine Seitennavigation
    showPage(targetPageId);

    // Spezifische Logik für bestimmte Seiten nach dem Anzeigen ausführen
    if (targetPageId === '#matchmaker') {
        setTimeout(startConversation, 100);
    }
    
    if (targetPageId === '#leaderboard') {
        displayLeaderboard();
    }
    
    if (targetPageId === '#search-users') {
        setupCommunityTabs();
    }

    if (targetPageId === '#profile') {
        const urlParams = new URLSearchParams(params);
        const userId = urlParams.get('user');
        
        if (userId) {
            displayUserProfile(userId); 
        } else if (auth.currentUser) {
            displayUserProfile(auth.currentUser.uid); 
        } else {
            window.location.hash = '#home';
        }
    }
}
function renderErrorState(message) {
    const errorContainer = document.createElement('div');
    errorContainer.className = 'bg-red-900/50 text-red-200 rounded-lg p-4 mb-4';
    errorContainer.innerHTML = `
        <p class="font-bold">Fehler</p>
        <p>${message}</p>
    `;
    ui.userInputArea.innerHTML = '';
    ui.userInputArea.appendChild(errorContainer);
}
async function callGeminiAPI(prompt, systemPrompt, useHistory = true) {
    setLoading(true);
    const FUNCTION_URL = '/.netlify/functions/call-gemini';

    // KORREKTUR: Stellt sicher, dass die Konversations-Historie korrekt mitgesendet wird.
    let localChatHistory = [];
    if (useHistory && chatHistory.length > 0) {
        localChatHistory = [...chatHistory];
    }
    localChatHistory.push({ role: "user", parts: [{ text: prompt }] });

    const payload = {
        contents: localChatHistory, // Wichtig: Hier wird die Historie übergeben
        systemInstruction: { role: "system", parts: [{ text: systemPrompt }] },
        generationConfig: {
            responseMimeType: "application/json",
            temperature: 0.7,
        }
    };

    try {
        const response = await fetch(FUNCTION_URL, {
            method: 'POST',
            body: JSON.stringify(payload)
        });

        if (!response.ok) {
            let errorMsg = `Server-Fehler: ${response.status}`;
            try {
                const errorData = await response.json();
                if (errorData && errorData.error && errorData.error.message) {
                    errorMsg = errorData.error.message;
                }
            } catch (e) {
                if (response.status === 504 || response.status === 503) {
                    throw new Error("overloaded_or_timeout");
                }
            }
            throw new Error(errorMsg);
        }

        const result = await response.json();
        
        if (!result.candidates || !result.candidates[0].content.parts[0].text) {
            throw new Error("Ungültige API-Antwortstruktur.");
        }
        
        const aiResponse = result.candidates[0].content.parts[0].text;

        // KORREKTUR: Stellt sicher, dass die neue Antwort zur Historie hinzugefügt wird.
        if (useHistory) {
            chatHistory.push({ role: "user", parts: [{ text: prompt }] });
            chatHistory.push({ role: "model", parts: [{ text: aiResponse }] });
        }
        
        return aiResponse;

    } catch (error) {
        console.error("API Error:", error);
        
        if (error.message.includes("overloaded") || error.message.includes("Timeout")) {
            renderErrorState("Die KI ist im Moment leider überlastet. Bitte versuche es in ein paar Minuten erneut.");
        } else {
            renderErrorState(i18next.t('matchmaker_error_service'));
        }
        return null;
    } finally {
        setLoading(false);
    }
}
async function searchGames(criteria) {
    setLoading(true);
    console.log(`Starte gestaffelte IGDB-Suche mit Kriterien:`, criteria);

    try {
        const { genre, themes, category } = criteria;

        // Eine Hilfsfunktion, um die Suchanfrage zu bauen.
        const buildQuery = (searchGenre, searchThemes) => {
            // Basisanforderungen, die jedes Spiel erfüllen muss
            let whereClauses = ["cover != null", "name != null", "total_rating_count > 10", "version_parent = null", "category = 0"];
            let genresToSearch = [];

            if (searchGenre) {
                genresToSearch.push(searchGenre);
            }
            // Wenn "Indie" explizit gewünscht ist, wird es zur Genre-Suche hinzugefügt.
            if (category === 'indie') {
                genresToSearch.push('indie');
            }

            if (genresToSearch.length > 0) {
                whereClauses.push(`genres.slug = ("${genresToSearch.join('","')}")`);
            }
            
            // Flexible "ODER"-Suche für Themen
            if (searchThemes && searchThemes.length > 0) {
                const themeClauses = searchThemes.map(t => `themes.slug = "${t}"`);
                whereClauses.push(`(${themeClauses.join(' | ')})`);
            }
            
            const whereString = whereClauses.join(' & ');
            return `fields name, summary, cover.url, genres.name, genres.slug, themes.name, themes.slug, game_modes.name, game_modes.slug; where ${whereString}; sort total_rating_count desc; limit 40;`;
        };

        // Hilfsfunktion zum Ausführen der Anfrage
        const runQuery = async (query) => {
            const response = await fetch('/.netlify/functions/call-igdb', { method: 'POST', body: JSON.stringify({ query }) });
            if (!response.ok) return [];
            return await response.json();
        };

        let igdbResults = [];

        // --- GESTAFFELTE "WASSERFALL"-SUCHE ---

        // VERSUCH 1: Perfekte, spezifische Suche (Genre + Themen)
        console.log("Versuch 1: Suche mit Genre und Themen.");
        if (genre || (themes && themes.length > 0)) {
            igdbResults = await runQuery(buildQuery(genre, themes));
        }

        // VERSUCH 2: Nur mit dem Hauptgenre suchen, wenn Versuch 1 fehlschlägt.
        if (igdbResults.length === 0 && genre) {
            console.log("Versuch 1 fehlgeschlagen. Starte Versuch 2: Suche nur mit dem wichtigsten Genre.");
            igdbResults = await runQuery(buildQuery(genre, null));
        }
        
        // VERSUCH 3: Nur mit Themen suchen, wenn alles andere fehlschlägt.
        if (igdbResults.length === 0 && themes && themes.length > 0) {
            console.log("Versuch 2 fehlgeschlagen. Starte Versuch 3 als Notfall: Suche nur mit Themen.");
            igdbResults = await runQuery(buildQuery(null, themes));
        }
        
        // --- DER "UNBESTECHLICHE TÜRSTEHER" ---
        // Finale Überprüfung, falls nach "Indie" gefragt wurde.
        if (category === 'indie') {
            const strictlyIndieGames = igdbResults.filter(game => game.genres && game.genres.some(g => g.slug === 'indie'));
            console.log(`Strikte Indie-Filterung angewendet. Reduziert von ${igdbResults.length} auf ${strictlyIndieGames.length} Spiele.`);
            igdbResults = strictlyIndieGames;
        }

        // --- Formatierung für den Rest der App ---
        const formattedGames = igdbResults.map(game => ({
            id: game.id,
            name: game.name,
            background_image: game.cover ? game.cover.url.replace('t_thumb', 't_cover_big') : 'https://placehold.co/600x400',
            genres: game.genres || [],
            themes: game.themes || [],
            game_modes: game.game_modes || []
        }));

        console.log(`Finale, geprüfte Liste von IGDB: ${formattedGames.length} einzigartige Spiele.`);
        return formattedGames;

    } catch (error) {
        console.error("Fehler bei der IGDB Spielesuche:", error);
        renderErrorState("Fehler bei der Spielesuche. Bitte versuche es später erneut.");
        return [];
    } finally {
        setLoading(false);
    }
}
       async function extractTagsAndSearch() {
          const user = auth.currentUser;

    if (!user) {
        const usage = getGuestUsage();
        console.log('Prüfe Limit. Aktueller Stand:', usage.count); // <-- HIER EINFÜGEN
        if (usage.count >= 2) {
            renderGuestLimitMessage();
            return;
        }
    }
            renderSystemMessage("Analysiere deine Wünsche...");
            const conversationText = chatHistory.map(entry => `${entry.role}: ${entry.parts[0].text}`).join('\n');
            const extractionPrompt = `Analysiere das Gespräch und extrahiere passende Begriffe.\n---\nGESPRÄCH:\n${conversationText}\n---\nVERFÜGBARE TAGS (für Eigenschaften, Mechaniken etc.):\n${availableTags.join(', ')}\n---\nVERFÜGBARE GENRES (für Spielkategorien):\n${availableGenres.join(', ')}\n---\nExtrahiere jetzt die passenden 'tags' und 'genres' als Komma-getrennte Listen.`;
            const jsonResponseText = await callGeminiAPI(extractionPrompt, systemPromptExtractor, false);
            if (jsonResponseText) {
                handleAIResponse(jsonResponseText, handleTagExtraction);
            }
        }
async function handleTagExtraction(parsedJson) {
    const criteria = parsedJson;
    
    if (!criteria || !criteria.genre) {
         renderErrorState("Ich konnte leider kein klares Genre aus deiner Anfrage ableiten. Bitte versuche es noch einmal.");
         return;
    }

    renderSystemMessage(`Suche nach Spielen, die zu deinen Wünschen passen...`);
    const igdbResults = await searchGames(criteria);

    if (!igdbResults || igdbResults.length === 0) {
        renderErrorState(`Ich konnte leider keine Spiele für deine Kriterien finden. Bitte starte eine neue Suche.`);
        return;
    }

    // ======================================================================
    // NEUE LOGIK: Gesehene Spiele filtern & Ergebnisse mischen
    // ======================================================================
    let finalResults = igdbResults;
    const user = auth.currentUser;

    // Schritt 1: Hole die Liste der bereits gesehenen Spiele für eingeloggte Nutzer
    if (user) {
        try {
            const seenGamesSnapshot = await db.collection("users").doc(user.uid).collection("suggestedGames").get();
            const seenGameIds = new Set(seenGamesSnapshot.docs.map(doc => doc.data().rawgId));
            
            // Schritt 2: Filtere die IGDB-Ergebnisse
            const initialCount = finalResults.length;
            const unseenGames = igdbResults.filter(game => !seenGameIds.has(game.id));
            
            console.log(`Filter für gesehene Spiele angewendet. Reduziert von ${initialCount} auf ${unseenGames.length} Ergebnisse.`);

            // Fallback: Wenn alle Spiele aus der Suche schon gesehen wurden, nimm die ursprüngliche Liste,
            // damit der Nutzer nicht ohne Ergebnis dasteht.
            if (unseenGames.length > 0) {
                finalResults = unseenGames;
            } else {
                console.log("Alle gefundenen Spiele wurden bereits vorgeschlagen. Nutze ursprüngliche Liste als Fallback.");
            }
        } catch(e) {
            console.error("Fehler beim Abrufen der gesehenen Spiele:", e);
        }
    }

    // Schritt 3: Mische die (gefilterte) Ergebnisliste, um Abwechslung zu schaffen
    for (let i = finalResults.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [finalResults[i], finalResults[j]] = [finalResults[j], finalResults[i]];
    }

    // Schritt 4: Wähle das erste Spiel aus der neuen, gemischten und gefilterten Liste
    const chosenGame = finalResults[0];

    // Der Rest der Funktion bleibt gleich...
    const gameFacts = {
        name: chosenGame.name,
        genres: chosenGame.genres.map(g => g.name).join(', '),
        themes: chosenGame.themes.map(t => t.name).join(', '),
        game_modes: chosenGame.game_modes.map(m => m.name).join(', ')
    };
    const descriptionPrompt = `
        Write a short, exciting recommendation for the following game based on these facts.
        Game Name: ${gameFacts.name}, Genres: ${gameFacts.genres}, Themes/Setting: ${gameFacts.themes}, Game Modes: ${gameFacts.game_modes}
        Based on these facts, create the recommendation text.
    `;
    const descriptionText = await callGeminiAPI(descriptionPrompt, systemPromptDescription, false);
    if (descriptionText) {
        showResult(chosenGame, descriptionText, finalResults);
    } else {
        renderErrorState("Die KI konnte keine Beschreibung für das Spiel erstellen.");
    }
}
function displayStars(container, avgRating, count) {
    let starsHtml = '';
    const rating = Math.round(avgRating * 2) / 2; // Auf halbe Sterne runden
    for (let i = 1; i <= 5; i++) {
        if (i <= rating) {
            starsHtml += '<svg class="w-5 h-5 text-yellow-400" fill="currentColor" viewBox="0 0 20 20"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/></svg>';
        } else if (i - 0.5 === rating) {
            starsHtml += '<svg class="w-5 h-5 text-yellow-400" fill="currentColor" viewBox="0 0 20 20"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292zM10 12.585V3.532l-.836 2.57H6.54l2.138 1.554-.836 2.57L10 12.585z"/></svg>';
        } else {
            starsHtml += '<svg class="w-5 h-5 text-gray-500" fill="currentColor" viewBox="0 0 20 20"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/></svg>';
        }
    }
    container.innerHTML = `<div class="flex items-center">${starsHtml}<span class="text-xs text-gray-400 ml-2">(${count} Stimmen)</span></div>`;
}

// NEUE FUNKTION 3: Erstellt die interaktiven Sterne zum Bewerten
function createInteractiveStars(container, gameId, currentRating) {
    container.innerHTML = '';
    const starWrapper = document.createElement('div');
    starWrapper.className = 'flex items-center cursor-pointer';
    starWrapper.setAttribute('data-rating', currentRating);

    for (let i = 1; i <= 5; i++) {
        const star = document.createElement('div');
        star.innerHTML = '<svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/></svg>';
        star.className = i <= currentRating ? 'text-cyan-400' : 'text-gray-600 hover:text-cyan-300';
        
        star.addEventListener('mouseover', () => {
            Array.from(starWrapper.children).forEach((s, index) => {
                s.className = index < i ? 'text-cyan-400' : 'text-gray-600 hover:text-cyan-300';
            });
        });
        
        star.addEventListener('click', () => {
            submitRating(gameId, i);
        });
        
        starWrapper.appendChild(star);
    }
    
    starWrapper.addEventListener('mouseout', () => {
        const savedRating = parseInt(starWrapper.getAttribute('data-rating'));
         Array.from(starWrapper.children).forEach((s, index) => {
            s.className = index < savedRating ? 'text-cyan-400' : 'text-gray-600 hover:text-cyan-300';
        });
    });

    container.appendChild(starWrapper);
}
async function submitRating(gameId, rating) {
    if (!auth.currentUser) {
        alert("Bitte logge dich ein, um eine Bewertung abzugeben.");
        return;
    }
    const userId = auth.currentUser.uid;
    const gameIdStr = String(gameId);
    const gameRatingRef = db.collection("game_ratings").doc(gameIdStr);
    const userRatingRef = gameRatingRef.collection("user_ratings").doc(userId);

    try {
        await db.runTransaction(async (transaction) => {
            const gameDoc = await transaction.get(gameRatingRef);
            const userDoc = await transaction.get(userRatingRef);

            let newRatingCount = gameDoc.exists ? gameDoc.data().ratingCount : 0;
            let currentTotalRating = gameDoc.exists ? gameDoc.data().averageRating * newRatingCount : 0;

            if (userDoc.exists) {
                // Nutzer hat bereits bewertet -> alte Bewertung abziehen
                currentTotalRating -= userDoc.data().rating;
            } else {
                // Erste Bewertung dieses Nutzers
                newRatingCount++;
            }

            const newTotalRating = currentTotalRating + rating;
            const newAverageRating = newTotalRating / newRatingCount;

            transaction.set(userRatingRef, { rating: rating, timestamp: firebase.firestore.FieldValue.serverTimestamp() });
            transaction.set(gameRatingRef, {
                averageRating: newAverageRating,
                ratingCount: newRatingCount
            }, { merge: true });
            
        });
        
        alert("Danke für deine Bewertung!");
        await grantXpAndCheckLevelUp(userId, 5); // +5 XP für eine Bewertung
        setupRatingUI(gameId, true);

    } catch (error) {
        console.error("Fehler beim Speichern der Bewertung: ", error);
        alert("Deine Bewertung konnte nicht gespeichert werden.");
    }
const userDoc = await db.collection('users').doc(userId).get();
const username = userDoc.data()?.username || 'Ein Nutzer';
db.collection('activity_feed').add({
    type: 'RATING',
    userId: userId,
    username: username,
    details: {
        gameId: gameIdStr,
        gameTitle: (await db.collection("game_ratings").doc(gameIdStr).get()).data()?.gameTitle || 'einem Spiel', // Titel holen, falls gespeichert
        rating: rating
    },
    timestamp: firebase.firestore.FieldValue.serverTimestamp()
});
}        
async function grantXp(userId, amount) {
    if (!userId || !amount) return;

    const userRef = db.collection("users").doc(userId);
    try {
        await userRef.update({
            xp: firebase.firestore.FieldValue.increment(amount)
        });
        console.log(`User ${userId} hat ${amount} XP erhalten.`);
    } catch (error) {
        console.error("Fehler beim Vergeben von XP:", error);
    }
}

async function compareGamesWithFriend(friendId) {
    const currentUser = auth.currentUser;
    if (!currentUser) return;

    alert("Vergleiche Spiele, bitte warten...");

    try {
        const currentUserGamesSnapshot = await db.collection("users").doc(currentUser.uid).collection("suggestedGames").get();
        const currentUserGameIds = new Set(currentUserGamesSnapshot.docs.map(doc => doc.data().rawgId));

        const friendGamesSnapshot = await db.collection("users").doc(friendId).collection("suggestedGames").get();
        
        const commonGames = [];
        friendGamesSnapshot.forEach(doc => {
            const game = doc.data();
            if (currentUserGameIds.has(game.rawgId)) {
                commonGames.push(game.title);
            }
        });

        if (commonGames.length > 0) {
            alert("Ihr habt diese Spiele gemeinsam:\n\n- " + commonGames.join("\n- "));
        } else {
            alert("Ihr habt keine gemeinsamen Spielempfehlungen.");
        }

    } catch (error) {
        console.error("Fehler beim Spielevergleich:", error);
        alert("Spiele konnten nicht verglichen werden.");
    }
}

async function handleLikeGame(gameData, description) {
    const user = auth.currentUser;
    if (!user) return;

    const gameIdStr = String(gameData.id);
    const userId = user.uid;

    try {
        // Dieser Teil ist korrekt und speichert das Spiel in der persönlichen Sammlung.
        await db.collection("users").doc(userId).collection("suggestedGames").add({
            title: gameData.name,
            rawgId: gameData.id,
            imageUrl: gameData.background_image,
            description: description,
            status: 'liked',
            suggestedAt: firebase.firestore.FieldValue.serverTimestamp()
        });

        const gameLikesRef = db.collection("gameLikes").doc(gameIdStr);
        const userProfile = await db.collection('users').doc(userId).get();
        const userData = userProfile.data();

        // KORREKTUR HIER:
        // Wir erstellen eine korrekte, verschachtelte 'users'-Map.
        await gameLikesRef.set({
            gameTitle: gameData.name,
            users: { // Erstellt das 'users'-Feld
                [userId]: { // Fügt den Nutzer mit seiner ID als Schlüssel hinzu
                    username: userData.username,
                    avatarUrl: userData.avatarUrl,
                    likedAt: firebase.firestore.FieldValue.serverTimestamp()
                }
            }
        }, { merge: true }); // { merge: true } sorgt dafür, dass andere Nutzer im 'users'-Feld nicht überschrieben werden.
        
        alert(`${gameData.name} wurde zu deinem Profil hinzugefügt!`);
        await grantXpAndCheckLevelUp(userId, 15);
        startConversation();
        window.location.hash = '#matchmaker';

    } catch (error) {
        console.error("Fehler beim Liken des Spiels:", error);
        alert("Das Spiel konnte nicht zu deinem Profil hinzugefügt werden.");
    }
}

async function handleDislikeGame(gameData, description) {
    const user = auth.currentUser;
    if (user) {
        // Speichere das abgelehnte Spiel im Hintergrund
        await db.collection("users").doc(user.uid).collection("suggestedGames").add({
            title: gameData.name,
            rawgId: gameData.id,
            imageUrl: gameData.background_image,
            description: description,
            status: 'disliked',
            suggestedAt: firebase.firestore.FieldValue.serverTimestamp()
        });
    }

    // Prüfen, ob noch weitere Kandidaten in der Liste sind
    if (currentGameCandidates && currentGameCandidates.length > 0) {
        renderSystemMessage("Okay, wie wäre es stattdessen hiermit?");
        
        // NEUE LOGIK: Wir nehmen den nächsten Kandidaten aus der Liste
        const nextGame = currentGameCandidates[0]; // Das nächste Spiel in der Liste
        
        // Wir holen uns die originale Konversation für den Kontext.
        const fullConversation = chatHistory.map(entry => entry.parts[0].text).join(' ');

        // Wir erstellen einen simplen Prompt, der die KI bittet, nur den Text zu schreiben.
        const descriptionPrompt = `
            User request: "${fullConversation}"
            Chosen Game: "${nextGame.name}"
            Write the recommendation text now.
        `;
        
        // Wir rufen die KI mit dem "Texter"-System-Prompt auf.
        const newDescription = await callGeminiAPI(descriptionPrompt, systemPromptDescription, false);

        if (newDescription) {
            // Wir rufen showResult mit den korrekten Daten auf:
            // Unser gewähltes Spiel, der neue Text und die restlichen Kandidaten.
            showResult(nextGame, newDescription, currentGameCandidates);
        } else {
             renderErrorState("Die KI konnte keine neue Beschreibung erstellen.");
        }

    } else {
        renderErrorState("Ich habe leider keine weiteren Vorschläge auf Lager. Lass uns eine neue Suche starten!");
    }
}
async function setupRatingUI(gameId, forceUpdate = false) {
    const avgRatingContainer = document.getElementById(`avg-rating-${gameId}`);
    const userRatingContainer = document.getElementById(`user-rating-${gameId}`);
    if (!avgRatingContainer || !userRatingContainer) return;

    if (!forceUpdate && avgRatingContainer.dataset.loaded === 'true') return;
    avgRatingContainer.dataset.loaded = 'true';

    try {
        // Durchschnittsbewertung holen
        const gameRatingDoc = await db.collection("game_ratings").doc(String(gameId)).get();
        if (gameRatingDoc.exists) {
            const { averageRating, ratingCount } = gameRatingDoc.data();
            displayStars(avgRatingContainer, averageRating, ratingCount);
        } else {
            avgRatingContainer.innerHTML = '<span class="text-xs text-gray-500">Noch keine Bewertungen</span>';
        }

        // Persönliche Bewertung des eingeloggten Nutzers holen
        const user = auth.currentUser;
        if (user) {
            const userRatingDoc = await db.collection("game_ratings").doc(String(gameId)).collection("user_ratings").doc(user.uid).get();
            const currentUserRating = userRatingDoc.exists ? userRatingDoc.data().rating : 0;
            createInteractiveStars(userRatingContainer, gameId, currentUserRating);
        }

    } catch (error) {
        console.error("Fehler beim Setup des Rating-UI:", error);
        avgRatingContainer.innerHTML = '<span class="text-xs text-red-400">Fehler</span>';
    }
}
function displayStars(container, avgRating, count) {
    let starsHtml = '';
    const rating = Math.round(avgRating * 2) / 2; // Auf halbe Sterne runden
    for (let i = 1; i <= 5; i++) {
        if (i <= rating) {
            starsHtml += '<svg class="w-5 h-5 text-yellow-400" fill="currentColor" viewBox="0 0 20 20"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/></svg>';
        } else if (i - 0.5 === rating) {
            starsHtml += '<svg class="w-5 h-5 text-yellow-400" fill="currentColor" viewBox="0 0 20 20"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292zM10 12.585V3.532l-.836 2.57H6.54l2.138 1.554-.836 2.57L10 12.585z"/></svg>';
        } else {
            starsHtml += '<svg class="w-5 h-5 text-gray-500" fill="currentColor" viewBox="0 0 20 20"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/></svg>';
        }
    }
    container.innerHTML = `<div class="flex items-center">${starsHtml}<span class="text-xs text-gray-400 ml-2">(${count} Stimmen)</span></div>`;
}
function createInteractiveStars(container, gameId, currentRating) {
    container.innerHTML = '';
    const starWrapper = document.createElement('div');
    starWrapper.className = 'flex items-center cursor-pointer';
    starWrapper.setAttribute('data-rating', currentRating);

    for (let i = 1; i <= 5; i++) {
        const star = document.createElement('div');
        star.innerHTML = '<svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/></svg>';
        star.className = i <= currentRating ? 'text-cyan-400' : 'text-gray-600 hover:text-cyan-300';
        
        star.addEventListener('mouseover', () => {
            Array.from(starWrapper.children).forEach((s, index) => {
                s.className = index < i ? 'text-cyan-400' : 'text-gray-600 hover:text-cyan-300';
            });
        });
        
        star.addEventListener('click', () => {
            submitRating(gameId, i);
        });
        
        starWrapper.appendChild(star);
    }
    
    starWrapper.addEventListener('mouseout', () => {
        const savedRating = parseInt(starWrapper.getAttribute('data-rating'));
         Array.from(starWrapper.children).forEach((s, index) => {
            s.className = index < savedRating ? 'text-cyan-400' : 'text-gray-600 hover:text-cyan-300';
        });
    });

    container.appendChild(starWrapper);
}

/**
 * Speichert die Bewertung eines Nutzers in der Datenbank.
 */
async function submitRating(gameId, rating) {
    if (!auth.currentUser) {
        alert("Bitte logge dich ein, um eine Bewertung abzugeben.");
        return;
    }
    const userId = auth.currentUser.uid;
    const gameIdStr = String(gameId);
    const gameRatingRef = db.collection("game_ratings").doc(gameIdStr);
    const userRatingRef = gameRatingRef.collection("user_ratings").doc(userId);

    try {
        await db.runTransaction(async (transaction) => {
            const gameDoc = await transaction.get(gameRatingRef);
            const userDoc = await transaction.get(userRatingRef);

            let newRatingCount = gameDoc.exists ? gameDoc.data().ratingCount : 0;
            let currentTotalRating = gameDoc.exists ? gameDoc.data().averageRating * newRatingCount : 0;

            if (userDoc.exists) {
                // Nutzer hat bereits bewertet -> alte Bewertung abziehen
                currentTotalRating -= userDoc.data().rating;
            } else {
                // Erste Bewertung dieses Nutzers
                newRatingCount++;
            }

            const newTotalRating = currentTotalRating + rating;
            const newAverageRating = newTotalRating / newRatingCount;

            transaction.set(userRatingRef, { rating: rating, timestamp: firebase.firestore.FieldValue.serverTimestamp() });
            transaction.set(gameRatingRef, {
                averageRating: newAverageRating,
                ratingCount: newRatingCount
            }, { merge: true });
        });
        
        alert("Danke für deine Bewertung!");
        await grantXpAndCheckLevelUp(userId, 5); // +5 XP für eine Bewertung
        setupRatingUI(gameId, true); // UI mit den neuen Daten aktualisieren

    } catch (error) {
        console.error("Fehler beim Speichern der Bewertung: ", error);
        alert("Deine Bewertung konnte nicht gespeichert werden.");
    }
}
async function displayUserProfile(userId, filter = 'all') {
    if (!userId) {
        console.error("Keine User-ID zum Anzeigen des Profils übergeben.");
        return;
    }

    const currentUser = auth.currentUser;
    const isOwnProfile = currentUser && currentUser.uid === userId;
    
    // UI-Elemente holen und für Fremdprofile anpassen
    const friendRequestsSection = document.getElementById('friend-requests-section');
    const mitspielerTabButton = document.querySelector('[data-target="profile-content-mitspieler"]');

    if (!isOwnProfile) {
        if(friendRequestsSection) friendRequestsSection.classList.add('hidden');
        if(mitspielerTabButton) mitspielerTabButton.classList.add('hidden');
    } else {
        if(friendRequestsSection) friendRequestsSection.classList.remove('hidden');
        if(mitspielerTabButton) mitspielerTabButton.classList.remove('hidden');
    }

    try {
        const userRef = db.collection("users").doc(userId);
        const userDoc = await userRef.get();
        if (!userDoc.exists) {
            document.getElementById('profile-content-container').innerHTML = `<p class="text-center text-red-400">${i18next.t('profile_user_not_found')}</p>`;
            return;
        }

        const userData = userDoc.data();
        
        // --- Profildaten anzeigen ---
        document.getElementById('profile-user-username').textContent = sanitizeHTML(userData.username || 'Nutzer');
        document.getElementById('profile-avatar').src = userData.avatarUrl || `https://i.pravatar.cc/150?u=${userId}`;
        
        // --- Statistiken laden und anzeigen ---
        loadAndDisplayStats(userData);
        
        // --- Empfehlungscode ---
        const referralContainer = document.getElementById('referral-container');
        if (isOwnProfile && referralContainer) {
            let userReferralCode = userData.referralCode;
            if (!userReferralCode) {
                userReferralCode = generateReferralCode();
                await userRef.update({ referralCode: userReferralCode });
            }
            referralContainer.classList.remove('hidden');
            document.getElementById('referral-code').textContent = userReferralCode;
            document.getElementById('referral-count').textContent = userData.referralCount || 0;
            document.getElementById('copy-referral-code').onclick = () => {
                navigator.clipboard.writeText(userReferralCode).then(() => {
                    const button = document.getElementById('copy-referral-code');
                    button.textContent = "Kopiert!";
                    setTimeout(() => { button.textContent = "Kopieren"; }, 2000);
                });
            };
        } else if (referralContainer) {
            referralContainer.classList.add('hidden');
        }

        // --- Robuste Ladeaufrufe für die Tab-Inhalte ---
        if (isOwnProfile) {
            try {
                await displayFriendRequests(userId);
                await displayFriendsList(userId);
                await displayGamePoolList(userId);
            } catch (e) { console.error("Fehler beim Laden der Freundes- & Mitspielerdaten isoliert:", e); }
        }
        
        try { await loadSavedGames(userId, filter, true); } 
        catch (e) { console.error("Fehler in loadSavedGames isoliert:", e); }
        
        try { await displayGamingNews(); } 
        catch (e) { console.error("Fehler beim Laden der News isoliert:", e); }
        
        // --- Tabs und Listener korrekt initialisieren ---
        setupProfileListeners();
        setupProfileTabs();

        // KORREKTUR: Erzwinge, dass der erste Tab ("Meine Spiele") beim Laden aktiv ist.
        document.querySelector('#profile-tabs .profile-tab-btn[data-target="profile-content-spiele"]').click();


    } catch (error) {
        console.error("Schwerwiegender Fehler beim Laden des Profils:", error);
    }
}

// NEUE HILFSFUNKTION: Bündelt die Logik für die Statistik-Anzeige
function loadAndDisplayStats(userData) {
    const level = userData.level || 1;
    document.getElementById('profile-user-rank').textContent = getRankForLevel(level);
    document.getElementById('profile-user-level').textContent = level;
    document.getElementById('profile-user-xp').textContent = userData.xp || 0;

    const xpForCurrentLevel = calculateCumulativeXp(level);
    const xpForNextLevel = calculateCumulativeXp(level + 1);
    const currentLevelXp = (userData.xp || 0) - xpForCurrentLevel;
    const requiredXpForNext = xpForNextLevel - xpForCurrentLevel;
    
    document.getElementById('progress-current-xp').textContent = `${currentLevelXp} XP`;
    document.getElementById('progress-next-level-xp').textContent = i18next.t('profile_xp_until_next_level', { xp: requiredXpForNext, level: level + 1 });
    document.getElementById('progress-bar-fill').style.width = `${Math.min(100, (currentLevelXp / requiredXpForNext) * 100)}%`;
}
async function displayFriendRequests(userId) {
    const requestsListContainer = document.getElementById('friend-requests-list');
    if (!requestsListContainer) return;

    try {
        const requestsQuery = db.collection("friendships")
                                .where("recipientId", "==", userId)
                                .where("status", "==", "pending");
        
        const requestsSnapshot = await requestsQuery.get();

        const friendRequestsSection = document.getElementById('friend-requests-section');
        if (requestsSnapshot.empty) {
            if(friendRequestsSection) friendRequestsSection.classList.add('hidden');
            return;
        }

        if(friendRequestsSection) friendRequestsSection.classList.remove('hidden');
        
        let requestsHtml = '';

        for (const doc of requestsSnapshot.docs) {
            const request = doc.data();
            const senderDoc = await db.collection("users").doc(request.senderId).get();
            
            if (senderDoc.exists) {
                const senderData = senderDoc.data();
                
                // KORREKTUR HIER: Name und Übersetzung sind jetzt getrennt.
                requestsHtml += `
                    <div class="bg-gray-900 p-3 rounded-lg flex flex-col sm:flex-row items-center justify-between gap-3">
                        <p class="text-white">
                            <strong class="font-semibold">${senderData.username}</strong> ${i18next.t('profile_request_received')}
                        </p>
                        <div class="flex gap-2">
                            <button onclick="acceptFriendRequest('${doc.id}')" class="bg-green-600 text-white text-xs font-semibold px-3 py-1.5 rounded-md hover:bg-green-500">${i18next.t('profile_request_accept')}</button>
                            <button onclick="declineFriendRequest('${doc.id}')" class="bg-red-600 text-white text-xs font-semibold px-3 py-1.5 rounded-md hover:bg-red-500">${i18next.t('profile_request_decline')}</button>
                        </div>
                    </div>
                `;
            }
        }
        requestsListContainer.innerHTML = requestsHtml;

    } catch (error) {
        console.error("Fehler beim Laden der Freundschaftsanfragen:", error);
        requestsListContainer.innerHTML = `<p class="text-red-400">Anfragen konnten nicht geladen werden.</p>`;
    }
}
async function displayFriendsList(userId) {
    const friendsListContainer = document.getElementById('friends-list');
    if (!friendsListContainer) return;

    try {
        const friendsQuery = db.collection("friendships")
                                 .where("users", "array-contains", userId)
                                 .where("status", "==", "accepted");
        
        const friendsSnapshot = await friendsQuery.get();

        if (friendsSnapshot.empty) {
            friendsListContainer.innerHTML = `<p class="text-gray-500 text-sm">${i18next.t('profile_no_friends')}</p>`;
            return;
        }

        let friendsHtml = '';
        for (const doc of friendsSnapshot.docs) {
            const friendship = doc.data();
            const friendId = friendship.users.find(id => id !== userId);
            const friendDoc = await db.collection("users").doc(friendId).get();

            if (friendDoc.exists) {
                const friendData = friendDoc.data();
                const safeUsername = sanitizeHTML(friendData.username);
                friendsHtml += `
                    <div class="bg-gray-900 p-3 rounded-lg flex items-center justify-between gap-3">
                        <a href="#profile?user=${friendId}" class="nav-trigger flex items-center gap-3">
                            <img src="${friendData.avatarUrl || `https://i.pravatar.cc/40?u=${friendId}`}" class="w-10 h-10 rounded-full object-cover">
                            <span class="font-semibold text-white hover:text-cyan-400">${safeUsername}</span>
                        </a>
                        <div class="flex gap-2">
                             <button onclick="openChat('${friendId}', '${escapeJS(friendData.username)}', '${friendData.avatarUrl || ''}')" class="bg-blue-600 text-white text-xs font-semibold px-3 py-1.5 rounded-md hover:bg-blue-500">${i18next.t('profile_games_chat')}</button>
                        </div>
                    </div>
                `;
            }
        }
        friendsListContainer.innerHTML = friendsHtml;

    } catch (error) {
        console.error("Fehler beim Laden der Freundesliste:", error);
        friendsListContainer.innerHTML = `<p class="text-red-400">Freundesliste konnte nicht geladen werden.</p>`;
    }
}
function escapeJS(str) {
    if (!str) return '';
    // KORREKTUR: Fügt das Ersetzen von Backslashes hinzu, um Fehler zu verhindern
    return str.replace(/\\/g, '\\\\')
              .replace(/'/g, "\\'")
              .replace(/"/g, '\\"')
              .replace(/\n/g, '\\n');
}

// NEUE FUNKTION: Öffnet und befüllt das Modal
async function openCommentModal(gameId, title, imageUrl, description, isOwnProfile) {
    const modal = document.getElementById('game-detail-modal');
    
    document.getElementById('modal-game-title').textContent = title;
    document.getElementById('modal-game-image').src = imageUrl;
    document.getElementById('modal-game-description').textContent = description.replace(/\\n/g, '\n');
    
    const ratingSection = document.getElementById('modal-rating-section');
    const commentList = document.getElementById('modal-comment-list');
    const commentForm = document.getElementById('modal-comment-form');
    
    ratingSection.innerHTML = `<p class="text-sm text-gray-400">${i18next.t('profile_loading')}</p>`;
    commentList.innerHTML = `<p class="text-sm text-gray-400">${i18next.t('profile_loading')}</p>`;
    commentForm.innerHTML = ''; 

    modal.classList.add('visible');

    await setupRatingUIForModal(gameId, isOwnProfile); 
    await loadCommentsForGame(gameId, 'modal-comment-list'); 
    
    if (auth.currentUser) {
        const userDoc = await db.collection("users").doc(auth.currentUser.uid).get();
        const avatarSrc = userDoc.data()?.avatarUrl || 'https://i.pravatar.cc/40?u=default';
        commentForm.innerHTML = `
            <div class="flex items-start w-full gap-2.5">
                <img class="w-8 h-8 rounded-full object-cover" src="${avatarSrc}" alt="Dein Avatar">
                <form onsubmit="postGameComment(event, '${gameId}')" class="flex-grow flex gap-2">
                  <input type="text" id="comment-input-${gameId}" placeholder="${i18next.t('modal_comments')}..." class="flex-grow bg-gray-700 border border-gray-600 rounded-lg p-2 text-white text-sm focus:outline-none focus:ring-2 focus:ring-cyan-500" maxlength="150" required>
                  <button type="submit" class="bg-cyan-600 hover:bg-cyan-500 text-white font-semibold px-4 rounded-lg text-sm">${i18next.t('nav_post')}</button> 
                </form>
            </div>
        `; // Note: You'll need to add a "nav_post" key: "Posten" -> "Post"
    }
}

// NEUE FUNKTION: Schließt das Modal
function closeCommentModal() {
    document.getElementById('game-detail-modal').classList.remove('visible');
}

// NEUE FUNKTION: Passt das Rating-Setup für das Modal an
async function setupRatingUIForModal(gameId, isOwnProfile) {
    const container = document.getElementById('modal-rating-section');
    if (!container) return;
    
    container.innerHTML = `
        <div id="modal-avg-rating-${gameId}"></div>
        ${isOwnProfile ? `<div id="modal-user-rating-${gameId}" class="mt-2"></div>` : ''}
    `;

    // Jetzt rufen wir die existierende Logik auf, aber mit den neuen Container-IDs
    const avgContainer = document.getElementById(`modal-avg-rating-${gameId}`);
    const gameRatingDoc = await db.collection("game_ratings").doc(String(gameId)).get();
    if (gameRatingDoc.exists) {
        displayStars(avgContainer, gameRatingDoc.data().averageRating, gameRatingDoc.data().ratingCount);
    } else {
        avgContainer.innerHTML = '<span class="text-xs text-gray-500">Noch keine Bewertungen</span>';
    }

    if (isOwnProfile && auth.currentUser) {
        const userContainer = document.getElementById(`modal-user-rating-${gameId}`);
        const userRatingDoc = await db.collection("game_ratings").doc(String(gameId)).collection("user_ratings").doc(auth.currentUser.uid).get();
        const rating = userRatingDoc.exists ? userRatingDoc.data().rating : 0;
        createInteractiveStars(userContainer, gameId, rating);
    }
}
document.getElementById('close-comment-modal').addEventListener('click', closeCommentModal);
document.getElementById('game-detail-modal').addEventListener('click', (e) => {
    if (e.target.id === 'game-detail-modal') {
        closeCommentModal();
    }
});
async function showResult(finalGame, finalDescription, rawgGames) {
    setLoading(false);
    try {
        currentGameCandidates = rawgGames.filter(g => g.id !== finalGame.id);

        // Spiel-Informationen anzeigen
        const resultContainer = ui.resultContainer;
        resultContainer.querySelector('#result-img').src = finalGame.background_image;
        resultContainer.querySelector('#result-title').textContent = finalGame.name;
        resultContainer.querySelector('#result-description').textContent = finalDescription.replace(/"/g, '');

        // --- NEU: AFFILIATE-BUTTONS DYNAMISCH ERSTELLEN ---
        const affiliateContainer = document.getElementById('result-affiliate-links');
        if (affiliateContainer) {
            affiliateContainer.innerHTML = ''; // Leert alte Buttons
            const encodedGameName = encodeURIComponent(finalGame.name);

            affiliatePartners.forEach(partner => {
                const partnerUrl = partner.urlTemplate.replace('{{GAME_NAME}}', encodedGameName);
                const buttonHtml = `
                    <a href="${partnerUrl}" target="_blank" rel="noopener nofollow"
                       class="flex-1 bg-gray-700 text-white font-semibold px-4 py-2.5 rounded-lg hover:bg-gray-600 transition-colors flex items-center justify-center gap-2 min-w-[140px]">
                        <img src="${partner.logo}" alt="${partner.name}" class="h-4">
                        <span>${partner.name}</span>
                    </a>
                `;
                affiliateContainer.innerHTML += buttonHtml;
            });
        }
        
        // Like/Dislike-Buttons wie gewohnt anzeigen
        document.getElementById('result-action-container')?.remove();
        const actionContainer = document.createElement('div');
        actionContainer.id = 'result-action-container';
        actionContainer.className = 'mt-8 flex flex-col sm:flex-row gap-4';
        actionContainer.innerHTML = `
            <button id="like-btn" class="w-full bg-green-600 text-white font-bold px-6 py-3 rounded-lg hover:bg-green-500 transition-colors transform hover:scale-105">👍 Gefällt mir</button>
            <button id="dislike-btn" class="w-full bg-red-600 text-white font-bold px-6 py-3 rounded-lg hover:bg-red-500 transition-colors transform hover:scale-105">👎 Nicht mein Fall</button>
        `;
        resultContainer.appendChild(actionContainer);
        
        document.getElementById('like-btn').onclick = () => handleLikeGame(finalGame, finalDescription);
        document.getElementById('dislike-btn').onclick = () => handleDislikeGame(finalGame, finalDescription);

        // UI-Status aktualisieren
        ui.chatWindow.style.display = 'none';
        resultContainer.classList.remove('hidden');
        
        if (!auth.currentUser) {
            incrementGuestUsage();
        }
        if (!document.querySelector('.confetti-canvas-active')) {
             fireConfetti();
        }
    } catch (e) {
        console.error("Error in showResult:", e);
        renderErrorState("Fehler beim Anzeigen des finalen Ergebnisses.");
    }
}
        function renderSystemMessage(message) {
            const container = document.createElement('div');
            container.className = 'ai-bubble-container self-center w-full flex flex-col items-center';
            container.innerHTML = `<div class="bg-yellow-900/50 text-yellow-300 text-xs rounded-full px-4 py-1">${message}</div>`;
            ui.chatLog.appendChild(container);
            ui.chatLog.scrollTop = ui.chatLog.scrollHeight;
        }
        function renderErrorState(message) {
            setLoading(false);
            const container = document.createElement('div');
            container.className = 'text-center p-4';
            container.innerHTML = `<div class="bg-red-900/50 text-red-200 rounded-lg p-4 mb-3"><p class="font-bold">Hoppla!</p><p>${message}</p></div><button class="bg-blue-600 hover:bg-blue-500 text-white font-bold py-2 px-4 rounded">Neu beginnen</button>`;
            container.querySelector('button').onclick = startConversation;
            ui.userInputArea.innerHTML = '';
            ui.userInputArea.appendChild(container);
        }
        function setLoading(isLoading) {
            if (isLoading) {
                ui.userInputArea.innerHTML = `<div class="text-center text-gray-400 is-loading">${i18next.t('matchmaker_loading_ai')}</div>`;
            } else {
                if (!ui.userInputArea.querySelector('.bg-red-900\\/50')) {
                    ui.userInputArea.innerHTML = '';
                }
            }
        }
        function fireConfetti() {
            const canvas = document.getElementById('confetti-canvas');
            if (!canvas) return;
            const ctx = canvas.getContext('2d');
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            let confetti = [];
            const confettiCount = 100;
            for (let i = 0; i < confettiCount; i++) {
                confetti.push({ x: Math.random() * canvas.width, y: Math.random() * canvas.height - canvas.height, r: Math.random() * 4 + 1, d: Math.random() * confettiCount, color: `hsl(${Math.random() * 360}, 90%, 70%)`, tilt: Math.floor(Math.random() * 10) - 10, tiltAngleIncremental: Math.random() * 0.07 + 0.05, tiltAngle: 0 });
            }
            let animationFrameId;
            function draw() {
                if (!ctx) return;
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                for (let i = 0; i < confetti.length; i++) {
                    const c = confetti[i];
                    ctx.beginPath();
                    ctx.lineWidth = c.r * 2;
                    ctx.strokeStyle = c.color;
                    ctx.moveTo(c.x + c.tilt + c.r, c.y);
                    ctx.lineTo(c.x + c.tilt, c.y + c.tilt + c.r);
                    ctx.stroke();
                }
                update();
            }
            function update() {
                let remaining = 0;
                for (let i = 0; i < confetti.length; i++) {
                    const c = confetti[i];
                    c.tiltAngle += c.tiltAngleIncremental;
                    c.y += (Math.cos(c.d) + 3 + c.r / 2) / 2;
                    c.tilt = Math.sin(c.tiltAngle - i / 3) * 15;
                    if (c.y <= canvas.height) remaining++;
                }
                if (remaining > 0) {
                    animationFrameId = requestAnimationFrame(draw);
                } else {
                    if(ctx) ctx.clearRect(0, 0, canvas.width, canvas.height);
                    cancelAnimationFrame(animationFrameId);
                }
            }
            draw();
        }
        function renderGuestLimitMessage() {
    setLoading(false);
    const container = document.createElement('div');
    container.className = 'text-center p-4';
    container.innerHTML = `
    <div class="bg-blue-900/50 text-blue-200 rounded-lg p-4 mb-3">
        <p class="font-bold">${i18next.t('matchmaker_guest_limit_title')}</p>
        <p class="mt-2">${i18next.t('matchmaker_guest_limit_desc')}</p>
    </div>
    <div class="flex gap-4 mt-4">
        <button id="limit-register-btn" class="flex-1 bg-cyan-500 hover:bg-cyan-400 text-gray-900 font-bold py-2 px-4 rounded">${i18next.t('matchmaker_guest_limit_register')}</button>
        <button id="limit-login-btn" class="flex-1 bg-gray-600 hover:bg-gray-500 text-white font-bold py-2 px-4 rounded">${i18next.t('nav_login')}</button>
    </div>
`;
    
    // Event Listeners for the new buttons
    container.querySelector('#limit-register-btn').onclick = () => openAuthModal('register');
    container.querySelector('#limit-login-btn').onclick = () => openAuthModal('login');
    
    // UI-Bereich leeren und Meldung einfügen
    const ui = { userInputArea: document.getElementById('user-input-area') };
    ui.userInputArea.innerHTML = '';
    ui.userInputArea.appendChild(container);
}
function generateCacheKey(tags, genres) {
    const sortedTags = tags ? tags.split(',').sort().join(',') : '';
    const sortedGenres = genres ? genres.split(',').sort().join(',') : '';
    return `genres:${sortedGenres}|tags:${sortedTags}`;
}
 // === LEVEL-SYSTEM FUNKTIONEN UND KONSTANTEN ===

const XP_FOR_LEVEL = [
    0,     // Level 1: Start
    100,   // Benötigte XP für Level 2
    200,   // Benötigte XP für Level 3
    400,   // Benötigte XP für Level 4
    1200,  // Benötigte XP für Level 5 (deutlicher Sprung)
    1800,  // Benötigte XP für Level 6
    2500,  // Benötigte XP für Level 7
    3500,  // Benötigte XP für Level 8
    5000,  // Benötigte XP für Level 9
    7500   // Benötigte XP für Level 10
];

const RANKS = {
    1: "Spiele-Neuling",
    3: "KI-Entdecker",
    5: "Community-Mitglied",
    7: "Spiele-Kenner",
    10: "GameMatch-Veteran"
};

function calculateLevel(totalXp) {
    let cumulativeXp = 0;
    for (let level = 1; level < XP_FOR_LEVEL.length; level++) {
        cumulativeXp += XP_FOR_LEVEL[level-1];
        if (totalXp < cumulativeXp + XP_FOR_LEVEL[level]) {
            return level;
        }
    }
    return XP_FOR_LEVEL.length;
}

function getRankForLevel(level) {
    let currentRank = "Spiele-Neuling";
    for (const rankLevel in RANKS) {
        if (level >= rankLevel) {
            currentRank = RANKS[rankLevel];
        }
    }
    return currentRank;
}

function calculateCumulativeXp(level) {
    let cumulativeXp = 0;
    // Wir summieren die XP, die für JEDES Level bis zum Ziellevel benötigt werden.
    // Für Level 3 sind das die XP für Level 1 (0) + XP für Level 2 (100).
    for (let i = 1; i < level; i++) {
        cumulativeXp += XP_FOR_LEVEL[i];
    }
    return cumulativeXp;
}

async function grantXpAndCheckLevelUp(userId, amount) {
    if (!userId || !amount) return;
    const userRef = db.collection("users").doc(userId);
    try {
        // Diese Transaktion stellt sicher, dass Lese- und Schreibvorgänge atomar sind.
        await db.runTransaction(async (transaction) => {
            const userDoc = await transaction.get(userRef);
            if (!userDoc.exists) {
                throw "User does not exist!";
            }

            const currentXp = userDoc.data().xp || 0;
            const newXp = currentXp + amount;
            
            const currentLevel = userDoc.data().level || 1;
            const newLevel = calculateLevel(newXp);

            // Aktualisiere die Felder XP und Level in der Transaktion.
            transaction.update(userRef, { xp: newXp, level: newLevel });

            if (newLevel > currentLevel) {
                console.log(`User ${userId} ist auf Level ${newLevel} aufgestiegen!`);
                // Hier könntest du eine Benachrichtigung für den Level-Up anzeigen.
            }
        });
    } catch (error) {
        console.error("Fehler beim Vergeben von XP:", error);
    }
}
async function toggleUserBan(userId, isCurrentlyBanned) {
    if (!confirm(`Möchtest du diesen Nutzer wirklich ${isCurrentlyBanned ? 'entsperren' : 'sperren'}?`)) {
        return;
    }
    try {
        await db.collection('users').doc(userId).update({
            isBanned: !isCurrentlyBanned
        });
        alert(`Nutzer wurde erfolgreich ${isCurrentlyBanned ? 'entsperrt' : 'gesperrt'}.`);
        displayUserManagement(); // Lade die Tabelle neu, um den neuen Status anzuzeigen
    } catch (error) {
        console.error("Fehler beim Ändern des Sperrstatus:", error);
        alert("Aktion fehlgeschlagen.");
    }
}

/**
 * Ändert den 'isAdmin'-Status eines Nutzers in der Datenbank.
 * @param {string} userId - Die UID des Nutzers.
 * @param {boolean} isCurrentlyAdmin - Der aktuelle Admin-Status.
 */
async function toggleAdminStatus(userId, isCurrentlyAdmin) {
    if (!confirm(`Möchtest du diesem Nutzer wirklich die Admin-Rechte ${isCurrentlyAdmin ? 'entziehen' : 'geben'}?`)) {
        return;
    }
    try {
        await db.collection('users').doc(userId).update({
            isAdmin: !isCurrentlyAdmin
        });
        alert(`Admin-Status wurde erfolgreich geändert.`);
        displayUserManagement(); // Lade die Tabelle neu
    } catch (error) {
        console.error("Fehler beim Ändern des Admin-Status:", error);
        alert("Aktion fehlgeschlagen.");
    }
}
async function displayNews() {
    const postListContainer = document.getElementById('news-post-list');
    if (!postListContainer) return;

    postListContainer.innerHTML = `<p class="text-center text-gray-400">${i18next.t('news_loading')}</p>`;

    try {
        const querySnapshot = await db.collection("blogPosts").orderBy("createdAt", "desc").get();
        if (querySnapshot.empty) {
            postListContainer.innerHTML = `<p class="text-center text-gray-500">${i18next.t('news_no_posts')}</p>`;
            return;
        }

        let postsHtml = '';
        querySnapshot.forEach(doc => {
            const post = doc.data();
            const postDate = post.createdAt?.toDate().toLocaleDateString(i18next.language, { year: 'numeric', month: 'long', day: 'numeric' }) || '';

            // KORREKTUR 1: Desinfiziere den Titel des Beitrags.
            const safeTitle = sanitizeHTML(post.title);

            // KORREKTUR 2: Desinfiziere den Inhalt, BEVOR Zeilenumbrüche hinzugefügt werden.
            const sanitizedContent = sanitizeHTML(post.content);
            const contentHtml = sanitizedContent.replace(/\n/g, '<br>'); // Erst jetzt sicher die Zeilenumbrüche umwandeln.

            postsHtml += `
                <article class="bg-gray-800/50 border border-gray-700 rounded-xl p-8">
                    <h3 class="text-3xl font-bold text-cyan-400 mb-2">${safeTitle}</h3>
                    <p class="text-sm text-gray-400 mb-6">${i18next.t('news_published_on')} ${postDate}</p>
                    <div class="prose prose-invert max-w-none text-gray-300">${contentHtml}</div>
                </article>
            `;
        });
        postListContainer.innerHTML = postsHtml;
    } catch (error) {
        console.error("Fehler beim Laden der News:", error);
        postListContainer.innerHTML = `<p class="text-center text-red-400">${i18next.t('news_error')}</p>`;
    }
}
async function displayBlogManagement() {
    const postListContainer = document.getElementById('admin-blog-post-list');
    if (!postListContainer) return;
    postListContainer.innerHTML = '<p class="text-gray-400">Lade Beiträge...</p>';

    const querySnapshot = await db.collection("blogPosts").orderBy("createdAt", "desc").get();
    if (querySnapshot.empty) {
        postListContainer.innerHTML = '<p class="text-gray-500">Noch keine Beiträge erstellt.</p>';
        return;
    }

    let postsHtml = '';
    querySnapshot.forEach(doc => {
        const post = doc.data();
        postsHtml += `
            <div class="bg-gray-900 p-3 rounded-lg flex justify-between items-center">
                <span class="font-semibold text-white">${post.title}</span>
                <div class="flex gap-2">
                    <button onclick="editBlogPost('${doc.id}', '${post.title.replace(/'/g, "\\'")}', '${post.content.replace(/'/g, "\\'").replace(/\n/g, '\\n')}')" class="text-xs bg-blue-600 text-white font-semibold px-2 py-1 rounded-md hover:bg-blue-500">Bearbeiten</button>
                    <button onclick="deleteBlogPost('${doc.id}')" class="text-xs bg-red-600 text-white font-semibold px-2 py-1 rounded-md hover:bg-red-500">Löschen</button>
                </div>
            </div>
        `;
    });
    postListContainer.innerHTML = postsHtml;
}

/**
 * Befüllt das Bearbeitungsformular mit den Daten eines bestehenden Posts.
 */
function editBlogPost(id, title, content) {
    document.getElementById('blog-post-id').value = id;
    document.getElementById('blog-post-title').value = title;
    document.getElementById('blog-post-content').value = content.replace(/\\n/g, '\n');
    document.getElementById('blog-post-title').focus();
}

/**
 * Löscht einen Blog-Post aus der Datenbank.
 */
async function deleteBlogPost(postId) {
    if (!confirm("Möchtest du diesen Beitrag wirklich endgültig löschen?")) return;
    try {
        await db.collection("blogPosts").doc(postId).delete();
        alert("Beitrag gelöscht.");
        displayBlogManagement(); // Liste aktualisieren
    } catch (error) {
        console.error("Fehler beim Löschen des Beitrags:", error);
        alert("Beitrag konnte nicht gelöscht werden.");
    }
}

/**
 * Behandelt das Absenden des Blog-Post-Formulars (Erstellen & Aktualisieren).
 */
async function handleBlogPostSubmit(event) {
    event.preventDefault();
    const postId = document.getElementById('blog-post-id').value;
    const title = document.getElementById('blog-post-title').value;
    const content = document.getElementById('blog-post-content').value;

    if (!title || !content) {
        alert("Titel und Inhalt dürfen nicht leer sein.");
        return;
    }

    const postData = {
        title: title,
        content: content,
        createdAt: firebase.firestore.FieldValue.serverTimestamp()
    };

    try {
        if (postId) {
            // Bestehenden Post aktualisieren
            await db.collection("blogPosts").doc(postId).update(postData);
            alert("Beitrag erfolgreich aktualisiert!");
        } else {
            // Neuen Post erstellen
            await db.collection("blogPosts").add(postData);
            alert("Beitrag erfolgreich erstellt!");
        }
        document.getElementById('blog-post-form').reset();
        document.getElementById('blog-post-id').value = '';
        displayBlogManagement(); // Liste aktualisieren
    } catch (error) {
        console.error("Fehler beim Speichern des Beitrags:", error);
        alert("Beitrag konnte nicht gespeichert werden.");
    }
}
async function displayLatestNewsOnHome() {
    const container = document.getElementById('home-news-list');
    if (!container) return;

    try {
        const querySnapshot = await db.collection("blogPosts").orderBy("createdAt", "desc").limit(2).get();
        if (querySnapshot.empty) {
            container.innerHTML = '<p class="text-center text-gray-500 lg:col-span-2">Es gibt noch keine Beiträge.</p>';
            return;
        }

        let postsHtml = '';
        querySnapshot.forEach(doc => {
            const post = doc.data();
            const postDate = post.createdAt?.toDate().toLocaleDateString('de-DE', { day: 'numeric', month: 'long' }) || '';
            
            // KORREKTUR: Titel und Teaser werden desinfiziert
            const safeTitle = sanitizeHTML(post.title);
            const safeTeaser = sanitizeHTML(post.content.substring(0, 120) + '...');

            postsHtml += `
                <article class="flex flex-col items-start justify-between bg-gray-800/50 p-6 rounded-2xl ring-1 ring-white/10 hover:ring-cyan-400/50 transition-all">
                    <div class="relative w-full">
                        <div class="flex items-center gap-x-4 text-xs">
                            <time datetime="${post.createdAt?.toDate().toISOString()}" class="text-gray-400">${postDate}</time>
                        </div>
                        <div class="group relative">
                            <h3 class="mt-3 text-lg font-semibold leading-6 text-white group-hover:text-cyan-400">
                                <a href="#news" class="nav-trigger">
                                    <span class="absolute inset-0"></span>
                                    ${safeTitle}
                                </a>
                            </h3>
                            <p class="mt-4 line-clamp-3 text-sm leading-6 text-gray-300">${safeTeaser}</p>
                        </div>
                    </div>
                </article>
            `;
        });
        container.innerHTML = postsHtml;
    } catch (error) {
        console.error("Fehler beim Laden der News für die Startseite:", error);
        container.innerHTML = '<p class="text-red-400 lg:col-span-2">Beiträge konnten nicht geladen werden.</p>';
    }
}
document.addEventListener('DOMContentLoaded', () => {

    // Authentifizierungs-Status überwachen
    auth.onAuthStateChanged(user => {
        const isLoggedIn = !!user;
        const authElements = {
            // Desktop
            loginBtn: document.getElementById('login-btn'),
            registerBtn: document.getElementById('register-btn'),
            logoutBtn: document.getElementById('logout-btn'),
            profileLink: document.getElementById('profile-link'),
            searchUsersLink: document.getElementById('search-users-link'),
            leaderboardLink: document.getElementById('leaderboard-link'),
            adminLink: document.getElementById('admin-link'),
            unreadBadge: document.getElementById('unread-messages-badge'),
            // Mobile
            mobileLoginBtn: document.getElementById('mobile-login-btn'),
            mobileRegisterBtn: document.getElementById('mobile-register-btn'),
            mobileMenuDivider: document.getElementById('mobile-menu-divider'),
            mobileLeaderboardLink: document.getElementById('mobile-leaderboard-link'),
            mobileSearchUsersLink: document.getElementById('mobile-search-users-link'),
            mobileProfileLink: document.getElementById('mobile-profile-link'),
            mobileAdminLink: document.getElementById('mobile-admin-link'),
            mobileLogoutBtn: document.getElementById('mobile-logout-btn')
        };
        if (isLoggedIn && (window.location.hash === '' || window.location.hash === '#home')) {
        // Wenn der Nutzer eingeloggt ist und sich auf der Startseite befindet,
        // leite ihn zu seinem Profil weiter.
        window.location.hash = '#profile';
    }
        
        // --- Robuste Logik für alle Elemente ---
        // Logged-out Zustand
        authElements.loginBtn?.classList.toggle('hidden', isLoggedIn);
        authElements.registerBtn?.classList.toggle('hidden', isLoggedIn);
        authElements.mobileLoginBtn?.classList.toggle('hidden', isLoggedIn);
        authElements.mobileRegisterBtn?.classList.toggle('hidden', isLoggedIn);
        authElements.mobileMenuDivider?.classList.toggle('hidden', isLoggedIn);

        // Logged-in Zustand
        authElements.logoutBtn?.classList.toggle('hidden', !isLoggedIn);
        authElements.profileLink?.classList.toggle('hidden', !isLoggedIn);
        authElements.searchUsersLink?.classList.toggle('hidden', !isLoggedIn);
        authElements.leaderboardLink?.classList.toggle('hidden', !isLoggedIn);
        authElements.mobileLeaderboardLink?.classList.toggle('hidden', !isLoggedIn);
        authElements.mobileSearchUsersLink?.classList.toggle('hidden', !isLoggedIn);
        authElements.mobileProfileLink?.classList.toggle('hidden', !isLoggedIn);
        authElements.mobileLogoutBtn?.classList.toggle('hidden', !isLoggedIn);

        // Elemente, die erst bei Bedarf gezeigt werden
        authElements.adminLink?.classList.add('hidden');
        authElements.mobileAdminLink?.classList.add('hidden');
        
        if (isLoggedIn) {
            unsubscribeFromUserDoc = db.collection('users').doc(user.uid).onSnapshot(doc => {
                 if (doc.exists) {
                    const userData = doc.data();
                    const totalUnread = (userData.totalUnreadMessages || 0) + (userData.pendingFriendRequests || 0);
                    if (totalUnread > 0 && authElements.unreadBadge) {
                        authElements.unreadBadge.textContent = totalUnread > 9 ? '9+' : totalUnread;
                        authElements.unreadBadge.classList.remove('hidden');
                    } else if(authElements.unreadBadge) {
                        authElements.unreadBadge.classList.add('hidden');
                    }
                    if (userData.isAdmin === true) {
                        authElements.adminLink?.classList.remove('hidden');
                        authElements.mobileAdminLink?.classList.remove('hidden');
                    }
                }
            });
        } else {
            if (unsubscribeFromUserDoc) unsubscribeFromUserDoc();
            if (authElements.unreadBadge) authElements.unreadBadge.classList.add('hidden');
        }
    });

    // --- Alle anderen Event-Listener ---
    
    // Auth Modal
    document.getElementById('login-btn')?.addEventListener('click', () => openAuthModal('login'));
    document.getElementById('register-btn')?.addEventListener('click', () => openAuthModal('register'));
    document.getElementById('mobile-login-btn')?.addEventListener('click', () => openAuthModal('login'));
    document.getElementById('mobile-register-btn')?.addEventListener('click', () => openAuthModal('register'));
    document.getElementById('open-login-modal-btn')?.addEventListener('click', () => openAuthModal('login'));
    document.getElementById('open-register-modal-btn')?.addEventListener('click', () => openAuthModal('register'));
    document.getElementById('close-auth-modal-btn')?.addEventListener('click', closeAuthModal);
    document.getElementById('auth-modal')?.addEventListener('click', (e) => {
        if (e.target.id === 'auth-modal') closeAuthModal();
    });
    document.getElementById('switch-to-register')?.addEventListener('click', () => openAuthModal('register'));
    document.getElementById('switch-to-login')?.addEventListener('click', () => openAuthModal('login'));

    // Formular-Submissions
    document.getElementById('login-form')?.addEventListener('submit', handleEmailLogin);
    document.getElementById('register-form')?.addEventListener('submit', handleEmailRegister);

    // Google Sign-In
    document.getElementById('google-signin-btn')?.addEventListener('click', signInWithGoogle);
    document.getElementById('google-signup-btn')?.addEventListener('click', signInWithGoogle);

    // Logout
    document.getElementById('logout-btn')?.addEventListener('click', handleLogout);
    document.getElementById('mobile-logout-btn')?.addEventListener('click', handleLogout);

    // Mobile Menu
    const mobileMenuBtn = document.getElementById('mobile-menu-btn');
    const mobileMenu = document.getElementById('mobile-menu');
    const openIcon = document.getElementById('menu-open-icon');
    const closeIcon = document.getElementById('menu-close-icon');

    mobileMenuBtn?.addEventListener('click', () => {
        mobileMenu.classList.toggle('hidden');
        openIcon.classList.toggle('hidden');
        closeIcon.classList.toggle('hidden');
    });
    mobileMenu?.addEventListener('click', (e) => {
        if (e.target.tagName === 'A' || e.target.tagName === 'BUTTON') {
            mobileMenu.classList.add('hidden');
            openIcon.classList.remove('hidden');
            closeIcon.classList.add('hidden');
        }
    });

    // Admin Tabs
    const adminTabs = document.getElementById('admin-tabs');
    if (adminTabs) {
        adminTabs.addEventListener('click', (e) => {
            const clickedButton = e.target.closest('.profile-tab-btn');
            if (!clickedButton) return;
            adminTabs.querySelectorAll('.profile-tab-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('#admin-tab-content-container .profile-tab-content').forEach(content => content.classList.remove('active'));
            clickedButton.classList.add('active');
            const targetContent = document.getElementById(clickedButton.dataset.target);
            if (targetContent) targetContent.classList.add('active');
        });
    }
    
    // Blog Formular
    document.getElementById('blog-post-form')?.addEventListener('submit', handleBlogPostSubmit);
    document.getElementById('clear-blog-form')?.addEventListener('click', () => {
        document.getElementById('blog-post-form').reset();
        document.getElementById('blog-post-id').value = '';
    });
    
    // Giveaway Banner
    const giveawayBanner = document.getElementById('giveaway-banner');
    const closeGiveawayBanner = document.getElementById('close-giveaway-banner');
    if (giveawayBanner && closeGiveawayBanner) {
        if (sessionStorage.getItem('giveawayBannerClosed') !== 'true') {
            giveawayBanner.classList.remove('hidden');
        }
        closeGiveawayBanner.addEventListener('click', () => {
            giveawayBanner.classList.add('hidden');
            sessionStorage.setItem('giveawayBannerClosed', 'true');
        });
    }
    
    // Initialisierungsfunktionen
    incrementVisitCounter();
    Promise.all([loadTagsFromAPI(), loadGenresFromAPI()]).then(() => {
        console.log("Alle Tags und Genres erfolgreich geladen.");
    });
    displayFeaturedGame();
    handleNavigation();
    window.addEventListener('hashchange', handleNavigation);
});
function generateReferralCode() {
    const chars = 'ABCDEFGHJKLMNPQRSTUVWXYZ23456789'; // Ohne I, O, 0, 1
    let result = '';
    for (let i = 0; i < 6; i++) {
        result += chars.charAt(Math.floor(Math.random() * chars.length));
    }
    return result;
}
// ======================================================================
// ANIMATION FÜR DIE STATISTIK-ZÄHLER
// ======================================================================
function animateValue(obj, start, end, duration, decimals = 0) {
    let startTimestamp = null;
    const step = (timestamp) => {
        if (!startTimestamp) startTimestamp = timestamp;
        const progress = Math.min((timestamp - startTimestamp) / duration, 1);
        const value = progress * (end - start) + start;
        obj.innerHTML = value.toFixed(decimals).replace('.', ','); // Komma für deutsche Darstellung
        if (progress < 1) {
            window.requestAnimationFrame(step);
        }
    };
    window.requestAnimationFrame(step);
}

const statsSection = document.getElementById('stats-section');
// Prüfen, ob das Element existiert, bevor wir den Observer starten
if (statsSection) {
    const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            // Animation starten, wenn die Sektion zu 50% sichtbar ist
            if (entry.isIntersecting) {
                animateValue(document.getElementById('stat-recommendations'), 0, 1026, 2000);
                animateValue(document.getElementById('stat-members'), 0, 25, 2000);
                animateValue(document.getElementById('stat-rating'), 0, 4.7, 2000, 1); // 1 Dezimalstelle
                
                // Observer stoppen, damit die Animation nur einmal läuft
                observer.unobserve(statsSection);
            }
        });
    }, { threshold: 0.5 });

    observer.observe(statsSection);
}
async function displayGamingNews() {
    const container = document.getElementById('profile-content-news');
    if (!container) return;
    container.innerHTML = `<p class="text-gray-400 text-center">${i18next.t('news_loading')}</p>`;

    try {
        // ======================================================================
        // NEUE, ROBUSTE QUERY: Holt die 5 neuesten, hoch bewerteten Spiele
        // ======================================================================
        const threeMonthsAgo = Math.floor(Date.now() / 1000) - (90 * 24 * 60 * 60);
        const query = `
            fields name, cover.url, first_release_date;
            where first_release_date > ${threeMonthsAgo} & total_rating_count > 25 & category = 0;
            sort first_release_date desc;
            limit 5;
        `;

        // Wir nutzen den stabilen '/games' Endpunkt
        const response = await fetch('/.netlify/functions/call-igdb', {
            method: 'POST',
            body: JSON.stringify({ endpoint: 'games', query: query })
        });

        if (!response.ok) {
            const errorText = await response.text();
            throw new Error(`Fehler beim Abrufen der neuen Spiele: ${errorText}`);
        }
        const newGames = await response.json();

        if (newGames.length === 0) {
            container.innerHTML = `<p class="text-gray-500 text-center">${i18next.t('news_no_posts')}</p>`;
            return;
        }

        let newsHtml = newGames.map(game => {
            const releaseDate = new Date(game.first_release_date * 1000).toLocaleDateString('de-DE', { year: 'numeric', month: 'long' });
            return `
                <div class="bg-gray-900 p-3 rounded-lg flex items-center gap-4">
                    <img src="${game.cover.url.replace('t_thumb', 't_cover_big')}" class="w-16 h-20 object-cover rounded">
                    <div>
                        <h4 class="font-bold text-white">${sanitizeHTML(game.name)}</h4>
                        <p class="text-sm text-gray-400">Veröffentlicht: ${releaseDate}</p>
                    </div>
                </div>
            `;
        }).join('');

        container.innerHTML = `<h3 class="text-xl font-bold text-white mb-4">Neueste Top-Spiele</h3>` + newsHtml;
    } catch(e) {
        console.error("Fehler beim Laden der neuen Spiele:", e);
        container.innerHTML = `<p class="text-red-400 text-center">${i18next.t('news_error')}</p>`;
    }
}
async function displayFeaturedGame() {
    const container = document.getElementById('featured-game-card');
    if (!container) return;
    container.innerHTML = `<p class="text-gray-400">${i18next.t('profile_loading')}</p>`;

    try {
        // Holt ein zufälliges, hoch bewertetes Spiel
        const randomOffset = Math.floor(Math.random() * 200);
        const query = `
            fields name, cover.url, summary;
            where total_rating_count > 500 & category = 0 & version_parent = null;
            sort total_rating_count desc;
            limit 1;
            offset ${randomOffset};
        `;

        const response = await fetch('/.netlify/functions/call-igdb', {
            method: 'POST',
            body: JSON.stringify({ query: query })
        });
        const games = await response.json();
        if (!games || games.length === 0) throw new Error("Kein Spiel gefunden.");

        const game = games[0];
        const imageUrl = game.cover ? game.cover.url.replace('t_thumb', 't_cover_big') : '';
        
        container.innerHTML = `
            <div class="max-w-md mx-auto bg-gray-800 rounded-xl shadow-lg overflow-hidden md:max-w-2xl border border-gray-700">
              <div class="md:flex">
                <div class="md:flex-shrink-0">
                  <img class="h-48 w-full object-cover md:h-full md:w-48" src="${imageUrl}" alt="Cover von ${game.name}">
                </div>
                <div class="p-8 text-left">
                  <h3 class="text-2xl font-bold text-white">${sanitizeHTML(game.name)}</h3>
                  <p class="mt-2 text-gray-400 line-clamp-4">${sanitizeHTML(game.summary)}</p>
                </div>
              </div>
            </div>
        `;
    } catch (e) {
        console.error("Fehler beim Laden des Spiel des Tages:", e);
        container.innerHTML = ''; // Bei Fehler einfach ausblenden
    }
}
function setupPrivacyPolicyAccordion() {
    const container = document.getElementById('privacy-content');
    // Bricht ab, wenn der Code schon einmal ausgeführt wurde
    if (!container || container.dataset.accordionInitialized) return;

    const originalElements = Array.from(container.children);
    const mainTitle = originalElements.find(el => el.tagName === 'H1');
    const h2s = originalElements.filter(el => el.tagName === 'H2');

    // Leere den Container, behalte nur den Titel
    container.innerHTML = '';
    if (mainTitle) {
        container.appendChild(mainTitle.cloneNode(true));
    }

    // Baue das Akkordeon
    h2s.forEach(h2 => {
        const itemDiv = document.createElement('div');
        itemDiv.className = 'accordion-item';

        const button = document.createElement('button');
        button.className = 'accordion-header';
        button.innerHTML = `
            <span>${h2.innerHTML}</span>
            <span class="accordion-icon">&#43;</span>
        `;
        
        const contentDiv = document.createElement('div');
        contentDiv.className = 'accordion-content';
        const contentInnerDiv = document.createElement('div');
        contentInnerDiv.className = 'accordion-content-inner';

        // Finde alle Elemente zwischen diesem h2 und dem nächsten
        let currentIndex = originalElements.indexOf(h2);
        let nextIndex = originalElements.findIndex((el, i) => i > currentIndex && el.tagName === 'H2');
        if (nextIndex === -1) nextIndex = originalElements.length;

        for (let i = currentIndex + 1; i < nextIndex; i++) {
            contentInnerDiv.appendChild(originalElements[i].cloneNode(true));
        }
        
        contentDiv.appendChild(contentInnerDiv);
        itemDiv.appendChild(button);
        itemDiv.appendChild(contentDiv);
        container.appendChild(itemDiv);

        // Klick-Funktion hinzufügen
        button.addEventListener('click', () => {
            const isActive = button.classList.contains('active');
            
            // Schließe alle anderen offenen Tabs
            container.querySelectorAll('.accordion-header.active').forEach(activeButton => {
                if (activeButton !== button) {
                    activeButton.classList.remove('active');
                    activeButton.nextElementSibling.style.maxHeight = null;
                    activeButton.querySelector('.accordion-icon').style.transform = 'rotate(0deg)';
                }
            });

            // Öffne oder schließe den aktuellen Tab
            if (!isActive) {
                button.classList.add('active');
                contentDiv.style.maxHeight = contentDiv.scrollHeight + "px";
                button.querySelector('.accordion-icon').style.transform = 'rotate(45deg)';
            } else {
                button.classList.remove('active');
                contentDiv.style.maxHeight = null;
                button.querySelector('.accordion-icon').style.transform = 'rotate(0deg)';
            }
        });
    });
    
    container.dataset.accordionInitialized = 'true';
}
    // Entferne die ursprünglichen, nun duplizierten Elemente
    contentToWrap.forEach(el => el.remove());
    h2s.forEach(h2 => h2.remove());

    container.dataset.accordionInitialized = 'true';

</script>

</body>
</html>